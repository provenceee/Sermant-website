<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Service-Registry | Sermant</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/img/logo.svg">
    <meta name="description" content="A Proxyless Service Mesh Solution Based on Java Agent">
    
    <link rel="preload" href="/assets/css/0.styles.934e6042.css" as="style"><link rel="preload" href="/assets/js/app.56245a25.js" as="script"><link rel="preload" href="/assets/js/3.c22b673d.js" as="script"><link rel="preload" href="/assets/js/1.9e8b067b.js" as="script"><link rel="preload" href="/assets/js/42.d0f88052.js" as="script"><link rel="preload" href="/assets/js/14.7039f4a7.js" as="script"><link rel="prefetch" href="/assets/js/10.ca8549df.js"><link rel="prefetch" href="/assets/js/11.6a8571e0.js"><link rel="prefetch" href="/assets/js/12.3caa9ab5.js"><link rel="prefetch" href="/assets/js/13.b1f0a423.js"><link rel="prefetch" href="/assets/js/15.36703cc8.js"><link rel="prefetch" href="/assets/js/16.804e91c8.js"><link rel="prefetch" href="/assets/js/17.0f65b007.js"><link rel="prefetch" href="/assets/js/18.92d1be28.js"><link rel="prefetch" href="/assets/js/19.ce355d42.js"><link rel="prefetch" href="/assets/js/20.89bea0c7.js"><link rel="prefetch" href="/assets/js/21.945c9d2a.js"><link rel="prefetch" href="/assets/js/22.92e167cf.js"><link rel="prefetch" href="/assets/js/23.f67f4b5e.js"><link rel="prefetch" href="/assets/js/24.69a732d8.js"><link rel="prefetch" href="/assets/js/25.4876205d.js"><link rel="prefetch" href="/assets/js/26.6739bd0c.js"><link rel="prefetch" href="/assets/js/27.8e5c7da7.js"><link rel="prefetch" href="/assets/js/28.bfac4c9e.js"><link rel="prefetch" href="/assets/js/29.53aabd90.js"><link rel="prefetch" href="/assets/js/30.a9d9a2a9.js"><link rel="prefetch" href="/assets/js/31.60ffcf24.js"><link rel="prefetch" href="/assets/js/32.3173505b.js"><link rel="prefetch" href="/assets/js/33.545c5274.js"><link rel="prefetch" href="/assets/js/34.00264371.js"><link rel="prefetch" href="/assets/js/35.276e3817.js"><link rel="prefetch" href="/assets/js/36.b0d41169.js"><link rel="prefetch" href="/assets/js/37.2fad2a48.js"><link rel="prefetch" href="/assets/js/38.0aa576a4.js"><link rel="prefetch" href="/assets/js/39.4757bdce.js"><link rel="prefetch" href="/assets/js/4.94f1233f.js"><link rel="prefetch" href="/assets/js/40.416a30c0.js"><link rel="prefetch" href="/assets/js/41.fee59cd9.js"><link rel="prefetch" href="/assets/js/43.2be6fc39.js"><link rel="prefetch" href="/assets/js/44.16c1ffcf.js"><link rel="prefetch" href="/assets/js/45.9c66aab6.js"><link rel="prefetch" href="/assets/js/46.0c089932.js"><link rel="prefetch" href="/assets/js/47.6b16ba66.js"><link rel="prefetch" href="/assets/js/48.6f183f8c.js"><link rel="prefetch" href="/assets/js/49.8236e4a0.js"><link rel="prefetch" href="/assets/js/5.05c6b3e9.js"><link rel="prefetch" href="/assets/js/50.91ee7d0a.js"><link rel="prefetch" href="/assets/js/51.3890a4c6.js"><link rel="prefetch" href="/assets/js/52.76c23ee8.js"><link rel="prefetch" href="/assets/js/53.3b3b4ad4.js"><link rel="prefetch" href="/assets/js/54.8c695126.js"><link rel="prefetch" href="/assets/js/55.24d58397.js"><link rel="prefetch" href="/assets/js/56.a73657ef.js"><link rel="prefetch" href="/assets/js/57.4b02d6af.js"><link rel="prefetch" href="/assets/js/58.08717c67.js"><link rel="prefetch" href="/assets/js/59.e6514139.js"><link rel="prefetch" href="/assets/js/6.d82aff6e.js"><link rel="prefetch" href="/assets/js/60.5410266f.js"><link rel="prefetch" href="/assets/js/61.59e38702.js"><link rel="prefetch" href="/assets/js/62.96273134.js"><link rel="prefetch" href="/assets/js/63.807a4412.js"><link rel="prefetch" href="/assets/js/64.fd39dc04.js"><link rel="prefetch" href="/assets/js/65.afef1e74.js"><link rel="prefetch" href="/assets/js/66.3a7aeeab.js"><link rel="prefetch" href="/assets/js/67.42b5b39d.js"><link rel="prefetch" href="/assets/js/68.dab77e43.js"><link rel="prefetch" href="/assets/js/69.59b843c2.js"><link rel="prefetch" href="/assets/js/7.0aa4fbf2.js"><link rel="prefetch" href="/assets/js/70.ea2db599.js"><link rel="prefetch" href="/assets/js/71.dd9084fc.js"><link rel="prefetch" href="/assets/js/72.4828d1d6.js"><link rel="prefetch" href="/assets/js/73.b644410d.js"><link rel="prefetch" href="/assets/js/74.7626c55a.js"><link rel="prefetch" href="/assets/js/75.7fb65875.js"><link rel="prefetch" href="/assets/js/76.899c626b.js"><link rel="prefetch" href="/assets/js/77.90d41e21.js"><link rel="prefetch" href="/assets/js/78.edaa0b7b.js"><link rel="prefetch" href="/assets/js/79.e9e1e72a.js"><link rel="prefetch" href="/assets/js/8.fe2e589f.js"><link rel="prefetch" href="/assets/js/80.b2cde3fe.js"><link rel="prefetch" href="/assets/js/81.90984771.js"><link rel="prefetch" href="/assets/js/82.ea554216.js"><link rel="prefetch" href="/assets/js/83.0e507f62.js"><link rel="prefetch" href="/assets/js/84.5306af9d.js"><link rel="prefetch" href="/assets/js/85.57b25843.js"><link rel="prefetch" href="/assets/js/86.3aefe1fd.js"><link rel="prefetch" href="/assets/js/87.cc73ef62.js"><link rel="prefetch" href="/assets/js/88.f36833ec.js"><link rel="prefetch" href="/assets/js/89.73f38fbd.js"><link rel="prefetch" href="/assets/js/9.623da9fe.js">
    <link rel="stylesheet" href="/assets/css/0.styles.934e6042.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/en/" class="home-link router-link-active"><img src="/img/sermant-logo.png" alt="Sermant" class="logo"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/en/document/" class="nav-link">
  Document
</a></div><div class="nav-item"><a href="/en/blog/" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="https://github.com/huaweicloud/Sermant" target="_blank" class="nav-link external">
  Github
  <!----></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/document/plugin/register-migration.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/en/document/plugin/register-migration.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li></ul></div></div> <div class="nav-item"><!----></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/en/document/" class="nav-link">
  Document
</a></div><div class="nav-item"><a href="/en/blog/" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="https://github.com/huaweicloud/Sermant" target="_blank" class="nav-link external">
  Github
  <!----></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/document/plugin/register-migration.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/en/document/plugin/register-migration.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li></ul></div></div> <div class="nav-item"><!----></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Start</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>User Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Plugin Guide</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/en/document/plugin/" aria-current="page" class="sidebar-link">Plugin</a></li><li><a href="/en/document/plugin/dynamic-config.html" class="sidebar-link">Dynamic Configuration</a></li><li><a href="/en/document/plugin/flowcontrol.html" class="sidebar-link">FlowControl</a></li><li><a href="/en/document/plugin/graceful.html" class="sidebar-link">Graceful Online/Offline</a></li><li><a href="/en/document/plugin/loadbalancer.html" class="sidebar-link">Load balancing</a></li><li><a href="/en/document/plugin/monitor.html" class="sidebar-link">Monitoring</a></li><li><a href="/en/document/plugin/router.html" class="sidebar-link">Tag Router</a></li><li><a href="/en/document/plugin/register-migration.html" aria-current="page" class="active sidebar-link">Service-Registry</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/en/document/plugin/register-migration.html#function" class="sidebar-link">Function</a></li><li class="sidebar-sub-header"><a href="/en/document/plugin/register-migration.html#parameter-configuration" class="sidebar-link">Parameter Configuration</a></li><li class="sidebar-sub-header"><a href="/en/document/plugin/register-migration.html#supported-versions-and-limitations" class="sidebar-link">Supported Versions and Limitations</a></li><li class="sidebar-sub-header"><a href="/en/document/plugin/register-migration.html#operation-and-result-verification" class="sidebar-link">Operation and Result Verification</a></li><li class="sidebar-sub-header"><a href="/en/document/plugin/register-migration.html#registry-migration-spring-cloud" class="sidebar-link">Registry Migration - Spring Cloud</a></li><li class="sidebar-sub-header"><a href="/en/document/plugin/register-migration.html#registry-migration-dubbo" class="sidebar-link">Registry Migration - Dubbo</a></li></ul></li><li><a href="/en/document/plugin/springboot-registry.html" class="sidebar-link">SpringBoot Registry</a></li><li><a href="/en/document/plugin/visibility.html" class="sidebar-link">Service visibility</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Developer Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Community Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>FAQ</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="service-registry"><a href="#service-registry" class="header-anchor">#</a> Service-Registry</h1> <p>This article describes how to use the <a href="https://github.com/huaweicloud/Sermant/tree/develop/sermant-plugins/sermant-service-registry" target="_blank" rel="noopener noreferrer">service registration plugin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, as well as the migration capabilities of the registration center based on the <a href="#registry-migration-spring-cloud">Spring Cloud</a> framework and the <a href="#registry-migration-dubbo">Dubbo</a> framework.</p> <h2 id="function"><a href="#function" class="header-anchor">#</a> Function</h2> <p>The service registration plug-in has the ability to achieve registration migration in a non-intrusive way. Microservices originally registered in mainstream registries such as Eureka, Nacos, Zookeeper and Consul can be non-intrusively registered in <a href="https://github.com/apache/servicecomb-service-center" target="_blank" rel="noopener noreferrer">ServiceComb<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> based on dual registration or single registration mode Or <a href="https://nacos.io/" target="_blank" rel="noopener noreferrer">Nacos<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> On.</p> <h2 id="parameter-configuration"><a href="#parameter-configuration" class="header-anchor">#</a> Parameter Configuration</h2> <h3 id="sermant-agent-configuration"><a href="#sermant-agent-configuration" class="header-anchor">#</a> Sermant-agent configuration</h3> <p>Service registry plugin requires configuring the service metadata (application, project, version, environment, other metadata) in Sermant-agent, refer to <a href="/en/document/user-guide/sermant-agent.html#sermant-agent-parameter-configuration">Sermant-agent User Manual</a>.</p> <ul><li><p>service.meta.application: application/group, service discovery is only possible for microservices that belong to the same application.</p></li> <li><p>service.meta.project: project, service discovery is only possible for microservices that belong to the same project.</p></li> <li><p>service.meta.version: version, used to identify the current version of the microservice.</p></li> <li><p>service.meta.environment: environment, used to identify the current microservice's environment, and only microservices belonging to the same environment can perform service discovery.</p></li> <li><p>service.meta.parameters: other metadata, used to tag the current microservice, like k1:v1,k2:v2.</p></li></ul> <h3 id="plugin-configuration"><a href="#plugin-configuration" class="header-anchor">#</a> Plugin configuration</h3> <p>Service registry plugin requires modification of the plugin configuration file on demand, which can be found in the path <code>${path}/sermant-agent-x.x.x/agent/pluginPackage/service-registry/config/config.yaml</code>. The configuration file for the plugin is shown below:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">register.service</span><span class="token punctuation">:</span>
  <span class="token key atrule">registerType</span><span class="token punctuation">:</span> SERVICE_ COMB         <span class="token comment"># The type of new registry, which controls the registration method used for service registration. Different registries have different registration implementations.</span>
  <span class="token key atrule">address</span><span class="token punctuation">:</span>  http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">30100</span>    <span class="token comment"># New registration center address. Controls where the service is registered when it is registered.</span>
<span class="token key atrule">servicecomb.service</span><span class="token punctuation">:</span>
  <span class="token key atrule">heartbeat interval</span><span class="token punctuation">:</span> <span class="token number">15</span>              <span class="token comment"># heartbeat sending interval of service instance. Monitor the status of the service instance through the heartbeat.</span>
  <span class="token key atrule">openMigration</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>                <span class="token comment"># Register the migration switch. When enabled, the original registration function of the host service will be blocked and only registered to the new registry.</span>
  <span class="token key atrule">enableSpringRegister</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>         <span class="token comment"># The spring cloud plug-in registration ability switch. After being opened, it will be registered as a Spring Cloud service to the new registry. Cannot be turned on at the same time as the dubbo plug-in registration ability switch.</span>
  <span class="token key atrule">enableDubboRegister</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>          <span class="token comment"># Dubbo plug-in registration ability switch. After being opened, it will be registered as a dubbo service to the new registry. It cannot be turned on at the same time as the Spring plug-in registration ability switch.</span>
  <span class="token key atrule">sslEnabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>                   <span class="token comment"># ssl switch. Controls whether SSL security access is enabled.</span>
  <span class="token key atrule">preferIpAddress</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>              <span class="token comment"># Whether to use IP. Controls whether the service instance is registered using IP or domain name.</span>
<span class="token key atrule">nacos.service</span><span class="token punctuation">:</span>
  <span class="token key atrule">username</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>                        <span class="token comment"># nacos verifies the account. When the new registration center is nacos, you need to use nacos to verify your account when you register.</span>
  <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>                        <span class="token comment"># nacos verifies the account. When the new registration center is nacos, the password needs to be verified by nacos when registering.</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>                       <span class="token comment"># ID value of the nacos namespace. Control the namespace to which the nacos is registered when registering, and only microservices belonging to the same namespace can perform service discovery.</span>
  <span class="token key atrule">weight</span><span class="token punctuation">:</span> <span class="token number">1</span>                           <span class="token comment"># Service instance weight value. Used during service registration. When a service instance is called, the higher the weight, the higher the access frequency.</span>
  <span class="token key atrule">clusterName</span><span class="token punctuation">:</span> DEFAULT                <span class="token comment"># Cluster name. It is used for service registration and discovery. When the service instance is called, only the instances under the same cluster will be called.</span>
  <span class="token key atrule">ephemeral</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>                     <span class="token comment"># Whether it is a temporary node. Used during service registration. The temporary node is used when the node does not need to exist after the service is offline.</span>
</code></pre></div><p>The configuration items are described as follows:</p> <table><thead><tr><th>Parameter Key</th> <th>Description</th> <th>Default Value</th> <th>Affiliated Registration Center</th> <th>Required</th></tr></thead> <tbody><tr><td>register.service.registerType</td> <td>Registration Center Type, support NACOS/SERVICE_COMB</td> <td>SERVICE_COMB</td> <td>common</td> <td>Yes</td></tr> <tr><td>register.service.address</td> <td>Registration center address, service_comb: like http://localhost:30100, nacos: like 127.0.0.1:8848</td> <td>http://127.0.0.1:30100</td> <td>common</td> <td>Yes</td></tr> <tr><td>servicecomb.service.heartbeatInterval</td> <td>Interval at which service instance heartbeats are sent (unit: second)</td> <td>15</td> <td>SERVICE_COMB</td> <td>Yes</td></tr> <tr><td>servicecomb.service.openMigration</td> <td>Whether to enable the migration function</td> <td>false</td> <td>SERVICE_COMB</td> <td>Yes</td></tr> <tr><td>servicecomb.service.enableSpringRegister</td> <td>Whether to enable the Spring Cloud plug-in registration capability. This capability must be enabled for the Spring Cloud framework and disabled for the Dubbo framework.Cannot be opened at the same time as enableDubboRegister</td> <td>false</td> <td>common</td> <td>Yes</td></tr> <tr><td>servicecomb.service.enableDubboRegister</td> <td>Whether to enable the dubbo plug-in registration capability. This capability must be enabled for the dubbo framework and disabled for the spring cloud framework.Cannot be opened at the same time as enableSpringRegister</td> <td>false</td> <td>common</td> <td>Yes</td></tr> <tr><td>servicecomb.service.sslEnabled</td> <td>Whether to enable SSL</td> <td>false</td> <td>SERVICE_COMB</td> <td>Yes</td></tr> <tr><td>servicecomb.service.prefererIpAddress</td> <td>Whether to use IP access</td> <td>false</td> <td>SERVICE_ COMB</td> <td>Yes</td></tr> <tr><td>nacos.service.username</td> <td>nacos username</td> <td>-</td> <td>NACOS</td> <td>No</td></tr> <tr><td>nacos.service.password</td> <td>nacos password</td> <td>-</td> <td>NACOS</td> <td>No</td></tr> <tr><td>nacos.service.namespace</td> <td>namespace, nacos setting the id of namespace</td> <td>-</td> <td>NACOS</td> <td>No</td></tr> <tr><td>nacos.service.weight</td> <td>service instance weight</td> <td>1</td> <td>NACOS</td> <td>Yes</td></tr> <tr><td>nacos.service.clusterName</td> <td>cluster name</td> <td>DEFAULT</td> <td>NACOS</td> <td>Yes</td></tr> <tr><td>nacos.service.ephemeral</td> <td>Whether to enable ephemeral endpoint, true for yes，false for no</td> <td>true</td> <td>NACOS</td> <td>Yes</td></tr></tbody></table> <blockquote><p>Notice:</p> <ul><li>group of nacos can setting by <a href="#sermant-agent-configuration">Sermant-agent configuration</a>'s service.meta.application.</li> <li>nacos configs current only show normal use type, others see <a href="https://github.com/huaweicloud/Sermant/blob/develop/sermant-plugins/sermant-service-registry/registry-common/src/main/java/com/huawei/registry/config/NacosRegisterConfig.java" target="_blank" rel="noopener noreferrer">NACOS config class<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</li></ul></blockquote> <h2 id="supported-versions-and-limitations"><a href="#supported-versions-and-limitations" class="header-anchor">#</a> Supported Versions and Limitations</h2> <p>Framework Supported:</p> <ul><li><p>SpringCloud Edgware.SR2 - 2021.0.0</p></li> <li><p>Dubbo 2.6.x - 2.7.x</p></li></ul> <p>Limitations:</p> <ul><li><p>For springcloud single registration scenario, the registration plugin will block all beans related to the original registration center, so please do not inject beans related to the original registration center in the business code, otherwise it will lead to service startup failure.</p></li> <li><p>For <strong>newly developed dubbo applications</strong>, you also need to configure the address of the dubbo registration center. This configuration item is generally in the configuration file of the dubbo application, for example, in the dubbo/provider.xml file.</p></li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>registry</span> <span class="token attr-name">address</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sc://127.0.0.1:30100<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>Alternatively, in application.yml (or application.properties), application.yml is used as an example.</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">dubbo</span><span class="token punctuation">:</span>
  <span class="token key atrule">registry</span><span class="token punctuation">:</span>
    <span class="token key atrule">address</span><span class="token punctuation">:</span> sc<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span><span class="token number">30100</span>
</code></pre></div><p>Note that the address information of <strong>this configuration item is not used</strong>. Only the protocol name sc is used. (That is, the IP address is not important. <strong>You only need to start with sc://</strong>.)</p> <blockquote><p>Note: For <strong>existing dubbo applications</strong>, (Applications which hava already set up it's own registry address) <strong>This step is not required</strong>.</p></blockquote> <h2 id="operation-and-result-verification"><a href="#operation-and-result-verification" class="header-anchor">#</a> Operation and Result Verification</h2> <p>The following will demonstrate how to use the service registration plug-in to verify the registration and migration function of the dubbo application in the single registration mode.</p> <h3 id="preparations"><a href="#preparations" class="header-anchor">#</a> Preparations</h3> <ul><li><p><a href="https://github.com/huaweicloud/Sermant/releases" target="_blank" rel="noopener noreferrer">Download<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>/Compile the sermant package</p></li> <li><p><a href="https://github.com/huaweicloud/Sermant-examples/tree/main/registry-demo/dubbo-registry-demo" target="_blank" rel="noopener noreferrer">Download<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> dubbo-registry-demo source code</p></li> <li><p><a href="https://github.com/apache/servicecomb-service-center" target="_blank" rel="noopener noreferrer">Download<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ServiceComb (used as a registry), and start</p></li></ul> <blockquote><p>Note: <a href="/en/document/user-guide/configuration-center.html">Dynamic Configuration Center</a> will be used by default in this scenario. Since it is not the core component of this scenario, it will not be described in this article.</p></blockquote> <h3 id="step-1-compile-and-package-the-dubbo-registry-demo-application"><a href="#step-1-compile-and-package-the-dubbo-registry-demo-application" class="header-anchor">#</a> Step 1: Compile and package the dubbo-registry-demo application</h3> <p>Execute the following command in the <code>${path}/Sermant-examples/registry-demo/dubbo-registry-demo</code> directory:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># windows</span>
mvn clean package

<span class="token comment"># mac, linux</span>
mvn clean package
</code></pre></div><p>After successful packaging, you can get <code>dubbo-registry-consumer.jar</code> in <code>${path}/Sermant-examples/registry-demo/dubbo-registry-demo/dubbo-registry-consumer/target</code> , get <code>dubbo-registry-provider.jar</code> in <code>${path}/Sermant-examples/registry-demo/dubbo-registry-demo/dubbo-registry-provider/target</code>.</p> <blockquote><p>Note: path is the path where the dubbo-registry-demo application is downloaded.</p></blockquote> <h3 id="step-2-deploy-the-applications"><a href="#step-2-deploy-the-applications" class="header-anchor">#</a> Step 2: Deploy the applications</h3> <p>(1) Start Consumer</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># windows</span>
<span class="token function">java</span> <span class="token parameter variable">-Dservicecomb.service.enableDubboRegister</span><span class="token operator">=</span>true -javaagent:<span class="token variable">${path}</span><span class="token punctuation">\</span>sermant-agent-x.x.x<span class="token punctuation">\</span>agent<span class="token punctuation">\</span>sermant-agent.jar<span class="token operator">=</span>appName<span class="token operator">=</span>default <span class="token parameter variable">-jar</span> dubbo-registry-consumer.jar

<span class="token comment"># mac, linux</span>
<span class="token function">java</span> <span class="token parameter variable">-Dservicecomb.service.enableDubboRegister</span><span class="token operator">=</span>true -javaagent:<span class="token variable">${path}</span>/sermant-agent-x.x.x/agent/sermant-agent.jar<span class="token operator">=</span>appName<span class="token operator">=</span>default <span class="token parameter variable">-jar</span> dubbo-registry-consumer.jar
</code></pre></div><p>(2) Start Provider</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># windows</span>
<span class="token function">java</span> <span class="token parameter variable">-Dservicecomb.service.enableDubboRegister</span><span class="token operator">=</span>true -javaagent:<span class="token variable">${path}</span><span class="token punctuation">\</span>sermant-agent-x.x.x<span class="token punctuation">\</span>agent<span class="token punctuation">\</span>sermant-agent.jar<span class="token operator">=</span>appName<span class="token operator">=</span>default <span class="token parameter variable">-jar</span> dubbo-registry-provider.jar

<span class="token comment"># mac, linux</span>
<span class="token function">java</span> <span class="token parameter variable">-Dservicecomb.service.enableDubboRegister</span><span class="token operator">=</span>true -javaagent:<span class="token variable">${path}</span>/sermant-agent-x.x.x/agent/sermant-agent.jar<span class="token operator">=</span>appName<span class="token operator">=</span>default <span class="token parameter variable">-jar</span> dubbo-registry-provider.jar
</code></pre></div><blockquote><p>Note: To facilitate the test, the DUBBO registration function is enabled in -Dservicecomb.service.enableDubboRegister=true mode. If the DUBBO registration function is enabled in other <a href="/en/document/user-guide/sermant-agent.html#parameter-configuration-options">parameter configuration method</a>, you do not need to add this parameter.</p></blockquote> <blockquote><p>Description: Replace <code>${path}</code> with the Sermant project path, replace x.x.x with the actual Sermant version number, and appName with the application name in the agent startup parameter, which is irrelevant to registration parameters. The directory for running commands must be the JAR package directory of the demo application.</p></blockquote> <h3 id="verification"><a href="#verification" class="header-anchor">#</a> Verification</h3> <p>After the preceding two applications are started, log in to the ServiceComb background <code>http://127.0.0.1:30103/</code> and check whether related service instances have been registered.</p> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <p>Access the application interface <code>http://localhost:28820/hello</code> to check whether the interface returns a normal response. If the interface returns a successful response, the registration is successful.</p> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <h2 id="registry-migration-spring-cloud"><a href="#registry-migration-spring-cloud" class="header-anchor">#</a> Registry Migration - Spring Cloud</h2> <h3 id="function-2"><a href="#function-2" class="header-anchor">#</a> Function</h3> <p>Provides the capability of quickly migrating the registration center to the <a href="https://github.com/apache/servicecomb-service-center" target="_blank" rel="noopener noreferrer">ServiceComb<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> or <a href="https://nacos.io/" target="_blank" rel="noopener noreferrer">Nacos<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> based on the dual-registration mode without interrupting online services business. The following original registration centers are supported:</p> <table><thead><tr><th>Original Registration Center</th> <th>Supported or Not</th></tr></thead> <tbody><tr><td>Eureka</td> <td>✅</td></tr> <tr><td>Consul</td> <td>✅</td></tr> <tr><td>Nacos</td> <td>✅</td></tr> <tr><td>Zookeeper</td> <td>✅</td></tr></tbody></table> <p><strong>Schematic diagram of migration</strong></p> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <h3 id="parameter-configuration-2"><a href="#parameter-configuration-2" class="header-anchor">#</a> Parameter configuration</h3> <h4 id="modify-plugin-configuration"><a href="#modify-plugin-configuration" class="header-anchor">#</a> Modify plugin configuration</h4> <p>For details about the configuration, see the <a href="#plugin-configuration">Plugin configuration</a>.</p> <p>Based on the preceding configuration, <strong>the migration configuration is added and the Spring Cloud registration plugin is enabled</strong>. The configuration content is as follows:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">servicecomb.service</span><span class="token punctuation">:</span>
  <span class="token key atrule">openMigration</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># Specifies whether to enable the migration function. To migrate the registration center, set this parameter to true.</span>
  <span class="token key atrule">enableSpringRegister</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># Enabling the spring cloud registration plugin</span>
</code></pre></div><h4 id="close-the-original-registry-heartbeat"><a href="#close-the-original-registry-heartbeat" class="header-anchor">#</a> Close the Original Registry Heartbeat</h4> <p>The registration center migration plugin provides the method of disabling the heartbeat mechanism of the original registration center based on the dynamic configuration center to prevent continuous error log output.</p> <p>Please refer to <a href="/en/document/user-guide/configuration-center.html#sermant-dynamic-configuration-center-model">Dynamic Configuration Center User Manual</a>, the configuration content is as follows:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;content为&quot;</span><span class="token operator">:</span> <span class="token string">&quot;origin.__registry__.needClose: true&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;group&quot;</span><span class="token operator">:</span> <span class="token string">&quot;app=${service.meta.application}&amp;environment=${service.meta.environment}&amp;service={spring.application.name}&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sermant.agent.registry&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>Group recommends configuring it to microservice level. When configuring, please modify service.meta.application, service.meta.environment, and spring.application.nam to specific values. For the configuration of service.meta.application, service.meta.environment, please refer to the [Service Agent User Manual] (../user-guide/service-agent. md # parameter configuration of service-agent), and spring.application.name is the microservice name (that is, the service name configured in the spring application).</p></blockquote> <p>The key value is <strong>sermant.agent.registry</strong>.</p> <p>It is recommended to configure the group to microservice level, i.e. <strong>app=${service.meta.application}&amp;environment=${service.meta.environment}&amp;service={spring.application.name}</strong>, for the configuration of service.meta.application and service.meta.environment, please refer to the <a href="/en/document/user-guide/sermant-agent.html#sermant-agent-parameter-configuration">Sermant-agent User Manual</a>, spring.application.name is the microservice name (i.e. the name of the service configured in the spring application).</p> <p>The content is <strong>origin.__registry__.needClose: true</strong>.</p> <blockquote><p><em><strong>Notices :</strong></em></p> <p>This operation is a one-off operation. After the registration center heartbeat function is disabled, the heartbeat function cannot be enabled. It can be restored only after the application instance is restarted.</p></blockquote> <h3 id="supported-versions-and-limitations-2"><a href="#supported-versions-and-limitations-2" class="header-anchor">#</a> Supported Versions and Limitations</h3> <p>Framework Supported:</p> <ul><li>SpringCloud Edgware.SR2 - 2021.0.0</li></ul> <p>Limitations: None</p> <h3 id="operation-and-result-verification-2"><a href="#operation-and-result-verification-2" class="header-anchor">#</a> Operation and Result Verification</h3> <p>The following will demonstrate how to use the service registration plug-in to verify the registration and migration function of the SpringCloug application in the dual registration mode (the scenario of migrating from Zookeeper to ServiceComb).</p> <h4 id="preparations-2"><a href="#preparations-2" class="header-anchor">#</a> Preparations</h4> <ul><li><p><a href="https://github.com/huaweicloud/Sermant/releases" target="_blank" rel="noopener noreferrer">Download<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>/Compile the sermant package</p></li> <li><p><a href="https://github.com/huaweicloud/Sermant-examples/tree/main/registry-demo/spring-cloud-registry-demo" target="_blank" rel="noopener noreferrer">Download<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> spring-cloud-registry-demo source code</p></li> <li><p><a href="https://github.com/apache/servicecomb-service-center" target="_blank" rel="noopener noreferrer">Download<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ServiceComb (used as a registry), and start</p></li> <li><p><a href="https://zookeeper.apache.org/releases.html#download" target="_blank" rel="noopener noreferrer">Download<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> Zookeeper (used as a registry), and start</p></li></ul> <h3 id="step-1-compile-and-package-the-spring-cloud-registry-demo-application"><a href="#step-1-compile-and-package-the-spring-cloud-registry-demo-application" class="header-anchor">#</a> Step 1: Compile and package the spring-cloud-registry-demo application</h3> <p>Execute the following command in the <code>${path}/Sermant-examples/registry-demo/spring-cloud-registry-demo</code> directory:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># windows</span>
mvn clean package

<span class="token comment"># mac, linux</span>
mvn clean package
</code></pre></div><p>After successful packaging, you can get <code>spring-cloud-registry-consumer.jar</code> in <code>${path}/Sermant-examples/registry-demo/spring-cloud-registry-demo/spring-cloud-registry-consumer/target</code> , get <code>spring-cloud-registry-provider.jar</code> in <code>${path}/Sermant-examples/registry-demo/spring-cloud-registry-demo/spring-cloud-registry-provider/target</code>.</p> <blockquote><p>Note: path is the path where the spring-cloud-registry-demo application is downloaded.</p></blockquote> <h4 id="step-2-deploy-the-applications-2"><a href="#step-2-deploy-the-applications-2" class="header-anchor">#</a> Step 2: Deploy the applications</h4> <p>(1) Start the original provider and original consumer (registered in Zookeeper)</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># windows</span>
<span class="token function">java</span> <span class="token parameter variable">-jar</span> spring-cloud-registry-provider.jar

<span class="token function">java</span> <span class="token parameter variable">-jar</span> spring-cloud-registry-consumer.jar

<span class="token comment"># mac, linux</span>
<span class="token function">java</span> <span class="token parameter variable">-jar</span> spring-cloud-registry-provider.jar

<span class="token function">java</span> <span class="token parameter variable">-jar</span> spring-cloud-registry-consumer.jar
</code></pre></div><p>After successful startup, visit the consumer interface <code>http://localhost:8161/hello</code> to confirm that the interface is returning properly.</p> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <p>(2) Start up double registration providers</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># windows</span>
<span class="token function">java</span> <span class="token parameter variable">-Dserver.port</span><span class="token operator">=</span><span class="token number">8262</span> <span class="token parameter variable">-Dservicecomb.service.openMigration</span><span class="token operator">=</span>true <span class="token parameter variable">-Dservicecomb.service.enableSpringRegister</span><span class="token operator">=</span>true -javaagent:<span class="token variable">${path}</span><span class="token punctuation">\</span>sermant-agent-x.x.x<span class="token punctuation">\</span>agent<span class="token punctuation">\</span>sermant-agent.jar<span class="token operator">=</span>appName<span class="token operator">=</span>default <span class="token parameter variable">-jar</span> spring-cloud-registry-provider.jar

<span class="token comment"># mac, linux</span>
<span class="token function">java</span> <span class="token parameter variable">-Dserver.port</span><span class="token operator">=</span><span class="token number">8262</span> <span class="token parameter variable">-Dservicecomb.service.openMigration</span><span class="token operator">=</span>true <span class="token parameter variable">-Dservicecomb.service.enableSpringRegister</span><span class="token operator">=</span>true -javaagent:<span class="token variable">${path}</span>/sermant-agent-x.x.x/agent/sermant-agent.jar<span class="token operator">=</span>appName<span class="token operator">=</span>default <span class="token parameter variable">-jar</span> spring-cloud-registry-provider.jar
</code></pre></div><blockquote><p>Notices: To facilitate the test, the spring migration function is enabled in -Dservicecomb.service.openMigration=true -Dservicecomb.service.enableSpringRegister=true mode. If the spring migration function is enabled in other <a href="/en/document/user-guide/sermant-agent.html#parameter-configuration-options">parameter configuration method</a>, you do not need to add this parameter. For perspective, the provider port is modified using -Dserver.port=8262.</p></blockquote> <blockquote><p>Description: Replace path with the actual Sermant package path**, x.x.x is the actual Sermant version number, and appName with the agent startup parameter, which is irrelevant to registration parameters.</p></blockquote> <p>After a successful start, visit the consumer interface <code>http://localhost:8161/hello</code> several times to confirm that the interface can access the 2 providers.</p> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <p>(3) Close the original provider</p> <p>(4) Start up double registration consumers</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># windows</span>
<span class="token function">java</span> <span class="token parameter variable">-Dserver.port</span><span class="token operator">=</span><span class="token number">8261</span> <span class="token parameter variable">-Dservicecomb.service.openMigration</span><span class="token operator">=</span>true <span class="token parameter variable">-Dservicecomb.service.enableSpringRegister</span><span class="token operator">=</span>true -javaagent:<span class="token variable">${path}</span><span class="token punctuation">\</span>sermant-agent-x.x.x<span class="token punctuation">\</span>agent<span class="token punctuation">\</span>sermant-agent.jar<span class="token operator">=</span>appName<span class="token operator">=</span>default <span class="token parameter variable">-jar</span> spring-cloud-registry-consumer.jar

<span class="token comment"># mac, linux</span>
<span class="token function">java</span> <span class="token parameter variable">-Dserver.port</span><span class="token operator">=</span><span class="token number">8261</span> <span class="token parameter variable">-Dservicecomb.service.openMigration</span><span class="token operator">=</span>true <span class="token parameter variable">-Dservicecomb.service.enableSpringRegister</span><span class="token operator">=</span>true -javaagent:<span class="token variable">${path}</span>/sermant-agent-x.x.x/agent/sermant-agent.jar<span class="token operator">=</span>appName<span class="token operator">=</span>default <span class="token parameter variable">-jar</span> spring-cloud-registry-consumer.jar
</code></pre></div><blockquote><p>Notices: To facilitate the test, the spring migration function is enabled in -Dservicecomb.service.openMigration=true -Dservicecomb.service.enableSpringRegister=true mode. If the spring migration function is enabled in other <a href="/en/document/user-guide/sermant-agent.html#parameter-configuration-options">parameter configuration method</a>, you do not need to add this parameter. For perspective, the consumer port is modified using -Dserver.port=8261.</p></blockquote> <blockquote><p>Description: Replace path with the actual Sermant package path**, x.x.x is the actual Sermant version number, and appName with the agent startup parameter, which is irrelevant to registration parameters.</p></blockquote> <p>After successful startup, visit the consumer interface <code>http://localhost:8161/hello</code> and <code>http://localhost:8261/hello</code> several times to confirm that the 2 interfaces can access the double registered provider.</p> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <p>(5) Close the original consumer</p> <p>(6) Stop the old registry center (Zookeeper)</p> <blockquote><p><em><strong>Notices：</strong></em></p> <p>Stop the original register center. Because most of the registry centers have the heartbeat check mechanism, the instance may continuously update error logs, but the application invoking is not affected.</p> <p>To stop such error logs, see <a href="#close-the-original-registry-heartbeat"><strong>Close the Original Registry Heartbeat</strong></a>.</p> <p>When issuing a configuration to a provider, key is <strong>sermant.agent.registry</strong>, group is <strong>app=default&amp;environment=&amp;service=spring-cloud-registry-provider</strong>，content is <strong>origin.__registry__.needClose: true</strong>.</p> <p>When issuing a configuration to a consumer, key is <strong>sermant.agent.registry</strong>, group is <strong>app=default&amp;environment=&amp;service=spring-cloud-registry-consumer</strong>，content is <strong>origin.__registry__.needClose: true</strong>.</p></blockquote> <h4 id="verification-2"><a href="#verification-2" class="header-anchor">#</a> Verification</h4> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <p>The producer service and consumer service successfully migrate the registry to servicecomb, and the producer can always invoke the consumer during the migration of the registry without interrupting the service.</p> <h2 id="registry-migration-dubbo"><a href="#registry-migration-dubbo" class="header-anchor">#</a> Registry Migration - Dubbo</h2> <h3 id="function-3"><a href="#function-3" class="header-anchor">#</a> Function</h3> <p>Provides the capability of quickly migrating the registration center to the <a href="https://github.com/apache/servicecomb-service-center" target="_blank" rel="noopener noreferrer">ServiceComb<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> or <a href="https://nacos.io/" target="_blank" rel="noopener noreferrer">Nacos<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> based on the dual-registration mode without interrupting online services business. The following original registration centers are supported:</p> <table><thead><tr><th>Original Registration Center</th> <th>Support</th></tr></thead> <tbody><tr><td>Nacos</td> <td>✅</td></tr> <tr><td>Zookeeper</td> <td>✅</td></tr></tbody></table> <p><strong>Schematic diagram of migration</strong></p> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <h3 id="parameter-configuration-3"><a href="#parameter-configuration-3" class="header-anchor">#</a> Parameter configuration</h3> <h4 id="modify-plugin-configuration-2"><a href="#modify-plugin-configuration-2" class="header-anchor">#</a> Modify plugin configuration</h4> <p>For details about the configuration, see the <a href="#plugin-configuration">Plugin configuration</a>.</p> <p>Based on the preceding configuration, <strong>the migration configuration is added and the Dubbo registration plugin is enabled</strong>. The configuration content is as follows:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">servicecomb.service</span><span class="token punctuation">:</span>
  <span class="token key atrule">openMigration</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># Specifies whether to enable the migration function. To migrate the registration center, set this parameter to true.</span>
  <span class="token key atrule">enableDubboRegister</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># Enabling the Dubbo registration plugin</span>
</code></pre></div><p><strong>Notices</strong>: If the migration function is enabled, you do not need to change the address of the original registration center (i.e. dubbo.registry.address). Otherwise, the registration will not be performed at the same time with two registration centers (original registration center + SC).</p> <h3 id="supported-versions-and-limitations-3"><a href="#supported-versions-and-limitations-3" class="header-anchor">#</a> Supported Versions and Limitations</h3> <p>Framework Supported:</p> <ul><li>Dubbo 2.6.x - 2.7.x</li></ul> <p>Limitations: None</p> <h3 id="operation-and-result-verification-3"><a href="#operation-and-result-verification-3" class="header-anchor">#</a> Operation and Result Verification</h3> <p>The following will demonstrate how to use the service registration plug-in to verify the registration and migration function of Dubbo application in the dual registration mode (the scenario of migrating from Zookeeper to ServiceComb).</p> <h4 id="preparations-3"><a href="#preparations-3" class="header-anchor">#</a> Preparations</h4> <ul><li><p><a href="https://github.com/huaweicloud/Sermant/releases" target="_blank" rel="noopener noreferrer">Download<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>/Compile the sermant package</p></li> <li><p><a href="https://github.com/huaweicloud/Sermant-examples/tree/main/registry-demo/dubbo-registry-demo" target="_blank" rel="noopener noreferrer">Download<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> dubbo-registry-demo source code</p></li> <li><p><a href="https://github.com/apache/servicecomb-service-center" target="_blank" rel="noopener noreferrer">Download<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ServiceComb (used as a registry), and start</p></li> <li><p><a href="https://zookeeper.apache.org/releases.html#download" target="_blank" rel="noopener noreferrer">Download<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> Zookeeper (used as a registry), and start</p></li></ul> <h3 id="step-1-compile-and-package-the-dubbo-registry-demo-application-2"><a href="#step-1-compile-and-package-the-dubbo-registry-demo-application-2" class="header-anchor">#</a> Step 1: Compile and package the dubbo-registry-demo application</h3> <p>Execute the following command in the <code>${path}/Sermant-examples/registry-demo/dubbo-registry-demo</code> directory:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># windows</span>
mvn clean package

<span class="token comment"># mac, linux</span>
mvn clean package
</code></pre></div><p>After successful packaging, you can get <code>dubbo-registry-consumer.jar</code> in <code>${path}/Sermant-examples/registry-demo/dubbo-registry-demo/dubbo-registry-consumer/target</code> , get <code>dubbo-registry-provider.jar</code> in <code>${path}/Sermant-examples/registry-demo/dubbo-registry-demo/dubbo-registry-provider/target</code>.</p> <blockquote><p>Note: path is the path where the dubbo-registry-demo application is downloaded.</p></blockquote> <h4 id="step-2-deploy-the-applications-3"><a href="#step-2-deploy-the-applications-3" class="header-anchor">#</a> Step 2: Deploy the applications</h4> <p>(1) Start up double registration consumer</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># windows</span>
<span class="token function">java</span> <span class="token parameter variable">-Dservicecomb.service.openMigration</span><span class="token operator">=</span>true <span class="token parameter variable">-Dservicecomb.service.enableDubboRegister</span><span class="token operator">=</span>true -javaagent:<span class="token variable">${path}</span><span class="token punctuation">\</span>sermant-agent-x.x.x<span class="token punctuation">\</span>agent<span class="token punctuation">\</span>sermant-agent.jar<span class="token operator">=</span>appName<span class="token operator">=</span>default <span class="token parameter variable">-jar</span> dubbo-registry-consumer.jar

<span class="token comment"># mac, linux</span>
<span class="token function">java</span> <span class="token parameter variable">-Dservicecomb.service.openMigration</span><span class="token operator">=</span>true <span class="token parameter variable">-Dservicecomb.service.enableDubboRegister</span><span class="token operator">=</span>true -javaagent:<span class="token variable">${path}</span>/sermant-agent-x.x.x/agent/sermant-agent.jar<span class="token operator">=</span>appName<span class="token operator">=</span>default <span class="token parameter variable">-jar</span> dubbo-registry-consumer.jar
</code></pre></div><blockquote><p>Notices: To facilitate the test, the dubbo migration function is enabled in -Dservicecomb.service.openMigration=true -Dservicecomb.service.enableDubboRegister=true mode. If the dubbo migration function is enabled in other <a href="/en/document/user-guide/sermant-agent.html#parameter-configuration-options">parameter configuration method</a>, you do not need to add this parameter.</p></blockquote> <p>(2) Start the original provider (registered with the Zookeeper).</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># windows</span>
<span class="token function">java</span> <span class="token parameter variable">-jar</span> dubbo-registry-provider.jar

<span class="token comment"># mac, linux</span>
<span class="token function">java</span> <span class="token parameter variable">-jar</span> dubbo-registry-provider.jar
</code></pre></div><p>(3) Starting a New Provider (Registering to the SC)</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># windows</span>
<span class="token function">java</span> <span class="token parameter variable">-Dservicecomb.service.enableDubboRegister</span><span class="token operator">=</span>true <span class="token parameter variable">-Dserver.port</span><span class="token operator">=</span><span class="token number">48021</span> <span class="token parameter variable">-Ddubbo.protocol.port</span><span class="token operator">=</span><span class="token number">48821</span> -javaagent:<span class="token variable">${path}</span><span class="token punctuation">\</span>sermant-agent-x.x.x<span class="token punctuation">\</span>agent<span class="token punctuation">\</span>sermant-agent.jar<span class="token operator">=</span>appName<span class="token operator">=</span>default <span class="token parameter variable">-jar</span> dubbo-registry-provider.jar

<span class="token comment"># mac, linux</span>
<span class="token function">java</span> <span class="token parameter variable">-Dservicecomb.service.enableDubboRegister</span><span class="token operator">=</span>true <span class="token parameter variable">-Dserver.port</span><span class="token operator">=</span><span class="token number">48021</span> <span class="token parameter variable">-Ddubbo.protocol.port</span><span class="token operator">=</span><span class="token number">48821</span> -javaagent:<span class="token variable">${path}</span>/sermant-agent-x.x.x/agent/sermant-agent.jar<span class="token operator">=</span>appName<span class="token operator">=</span>default <span class="token parameter variable">-jar</span> dubbo-registry-provider.jar
</code></pre></div><blockquote><p>Notice: To facilitate the test, the Dubbo registration function is enabled in -Dservicecomb.service.enableDubboRegister=true mode. If the Dubbo registration function is enabled in other <a href="/en/document/user-guide/sermant-agent.html#parameter-configuration-options">parameter configuration method</a>, you do not need to add this parameter. In addition, to solve the port conflict problem when two providers are started on the same server, you need to add the -Dserver.port=48021 -Ddubbo.protocol.port=48821 parameter. If the two providers are on different servers, you do not need to add this parameter.</p></blockquote> <blockquote><p>Description: Please replace <code>${path}</code> with the Sermant project path, replace x.x.x with the actual Sermant version number, and appName with the application name in the agent startup parameter, which is irrelevant to the registration parameter. The directory for running the command must be the directory where the JAR package of the demo application is located.</p></blockquote> <h4 id="verification-3"><a href="#verification-3" class="header-anchor">#</a> Verification</h4> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <p>After starting the above 3 applications, log in to ServiceComb backend <code>http://127.0.0.1:30103/</code> and check the Zookeeper node data, all of them can view the consumer and provider applications.</p> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <p>visit the application interface <code>http://localhost:28820/hello</code> several times to confirm whether the interface returns normally. If the interface returns successfully and the producer instances of the 2 registries can be accessed, it means the registration and migration are successful.</p> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <div class="el-image"><div class="el-image__placeholder"></div><!----></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/18/2023, 3:18:50 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/en/document/plugin/router.html" class="prev">
        Tag Router
      </a></span> <span class="next"><a href="/en/document/plugin/springboot-registry.html">
        SpringBoot Registry
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.56245a25.js" defer></script><script src="/assets/js/3.c22b673d.js" defer></script><script src="/assets/js/1.9e8b067b.js" defer></script><script src="/assets/js/42.d0f88052.js" defer></script><script src="/assets/js/14.7039f4a7.js" defer></script>
  </body>
</html>
