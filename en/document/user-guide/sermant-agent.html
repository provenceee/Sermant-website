<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Sermant-agent User Manual | Sermant</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/img/logo.svg">
    <meta name="description" content="A Proxyless Service Mesh Solution Based on Java Agent">
    
    <link rel="preload" href="/assets/css/0.styles.934e6042.css" as="style"><link rel="preload" href="/assets/js/app.56245a25.js" as="script"><link rel="preload" href="/assets/js/3.c22b673d.js" as="script"><link rel="preload" href="/assets/js/1.9e8b067b.js" as="script"><link rel="preload" href="/assets/js/50.91ee7d0a.js" as="script"><link rel="prefetch" href="/assets/js/10.ca8549df.js"><link rel="prefetch" href="/assets/js/11.6a8571e0.js"><link rel="prefetch" href="/assets/js/12.3caa9ab5.js"><link rel="prefetch" href="/assets/js/13.b1f0a423.js"><link rel="prefetch" href="/assets/js/14.7039f4a7.js"><link rel="prefetch" href="/assets/js/15.36703cc8.js"><link rel="prefetch" href="/assets/js/16.804e91c8.js"><link rel="prefetch" href="/assets/js/17.0f65b007.js"><link rel="prefetch" href="/assets/js/18.92d1be28.js"><link rel="prefetch" href="/assets/js/19.ce355d42.js"><link rel="prefetch" href="/assets/js/20.89bea0c7.js"><link rel="prefetch" href="/assets/js/21.945c9d2a.js"><link rel="prefetch" href="/assets/js/22.92e167cf.js"><link rel="prefetch" href="/assets/js/23.f67f4b5e.js"><link rel="prefetch" href="/assets/js/24.69a732d8.js"><link rel="prefetch" href="/assets/js/25.4876205d.js"><link rel="prefetch" href="/assets/js/26.6739bd0c.js"><link rel="prefetch" href="/assets/js/27.8e5c7da7.js"><link rel="prefetch" href="/assets/js/28.bfac4c9e.js"><link rel="prefetch" href="/assets/js/29.53aabd90.js"><link rel="prefetch" href="/assets/js/30.a9d9a2a9.js"><link rel="prefetch" href="/assets/js/31.60ffcf24.js"><link rel="prefetch" href="/assets/js/32.3173505b.js"><link rel="prefetch" href="/assets/js/33.545c5274.js"><link rel="prefetch" href="/assets/js/34.00264371.js"><link rel="prefetch" href="/assets/js/35.276e3817.js"><link rel="prefetch" href="/assets/js/36.b0d41169.js"><link rel="prefetch" href="/assets/js/37.2fad2a48.js"><link rel="prefetch" href="/assets/js/38.0aa576a4.js"><link rel="prefetch" href="/assets/js/39.4757bdce.js"><link rel="prefetch" href="/assets/js/4.94f1233f.js"><link rel="prefetch" href="/assets/js/40.416a30c0.js"><link rel="prefetch" href="/assets/js/41.fee59cd9.js"><link rel="prefetch" href="/assets/js/42.d0f88052.js"><link rel="prefetch" href="/assets/js/43.2be6fc39.js"><link rel="prefetch" href="/assets/js/44.16c1ffcf.js"><link rel="prefetch" href="/assets/js/45.9c66aab6.js"><link rel="prefetch" href="/assets/js/46.0c089932.js"><link rel="prefetch" href="/assets/js/47.6b16ba66.js"><link rel="prefetch" href="/assets/js/48.6f183f8c.js"><link rel="prefetch" href="/assets/js/49.8236e4a0.js"><link rel="prefetch" href="/assets/js/5.05c6b3e9.js"><link rel="prefetch" href="/assets/js/51.3890a4c6.js"><link rel="prefetch" href="/assets/js/52.76c23ee8.js"><link rel="prefetch" href="/assets/js/53.3b3b4ad4.js"><link rel="prefetch" href="/assets/js/54.8c695126.js"><link rel="prefetch" href="/assets/js/55.24d58397.js"><link rel="prefetch" href="/assets/js/56.a73657ef.js"><link rel="prefetch" href="/assets/js/57.4b02d6af.js"><link rel="prefetch" href="/assets/js/58.08717c67.js"><link rel="prefetch" href="/assets/js/59.e6514139.js"><link rel="prefetch" href="/assets/js/6.d82aff6e.js"><link rel="prefetch" href="/assets/js/60.5410266f.js"><link rel="prefetch" href="/assets/js/61.59e38702.js"><link rel="prefetch" href="/assets/js/62.96273134.js"><link rel="prefetch" href="/assets/js/63.807a4412.js"><link rel="prefetch" href="/assets/js/64.fd39dc04.js"><link rel="prefetch" href="/assets/js/65.afef1e74.js"><link rel="prefetch" href="/assets/js/66.3a7aeeab.js"><link rel="prefetch" href="/assets/js/67.42b5b39d.js"><link rel="prefetch" href="/assets/js/68.dab77e43.js"><link rel="prefetch" href="/assets/js/69.59b843c2.js"><link rel="prefetch" href="/assets/js/7.0aa4fbf2.js"><link rel="prefetch" href="/assets/js/70.ea2db599.js"><link rel="prefetch" href="/assets/js/71.dd9084fc.js"><link rel="prefetch" href="/assets/js/72.4828d1d6.js"><link rel="prefetch" href="/assets/js/73.b644410d.js"><link rel="prefetch" href="/assets/js/74.7626c55a.js"><link rel="prefetch" href="/assets/js/75.7fb65875.js"><link rel="prefetch" href="/assets/js/76.899c626b.js"><link rel="prefetch" href="/assets/js/77.90d41e21.js"><link rel="prefetch" href="/assets/js/78.edaa0b7b.js"><link rel="prefetch" href="/assets/js/79.e9e1e72a.js"><link rel="prefetch" href="/assets/js/8.fe2e589f.js"><link rel="prefetch" href="/assets/js/80.b2cde3fe.js"><link rel="prefetch" href="/assets/js/81.90984771.js"><link rel="prefetch" href="/assets/js/82.ea554216.js"><link rel="prefetch" href="/assets/js/83.0e507f62.js"><link rel="prefetch" href="/assets/js/84.5306af9d.js"><link rel="prefetch" href="/assets/js/85.57b25843.js"><link rel="prefetch" href="/assets/js/86.3aefe1fd.js"><link rel="prefetch" href="/assets/js/87.cc73ef62.js"><link rel="prefetch" href="/assets/js/88.f36833ec.js"><link rel="prefetch" href="/assets/js/89.73f38fbd.js"><link rel="prefetch" href="/assets/js/9.623da9fe.js">
    <link rel="stylesheet" href="/assets/css/0.styles.934e6042.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/en/" class="home-link router-link-active"><img src="/img/sermant-logo.png" alt="Sermant" class="logo"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/en/document/" class="nav-link">
  Document
</a></div><div class="nav-item"><a href="/en/blog/" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="https://github.com/huaweicloud/Sermant" target="_blank" class="nav-link external">
  Github
  <!----></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/document/user-guide/sermant-agent.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/en/document/user-guide/sermant-agent.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li></ul></div></div> <div class="nav-item"><!----></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/en/document/" class="nav-link">
  Document
</a></div><div class="nav-item"><a href="/en/blog/" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="https://github.com/huaweicloud/Sermant" target="_blank" class="nav-link external">
  Github
  <!----></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/document/user-guide/sermant-agent.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/en/document/user-guide/sermant-agent.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li></ul></div></div> <div class="nav-item"><!----></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Start</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>User Guide</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/en/document/user-guide/" aria-current="page" class="sidebar-link">Introduction to the use of Sermant</a></li><li><a href="/en/document/user-guide/sermant-agent.html" aria-current="page" class="active sidebar-link">Sermant-agent User Manual</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/en/document/user-guide/sermant-agent.html#parameter-configuration" class="sidebar-link">Parameter Configuration</a></li><li class="sidebar-sub-header"><a href="/en/document/user-guide/sermant-agent.html#versions-supported" class="sidebar-link">Versions Supported</a></li><li class="sidebar-sub-header"><a href="/en/document/user-guide/sermant-agent.html#startup-and-result-validation" class="sidebar-link">Startup and Result Validation</a></li></ul></li><li><a href="/en/document/user-guide/backend.html" class="sidebar-link">Backend User Manual</a></li><li><a href="/en/document/user-guide/configuration-center.html" class="sidebar-link">Dynamic Configuration Center User Manual</a></li><li><a href="/en/document/user-guide/injector.html" class="sidebar-link">Sermant-injector User Manual</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Plugin Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Developer Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Community Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>FAQ</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="sermant-agent-user-manual"><a href="#sermant-agent-user-manual" class="header-anchor">#</a> Sermant-agent User Manual</h1> <p>Sermant-agent is the essential core component of Sermant, which contains bytecode enhancements of <a href="https://github.com/huaweicloud/Sermant/tree/develop/sermant-agentcore" target="_blank" rel="noopener noreferrer">sermant-agentcore<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="https://gIthub.com/huaweicloud/Sermant/tree/develop/sermant-plugins" target="_blank" rel="noopener noreferrer">sermant-plugins<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="https://github.com/huaweicloud/Sermant/tree/develop/sermant-common" target="_blank" rel="noopener noreferrer">sermant-common<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. The modules of the sermant-agent component are found in the <code>sermant-agent-x.x.x/agent</code> directory described in the <a href="/en/document/user-guide/" class="router-link-active">Sermant Introduction</a>. This article describes how to use sermant-agent.</p> <p>The framework body of sermant-agent provides bytecode enhanced implementation logic for Sermant, and supports common core capabilities such as heartbeat function, dynamic configuration function and log function. In the sermant-agent plugin package, the extension plugins provide the service governance capabilities such as label routing, flow control and double registration.</p> <h2 id="parameter-configuration"><a href="#parameter-configuration" class="header-anchor">#</a> Parameter Configuration</h2> <p>Specify <code>sermant-agent.jar</code> via the <code>-javaagent</code> parameter when a Java program (Java class with a main function) is running. <code>sermant-agent.jar</code> is deposited in <code>agent/sermant-agent.jar</code> of sermant-agent pruduct package.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>-javaagent:sermant-agent.jar<span class="token punctuation">[</span><span class="token operator">=</span><span class="token variable">${options}</span><span class="token punctuation">]</span>
</code></pre></div><p>Where <code>${options}</code> is the launch input parameter, which will be transferred as the parameter <code>agentArgs</code> to the <code>premain</code> method.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">premain</span><span class="token punctuation">(</span><span class="token class-name">String</span> agentArgs<span class="token punctuation">,</span> <span class="token class-name">Instrumentation</span> inst<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The format of the <code>agentArgs</code> parameter should look like <code>key1=value1,key2=value2[(,keyN=valueN)...]</code>, which splits key/value pairs with <code>','</code>, and splits between key and value with <code>'='</code> 'to form a <code>Map</code> structure.</p> <h3 id="sermant-agent-startup-parameters"><a href="#sermant-agent-startup-parameters" class="header-anchor">#</a> Sermant-agent Startup Parameters</h3> <p>The <strong>startup parameters</strong> are listed as follows:</p> <table><thead><tr><th style="text-align:center;">Key in Input Parameters</th> <th style="text-align:center;">Description</th> <th style="text-align:center;">Default Value</th> <th style="text-align:center;">Required</th></tr></thead> <tbody><tr><td style="text-align:center;">appName</td> <td style="text-align:center;">The name of host application, can be used for instance heartbeat sending, etc</td> <td style="text-align:center;">default</td> <td style="text-align:center;">False</td></tr> <tr><td style="text-align:center;">instanceName</td> <td style="text-align:center;">The name of the specific instance, can be used for instance heartbeat sending, etc</td> <td style="text-align:center;">default</td> <td style="text-align:center;">False</td></tr> <tr><td style="text-align:center;">appType</td> <td style="text-align:center;">The type of host application, can be used for instance heartbeat sending, etc</td> <td style="text-align:center;">0</td> <td style="text-align:center;">False</td></tr></tbody></table> <p>The <code>agentArgs</code> parameter allows you to configure more custom values for <strong>startup parameters</strong>.</p> <p>In addition, the startup parameters can also be configured in <code>agent/config/bootstrap properties</code> in the product package of sermant-agent, which are consistent with the parameters above and also supports custom startup parameters.</p> <h3 id="sermant-agent-parameter-configuration"><a href="#sermant-agent-parameter-configuration" class="header-anchor">#</a> Sermant-agent Parameter Configuration</h3> <p>All other configurations beside plugin configurations are configured in the <code>agent/config/config.properties</code> of the sermant-agent product package. Please refer to the <a href="https://sermant.io/zh/document/plugin/" target="_blank" rel="noopener noreferrer">Plugin Guide<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for configurations of each plugin.</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token comment"># agent config</span>
<span class="token key attr-name">agent.config.isEnhanceBootStrapEnable</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">agent.config.ignoredPrefixes</span><span class="token punctuation">=</span><span class="token value attr-value">com.huawei.sermant,com.huaweicloud.sermant</span>
<span class="token key attr-name">agent.config.ignoredInterfaces</span><span class="token punctuation">=</span><span class="token value attr-value">org.springframework.cglib.proxy.Factory</span>
<span class="token key attr-name">agent.config.combineStrategy</span><span class="token punctuation">=</span><span class="token value attr-value">ALL</span>
<span class="token key attr-name">agent.config.serviceBlackList</span><span class="token punctuation">=</span><span class="token value attr-value">com.huaweicloud.sermant.implement.service.heartbeat.HeartbeatServiceImpl,com.huaweicloud.sermant.implement.service.send.NettyGatewayClient,com.huaweicloud.sermant.implement.service.tracing.TracingServiceImpl</span>
<span class="token key attr-name">agent.config.serviceInjectList</span><span class="token punctuation">=</span><span class="token value attr-value">com.huawei.discovery.service.lb.filter.NopInstanceFilter,com.huawei.discovery.service.lb.DiscoveryManager</span>
<span class="token key attr-name">agent.config.isShowEnhanceLogEnable</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">agent.config.enhancedClassOutputPath</span><span class="token punctuation">=</span>

<span class="token comment"># dynamic config</span>
<span class="token key attr-name">dynamic.config.timeoutValue</span><span class="token punctuation">=</span><span class="token value attr-value">30000</span>
<span class="token key attr-name">dynamic.config.defaultGroup</span><span class="token punctuation">=</span><span class="token value attr-value">sermant</span>
<span class="token key attr-name">dynamic.config.serverAddress</span><span class="token punctuation">=</span><span class="token value attr-value">127.0.0.1:2181</span>
<span class="token key attr-name">dynamic.config.dynamicConfigType</span><span class="token punctuation">=</span><span class="token value attr-value">ZOOKEEPER</span>
<span class="token key attr-name">dynamic.config.connectRetryTimes</span><span class="token punctuation">=</span><span class="token value attr-value">5</span>
<span class="token key attr-name">dynamic.config.connectTimeout</span><span class="token punctuation">=</span><span class="token value attr-value">1000</span>
<span class="token key attr-name">dynamic.config.userName</span><span class="token punctuation">=</span>
<span class="token key attr-name">dynamic.config.password</span><span class="token punctuation">=</span>
<span class="token key attr-name">dynamic.config.privateKey</span><span class="token punctuation">=</span>
<span class="token key attr-name">dynamic.config.enableAuth</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>

<span class="token comment"># heartbeat config</span>
<span class="token key attr-name">heartbeat.interval</span><span class="token punctuation">=</span><span class="token value attr-value">30000</span>

<span class="token comment"># backend config</span>
<span class="token key attr-name">backend.nettyIp</span><span class="token punctuation">=</span><span class="token value attr-value">127.0.0.1</span>
<span class="token key attr-name">backend.nettyPort</span><span class="token punctuation">=</span><span class="token value attr-value">6888</span>

<span class="token comment"># service meta config</span>
<span class="token key attr-name">service.meta.application</span><span class="token punctuation">=</span><span class="token value attr-value">default</span>
<span class="token key attr-name">service.meta.version</span><span class="token punctuation">=</span><span class="token value attr-value">1.0.0</span>
<span class="token key attr-name">service.meta.project</span><span class="token punctuation">=</span><span class="token value attr-value">default</span>
<span class="token key attr-name">service.meta.environment</span><span class="token punctuation">=</span>
<span class="token key attr-name">service.meta.zone</span><span class="token punctuation">=</span>
<span class="token key attr-name">service.meta.parameters</span><span class="token punctuation">=</span>

<span class="token comment"># service visibility config</span>
<span class="token key attr-name">visibility.service.enableStart</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
</code></pre></div><p>The parameters involved are associated with sermant-agent, Backend, Dynamic Configuration Center, etc. Refer to the following tables for specific parameter configurations.</p> <h4 id="parameters-related-to-agent-framework"><a href="#parameters-related-to-agent-framework" class="header-anchor">#</a> Parameters Related to Agent Framework</h4> <table><thead><tr><th style="text-align:center;"><span style="display:inline-block;width:100px;">Parameter Key</span></th> <th style="text-align:center;"><span style="display:inline-block;width:120px;">Description</span></th> <th style="text-align:center;"><span style="display:inline-block;width:70px;">Parameter Category</span></th> <th style="text-align:center;">Default Value</th> <th style="text-align:center;">Required</th></tr></thead> <tbody><tr><td style="text-align:center;">agent.config.isEnhanceBootStrapEnable</td> <td style="text-align:center;">Switch for enhancement of classes loaded by the bootstrap classloader</td> <td style="text-align:center;">Agent</td> <td style="text-align:center;">false</td> <td style="text-align:center;">False</td></tr> <tr><td style="text-align:center;">agent.config.ignoredPrefixes</td> <td style="text-align:center;">Ignored class set, where the fully qualified name prefixes defined in this set are used to exclude classes that are ignored during the enhancement process</td> <td style="text-align:center;">Agent</td> <td style="text-align:center;">com.huawei.sermant,com.huaweicloud.sermant</td> <td style="text-align:center;">False</td></tr> <tr><td style="text-align:center;">agent.config.ignoredInterfaces</td> <td style="text-align:center;">Ignored interface set, where the fully qualified name prefixes defined in this set are used to exclude interfaces that are ignored during the enhancement process</td> <td style="text-align:center;">Agent</td> <td style="text-align:center;">org.springframework.cglib.proxy.Factory</td> <td style="text-align:center;">False</td></tr> <tr><td style="text-align:center;">agent.config.combineStrategy</td> <td style="text-align:center;">Plugin declarator merge policy: NONE, no merge; BY_NAME, coalesced by matching class names; ALL, all merge</td> <td style="text-align:center;">Agent</td> <td style="text-align:center;">ALL</td> <td style="text-align:center;">False</td></tr> <tr><td style="text-align:center;">agent.config.serviceBlackList</td> <td style="text-align:center;">Sermant-agent core functionality blacklist to disable related services</td> <td style="text-align:center;">Agent</td> <td style="text-align:center;">com.huaweicloud.sermant.implement.service.heartbeat.HeartbeatServiceImpl<br>,com.huaweicloud.sermant.implement.service.send.NettyGatewayClient<br>,com.huaweicloud.sermant.implement.service.tracing.TracingServiceImpl</td> <td style="text-align:center;">False</td></tr> <tr><td style="text-align:center;">agent.config.serviceInjectList</td> <td style="text-align:center;">List of service in plugin to be intercepted</td> <td style="text-align:center;">Agent</td> <td style="text-align:center;">com.huawei.discovery.service.lb.filter.NopInstanceFilter<br>,com.huawei.discovery.service.lb.DiscoveryManager</td> <td style="text-align:center;">False</td></tr> <tr><td style="text-align:center;">agent.config.isShowEnhanceLogEnable</td> <td style="text-align:center;">Whether to output retrieval logs during enhancement</td> <td style="text-align:center;">Agent</td> <td style="text-align:center;">false</td> <td style="text-align:center;">False</td></tr> <tr><td style="text-align:center;">agent.config.enhancedClassOutputPath</td> <td style="text-align:center;">The output path of the enhanced classed</td> <td style="text-align:center;">Agent</td> <td style="text-align:center;">-</td> <td style="text-align:center;">False</td></tr></tbody></table> <h4 id="parameters-related-to-dynamic-configuration-center"><a href="#parameters-related-to-dynamic-configuration-center" class="header-anchor">#</a> Parameters Related to Dynamic Configuration Center</h4> <table><thead><tr><th style="text-align:center;"><span style="display:inline-block;width:100px;">Parameter Key</span></th> <th style="text-align:center;"><span style="display:inline-block;width:80px;">Description</span></th> <th style="text-align:center;">Parameter Category</th> <th style="text-align:center;">Default Value</th> <th style="text-align:center;">Required</th></tr></thead> <tbody><tr><td style="text-align:center;">dynamic.config.timeoutValue</td> <td style="text-align:center;">Dynamic configuration center server connection timeout, in ms</td> <td style="text-align:center;">Dynamic Configuration Center</td> <td style="text-align:center;">30000</td> <td style="text-align:center;">True</td></tr> <tr><td style="text-align:center;">dynamic.config.defaultGroup</td> <td style="text-align:center;">Dynamic configuration default group</td> <td style="text-align:center;">Dynamic Configuration Center</td> <td style="text-align:center;">sermant</td> <td style="text-align:center;">True</td></tr> <tr><td style="text-align:center;">dynamic.config.serverAddress</td> <td style="text-align:center;">Dynamic configuration center server address, configured like: {@code host:port[(,host:port)...]}</td> <td style="text-align:center;">Dynamic Configuration Center</td> <td style="text-align:center;">127.0.0.1:2181</td> <td style="text-align:center;">True</td></tr> <tr><td style="text-align:center;">dynamic.config.dynamicConfigType</td> <td style="text-align:center;">Dynamic config type: NOP、ZOOKEEPER、KIE</td> <td style="text-align:center;">Dynamic Configuration Center</td> <td style="text-align:center;">ZOOKEEPER</td> <td style="text-align:center;">True</td></tr> <tr><td style="text-align:center;">dynamic.config.connectRetryTimes</td> <td style="text-align:center;">Dynamic configuration center ZOOKEEPER: the number of configuration center reconnects when starting the Sermant</td> <td style="text-align:center;">Dynamic Configuration Center</td> <td style="text-align:center;">5</td> <td style="text-align:center;">True</td></tr> <tr><td style="text-align:center;">dynamic.config.connectTimeout</td> <td style="text-align:center;">Dynamic configuration center ZOOKEEPER: connection timeout to the configuration center when starting the Sermant</td> <td style="text-align:center;">Dynamic Configuration Center</td> <td style="text-align:center;">1000</td> <td style="text-align:center;">True</td></tr> <tr><td style="text-align:center;">dynamic.config.userName</td> <td style="text-align:center;">Dynamic configuration center ZOOKEEPER：user name</td> <td style="text-align:center;">Dynamic Configuration Center</td> <td style="text-align:center;">-</td> <td style="text-align:center;">False</td></tr> <tr><td style="text-align:center;">dynamic.config.password</td> <td style="text-align:center;">Dynamic configuration center ZOOKEEPER：password after encryption</td> <td style="text-align:center;">Dynamic Configuration Center</td> <td style="text-align:center;">-</td> <td style="text-align:center;">False</td></tr> <tr><td style="text-align:center;">dynamic.config.privateKey</td> <td style="text-align:center;">Dynamic configuration center ZOOKEEPER：decryption key</td> <td style="text-align:center;">Dynamic Configuration Center</td> <td style="text-align:center;">-</td> <td style="text-align:center;">False</td></tr> <tr><td style="text-align:center;">dynamic.config.enableAuth</td> <td style="text-align:center;">Dynamic configuration center ZOOKEEPER：authorization switch</td> <td style="text-align:center;">Dynamic Configuration Center</td> <td style="text-align:center;">false</td> <td style="text-align:center;">False</td></tr></tbody></table> <h4 id="parameters-related-to-backend"><a href="#parameters-related-to-backend" class="header-anchor">#</a> Parameters Related to Backend</h4> <table><thead><tr><th style="text-align:center;"><span style="display:inline-block;width:100px;">Parameter Key</span></th> <th style="text-align:center;"><span style="display:inline-block;width:200px;">Description</span></th> <th style="text-align:center;">Parameter Category</th> <th style="text-align:center;">Default Value</th> <th style="text-align:center;">Required</th></tr></thead> <tbody><tr><td style="text-align:center;">heartbeat.interval</td> <td style="text-align:center;">Heartbeat send interval in millisecond</td> <td style="text-align:center;">Backend</td> <td style="text-align:center;">30000</td> <td style="text-align:center;">False</td></tr> <tr><td style="text-align:center;">backend.nettyIp</td> <td style="text-align:center;">Backend message receiving address</td> <td style="text-align:center;">Backend</td> <td style="text-align:center;">127.0.0.1</td> <td style="text-align:center;">False</td></tr> <tr><td style="text-align:center;">backend.nettyPort</td> <td style="text-align:center;">Backend message receiving port</td> <td style="text-align:center;">Backend</td> <td style="text-align:center;">6888</td> <td style="text-align:center;">False</td></tr></tbody></table> <h4 id="parameters-related-to-service-metadata"><a href="#parameters-related-to-service-metadata" class="header-anchor">#</a> Parameters Related to Service Metadata</h4> <table><thead><tr><th style="text-align:center;"><span style="display:inline-block;width:100px;">Parameter Key</span></th> <th style="text-align:center;"><span style="display:inline-block;width:200px;">Description</span></th> <th style="text-align:center;">Parameter Category</th> <th style="text-align:center;">Default Value</th> <th style="text-align:center;">Required</th></tr></thead> <tbody><tr><td style="text-align:center;">service.meta.application</td> <td style="text-align:center;">Application name, can be used in service governance scenarios such as service registration.</td> <td style="text-align:center;">Service Metadata</td> <td style="text-align:center;">default</td> <td style="text-align:center;">False</td></tr> <tr><td style="text-align:center;">service.meta.version</td> <td style="text-align:center;">Service version, can be used in service governance scenarios such as service registration and label routing.</td> <td style="text-align:center;">Service Metadata</td> <td style="text-align:center;">1.0.0</td> <td style="text-align:center;">False</td></tr> <tr><td style="text-align:center;">service.meta.project</td> <td style="text-align:center;">Service namespace, can be used in service governance scenarios such as service registration.</td> <td style="text-align:center;">Service Metadata</td> <td style="text-align:center;">default</td> <td style="text-align:center;">False</td></tr> <tr><td style="text-align:center;">service.meta.environment</td> <td style="text-align:center;">Service environment, can be used in service governance scenarios such as service registration.</td> <td style="text-align:center;">Service Metadata</td> <td style="text-align:center;">-</td> <td style="text-align:center;">False</td></tr> <tr><td style="text-align:center;">service.meta.zone</td> <td style="text-align:center;">Az that service locates, can be used in service governance scenarios such as service registration and label routing.</td> <td style="text-align:center;">Service Metadata</td> <td style="text-align:center;">-</td> <td style="text-align:center;">False</td></tr> <tr><td style="text-align:center;">service.meta.parameters</td> <td style="text-align:center;">Service extra parameters.The value is in the form of key:value. Multiple key-value pairs are separated by commas (,). It is used in service governance scenarios, such as service registration and label routing.</td> <td style="text-align:center;">Service Metadata</td> <td style="text-align:center;">-</td> <td style="text-align:center;">False</td></tr></tbody></table> <h4 id="plugin-related-parameters"><a href="#plugin-related-parameters" class="header-anchor">#</a> Plugin related parameters</h4> <table><thead><tr><th style="text-align:center;"><span style="display:inline-block;width:100px;">Parameter Key</span></th> <th style="text-align:center;"><span style="display:inline-block;width:200px;">Description</span></th> <th style="text-align:center;">Parameter Category</th> <th>Default Value</th> <th style="text-align:center;">Required</th></tr></thead> <tbody><tr><td style="text-align:center;">visibility.service.enableStart</td> <td style="text-align:center;">Service visibility information reset switch, when agentCore reconnects with Netty, it will push full service visibility data</td> <td style="text-align:center;">Plugin parameters</td> <td>False</td> <td style="text-align:center;">False</td></tr></tbody></table> <h3 id="sermant-agent-mounted-plugins-configuration"><a href="#sermant-agent-mounted-plugins-configuration" class="header-anchor">#</a> Sermant-agent Mounted Plugins Configuration</h3> <p>You can configure which plugins to be mounted by Sermant in <code>agent/config/plugins.yaml</code> of sermant-agent product package.For example:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">plugins</span><span class="token punctuation">:</span>                 <span class="token comment"># You can customize the plugins to be mounted by default</span>
  <span class="token punctuation">-</span> flowcontrol
  <span class="token punctuation">-</span> service<span class="token punctuation">-</span>router
  <span class="token punctuation">-</span> service<span class="token punctuation">-</span>registry
  <span class="token punctuation">-</span> loadbalancer
  <span class="token punctuation">-</span> dynamic<span class="token punctuation">-</span>config
  <span class="token punctuation">-</span> monitor
  <span class="token punctuation">-</span> springboot<span class="token punctuation">-</span>registry
  <span class="token punctuation">-</span> mq<span class="token punctuation">-</span>consume<span class="token punctuation">-</span>deny
<span class="token key atrule">profiles</span><span class="token punctuation">:</span>                <span class="token comment"># You can configure the list of plugins mounted of each profile</span>
  <span class="token key atrule">cse</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> flowcontrol
    <span class="token punctuation">-</span> service<span class="token punctuation">-</span>router
    <span class="token punctuation">-</span> service<span class="token punctuation">-</span>registry
    <span class="token punctuation">-</span> dynamic<span class="token punctuation">-</span>config
  <span class="token key atrule">apm</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> flowcontrol
    <span class="token punctuation">-</span> service<span class="token punctuation">-</span>router
<span class="token key atrule">profile</span><span class="token punctuation">:</span> cse<span class="token punctuation">,</span>apm         <span class="token comment"># Profile is used to configure the list of mounted plugins by scenario. You can configure the in effect</span>
</code></pre></div><p>The parameters are described as follows:</p> <table><thead><tr><th style="text-align:center;">Parameter Key</th> <th style="text-align:center;">Description</th> <th style="text-align:center;">Required</th></tr></thead> <tbody><tr><td style="text-align:center;">plugins</td> <td style="text-align:center;">Configure the default plugins to be mounted in a list</td> <td style="text-align:center;">True</td></tr> <tr><td style="text-align:center;">profiles</td> <td style="text-align:center;">Customize the list of plugins to be mounted in different scenarios</td> <td style="text-align:center;">False</td></tr> <tr><td style="text-align:center;">profile</td> <td style="text-align:center;">Customize the names of the scenario to be loaded</td> <td style="text-align:center;">False</td></tr></tbody></table> <p>Any plugins configured in <code>plugins</code> will be mounted to the host application at startup. The list of plugins in <code>profile</code> can also be configured on demand.</p> <p><strong>Loading order of plugins</strong></p> <p>The Sermant plugin loads in the following order:</p> <ol><li><p>First load the default plugins in the order configured in <code>plugin</code>.</p></li> <li><p>Then load the scenario plugin list according to the scenario sequence configured in profile. The scenario plugin loading sequence is the same as that in the configuration file.</p></li> <li><p>If the plugin configured in <code>profiles</code> has been loaded before, it will not be loaded again.</p></li> <li><p>Bytecode enhancements at the same interception point for different plugins <strong>take effect in the same order as plugin loading</strong>.</p></li></ol> <h3 id="parameter-configuration-options"><a href="#parameter-configuration-options" class="header-anchor">#</a> Parameter Configuration Options</h3> <p>The sermant project's properties configuration file and yaml configuration file for sermant-agent plugins support the following configuration options. Take <code>backend.nettyIp=127.0.0.1</code> in the configuration file for example:</p> <ol><li>Modify the configuration file directly, via configure <code>backend.nettyIp=127.0.0.1</code> in the configuration file.</li> <li>Configure the -D option at startup, like: <code>-Dbackend.nettyIp=127.0.0.1</code>.</li> <li>Configure via environment variables, via add <code>backend.nettyIp=127.0.0.1</code> to environment variables.</li> <li>Configure startup parameters of sermant-agent, like: <code>-javaagent:sermant-agent.jar=backend.nettyIp=127.0.0.1</code></li></ol> <p>The configuration takes effect in descending order of priority: 4 &gt; 3 &gt; 2 &gt; 1.</p> <p>The last three ways to obtain configuration parameters support various formats. Take <code>backend.nettyIp=127.0.0.1</code> in the configuration file for example, the following configuration formats can be identified:</p> <div class="language-txt extra-class"><pre class="language-txt"><code>backend.nettyIp=127.0.0.1
backend_nettyIp=127.0.0.1
backend-nettyIp=127.0.0.1
BACKEND.NETTYIP=127.0.0.1
BACKEND_NETTYIP=127.0.0.1
BACKEND-NETTYIP=127.0.0.1
backend.nettyip=127.0.0.1
backend_nettyip=127.0.0.1
backend-nettyip=127.0.0.1
backend.netty.ip=127.0.0.1
backend_netty_ip=127.0.0.1
backend-netty-ip=127.0.0.1
BACKEND.NETTY.IP=127.0.0.1
BACKEND_NETTY_IP=127.0.0.1
BACKEND-NETTY-IP=127.0.0.1
</code></pre></div><p>The sermant-agent retrieves, from top to bottom, whether the configuration values are configured by startup parameter, the environment variable, and the -D parameter.</p> <h2 id="versions-supported"><a href="#versions-supported" class="header-anchor">#</a> Versions Supported</h2> <p>Sermant-agent supports Linux, Windows, and Aix operating systems, supports JDK 1.6 and above, and recommends using JDK 1.8.</p> <p><a href="https://gitee.com/openeuler/bishengjdk-8" target="_blank" rel="noopener noreferrer">HuaweiJDK 1.8<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> / <a href="https://github.com/openjdk/jdk" target="_blank" rel="noopener noreferrer">OpenJDK 1.8<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> / <a href="https://www.oracle.com/java/technologies/downloads/" target="_blank" rel="noopener noreferrer">OracleJDK 1.8<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="startup-and-result-validation"><a href="#startup-and-result-validation" class="header-anchor">#</a> Startup and Result Validation</h2> <h3 id="startup"><a href="#startup" class="header-anchor">#</a> Startup</h3> <p>Start with a <strong>Sermant-example</strong> project [demo-application] (https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/demo-application) as the host application, execute the following command to mount the sermant-agent and start demo-application:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># Run under Windows</span>
<span class="token function">java</span> -javaagent:sermant-agent-x.x.x<span class="token punctuation">\</span>agent<span class="token punctuation">\</span>sermant-agent.jar<span class="token operator">=</span>appName<span class="token operator">=</span>test <span class="token parameter variable">-jar</span> demo-application.jar
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># Run under Linux</span>
<span class="token function">java</span> -javaagent:sermant-agent-x.x.x/agent/sermant-agent.jar<span class="token operator">=</span>appName<span class="token operator">=</span>test <span class="token parameter variable">-jar</span> demo-application.jar
</code></pre></div><h3 id="validation"><a href="#validation" class="header-anchor">#</a> Validation</h3> <p>Check to see if the log file for demo-application starts with the following:</p> <div class="language- extra-class"><pre class="language-text"><code>[INFO] Loading core library... 
[INFO] Building argument map... 
[INFO] Loading sermant agent... 
[INFO] Load sermant done. 
</code></pre></div><p>If the log output is normal, then the sermant-agent was mounted successfully.</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/18/2023, 3:18:50 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/en/document/user-guide/" class="prev router-link-active">
        Introduction to the use of Sermant
      </a></span> <span class="next"><a href="/en/document/user-guide/backend.html">
        Backend User Manual
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.56245a25.js" defer></script><script src="/assets/js/3.c22b673d.js" defer></script><script src="/assets/js/1.9e8b067b.js" defer></script><script src="/assets/js/50.91ee7d0a.js" defer></script>
  </body>
</html>
