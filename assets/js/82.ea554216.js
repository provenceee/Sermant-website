(window.webpackJsonp=window.webpackJsonp||[]).push([[82],{529:function(t,a,e){"use strict";e.r(a);var s=e(26),r=Object(s.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"服务可见性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务可见性"}},[t._v("#")]),t._v(" 服务可见性")]),t._v(" "),a("p",[t._v("本文介绍如何使用"),a("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/tree/develop/sermant-plugins/sermant-service-visibility",target:"_blank",rel:"noopener noreferrer"}},[t._v("服务可见性插件"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("h2",{attrs:{id:"术语"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#术语"}},[t._v("#")]),t._v(" 术语")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("术语")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("契约信息")]),t._v(" "),a("td",[t._v("服务对外提供的接口信息，包括接口所属类、请求路径、方法名、参数列表、返回类型")])]),t._v(" "),a("tr",[a("td",[t._v("调用依赖关系信息")]),t._v(" "),a("td",[t._v("服务之间的调用关系信息，包括服务提供者和服务消费者的IP、端口信息")])])])]),t._v(" "),a("h2",{attrs:{id:"功能介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#功能介绍"}},[t._v("#")]),t._v(" 功能介绍")]),t._v(" "),a("p",[t._v("服务可见性插件可以采集Spring Cloud和Dubbo应用的契约信息和调用依赖关系，在不修改代码的前提下可以通过Backend查看所有服务对外提供的接口信息以及服务之间的调用关系信息。")]),t._v(" "),a("p",[t._v("本插件基于Spring Cloud和Dubbo应用的服务注册、服务订阅等功能完成服务注册的接口信息以及服务订阅时的提供者信息的采集，以便于用户统一管理。")]),t._v(" "),a("h2",{attrs:{id:"参数配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参数配置"}},[t._v("#")]),t._v(" 参数配置")]),t._v(" "),a("h3",{attrs:{id:"sermant-agent配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sermant-agent配置"}},[t._v("#")]),t._v(" Sermant-agent配置")]),t._v(" "),a("p",[t._v("服务可见性插件需要在Sermant-agent中配置黑名单（"),a("code",[t._v("agent.config.serviceBlackList")]),t._v("）、配置服务元数据（"),a("code",[t._v("service.meta.*")]),t._v("）以及开启服务可见性重连开关("),a("code",[t._v("visibility.service.enableStart")]),t._v(")，具体参考"),a("RouterLink",{attrs:{to:"/zh/document/user-guide/sermant-agent.html#sermant-agent使用参数配置"}},[t._v("Sermant-agent使用手册")]),t._v("。")],1),t._v(" "),a("ul",[a("li",[t._v("agent.config.serviceBlackList：黑名单配置，控制基础功能是否开启。可见性插件依赖于消息发送功能（插件通过消息发送功能将采集到的信息发送给Backend进行展示）和心跳功能（监听服务是否下线，服务下线时不展示该服务的信息），因此需要删除HeartbeatServiceImpl和NettyGatewayClient，保证插件正常生效。")]),t._v(" "),a("li",[t._v("service.meta.*：服务元数据信息。例如：组名、版本号、区域等。服务可见性插件采集元数据信息用于页面展示。")]),t._v(" "),a("li",[t._v("visibility.service.enableStart：服务可见性重连开关配置。防止Backend重启后数据丢失。开关为true时，Backend如果重连，会重新给Backend发送当前服务的信息，保证数据完整性。")])]),t._v(" "),a("h3",{attrs:{id:"插件配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#插件配置"}},[t._v("#")]),t._v(" 插件配置")]),t._v(" "),a("p",[t._v("服务可见性插件需要开启采集开关，可在"),a("code",[t._v("${path}/sermant-agent-x.x.x/agent/pluginPackage/service-visibility/config/config.yaml")]),t._v("找到该插件的配置文件，配置如下所示：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("visibility.config")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("startFlag")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 服务可见性采集开关。控制是否需要进行指标采集上报。为true时插件进行数据采集上报，为false时则不进行数据采集上报。")]),t._v("\n")])])]),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("参数键")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("说明")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("默认值")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("是否必须")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("visibility.config.startFlag")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("服务可见性采集开关")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("false")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("是")])])])]),t._v(" "),a("h2",{attrs:{id:"支持版本与限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#支持版本与限制"}},[t._v("#")]),t._v(" 支持版本与限制")]),t._v(" "),a("p",[t._v("框架支持：")]),t._v(" "),a("ul",[a("li",[t._v("SpringBoot 1.5.10.Release及以上")]),t._v(" "),a("li",[t._v("Dubbo 2.6.x-2.7.x")])]),t._v(" "),a("h2",{attrs:{id:"操作和结果验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#操作和结果验证"}},[t._v("#")]),t._v(" 操作和结果验证")]),t._v(" "),a("p",[t._v("下面将演示如何使用服务可见性插件，验证采集Dubbo应用的契约和调用依赖关系信息场景。")]),t._v(" "),a("h3",{attrs:{id:"准备工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[t._v("#")]),t._v(" 准备工作")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/releases",target:"_blank",rel:"noopener noreferrer"}},[t._v("下载"),a("OutboundLink")],1),t._v("/编译Sermant包")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/tree/develop/sermant-integration-tests/dubbo-test",target:"_blank",rel:"noopener noreferrer"}},[t._v("下载"),a("OutboundLink")],1),t._v("dubbo-test源码")])]),t._v(" "),a("blockquote",[a("p",[t._v("注意："),a("RouterLink",{attrs:{to:"/zh/document/user-guide/configuration-center.html"}},[t._v("动态配置中心")]),t._v("会在本场景中默认使用，由于非本场景的核心组件，因此在本文中不额外赘述。")],1)]),t._v(" "),a("h3",{attrs:{id:"步骤一-修改配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤一-修改配置"}},[t._v("#")]),t._v(" 步骤一：修改配置")]),t._v(" "),a("ul",[a("li",[t._v("修改Sermant-agent配置\n在"),a("code",[t._v("${path}/sermant-agent-x.x.x/agent/config/config.properties")]),t._v("找到该配置文件，修改的配置项如下所示：")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[t._v("agent.config.serviceBlackList=              "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 黑名单配置，删除配置的HeartbeatServiceImpl和NettyGatewayClient。")]),t._v("\nvisibility.service.flag=true                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 服务可见性重连开关（用于backend重连时将全部信息发送给backend，防止backend重启后数据丢失）。")]),t._v("\n")])])]),a("ul",[a("li",[t._v("修改服务可见性插件配置\n在"),a("code",[t._v("${path}/sermant-agent-x.x.x/agent/pluginPackage/service-visibility/config/config.yaml")]),t._v("找到该插件的配置文件， 修改的配置项如下所示：")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("visibility.config")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("startFlag")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 服务可见性采集开关。为true时进行数据采集上报。")]),t._v("\n")])])]),a("h3",{attrs:{id:"步骤二-编译打包dubbo-test应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤二-编译打包dubbo-test应用"}},[t._v("#")]),t._v(" 步骤二：编译打包dubbo-test应用")]),t._v(" "),a("p",[t._v("执行如下命令，对dubbo-test项目中的子项目dubbo-2-6-integration-consumer和dubbo-2-6-integration-provider进行打包:")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("mvn clean package\n")])])]),a("p",[t._v("可在dubbo-2-6-integration-consumer项目中的"),a("code",[t._v("target")]),t._v("文件夹中得到dubbo-integration-consumer.jar包和dubbo-2-6-integration-provider项目中得到dubbo-integration-provider.jar包。")]),t._v(" "),a("h3",{attrs:{id:"步骤三-启动应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤三-启动应用"}},[t._v("#")]),t._v(" 步骤三：启动应用")]),t._v(" "),a("ul",[a("li",[t._v("参考如下命令, 启动backend应用。")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Run under Linux")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("java")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-jar")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${path}")]),t._v("/sermant-agent-x.x.x/server/sermant/sermant-backend-x.x.x.jar\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Run under Windows")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("java")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-jar")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${path}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("sermant-agent-x.x.x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("sermant"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("sermant-backend-x.x.x.jar\n")])])]),a("ul",[a("li",[t._v("参考如下命令, 启动dubbo-2-6-integration-consumer应用。")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Run under Linux")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("java")]),t._v(" -javaagent:"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${path}")]),t._v("/sermant-agent-x.x.x/agent/sermant-agent.jar"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("appName"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("consumer "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-jar")]),t._v("  dubbo-integration-consumer.jar\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Run under Windows")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("java")]),t._v(" -javaagent:"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${path}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("sermant-agent-x.x.x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("agent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("sermant-agent.jar"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("appName"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("consumer "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-jar")]),t._v("  dubbo-integration-consumer.jar\n")])])]),a("ul",[a("li",[t._v("参考如下命令, 启动dubbo-2-6-integration-provider应用。")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Run under Linux")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("java")]),t._v(" -javaagent:"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${path}")]),t._v("/sermant-agent-x.x.x/agent/sermant-agent.jar"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("appName"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("provider "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-jar")]),t._v(" dubbo-integration-provider.jar\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Run under Windows")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("java")]),t._v(" -javaagent:"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${path}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("sermant-agent-x.x.x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("agent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("sermant-agent.jar"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("appName"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("provider "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-jar")]),t._v(" dubbo-integration-provider.jar\n")])])]),a("blockquote",[a("p",[a("strong",[t._v("说明：")]),t._v(" ${path}为sermant实际安装路径，x.x.x代表sermant某个版本号。")])]),t._v(" "),a("h3",{attrs:{id:"验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证"}},[t._v("#")]),t._v(" 验证")]),t._v(" "),a("p",[t._v("访问血缘关系信息展示页面"),a("code",[t._v("http://127.0.0.1:8900/#/consanguinity")]),t._v("或契约信息展示页面"),a("code",[t._v("http://127.0.0.1:8900/#/contract")]),t._v("，页面成功显示采集信息则说明插件生效。")]),t._v(" "),a("p",[t._v("展示效果如下图所示：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("契约信息展示效果图\n"),a("MyImage",{attrs:{src:"/docs-img/visibility-contarct.png"}})],1)]),t._v(" "),a("li",[a("p",[t._v("调用依赖关系信息展示效果图\n"),a("MyImage",{attrs:{src:"/docs-img/visibility-consanguinity.png"}})],1)])])])}),[],!1,null,null,null);a.default=r.exports}}]);