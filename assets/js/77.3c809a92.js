(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{523:function(t,e,a){"use strict";a.r(e);var l=a(26),s=Object(l.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"监控"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#监控"}},[t._v("#")]),t._v(" 监控")]),t._v(" "),e("p",[t._v("本文介绍如何使用"),e("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/tree/develop/sermant-plugins/sermant-monitor",target:"_blank",rel:"noopener noreferrer"}},[t._v("监控插件"),e("OutboundLink")],1),t._v("。")]),t._v(" "),e("h2",{attrs:{id:"功能介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#功能介绍"}},[t._v("#")]),t._v(" 功能介绍")]),t._v(" "),e("p",[t._v("监控插件用于监控宿主应用所在服务器的CPU、内存、磁盘IO和网络IO等硬件资源的使用情况，JVM资源使用情况比如堆内存使用、非堆内存使用、缓存区使用，吞吐量（QPS、TPS、平均响应时间）。监控插件依赖Prometheus进行指标收集，Prometheus会定期拉取监控插件采集的指标数据。")]),t._v(" "),e("h2",{attrs:{id:"参数配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参数配置"}},[t._v("#")]),t._v(" 参数配置")]),t._v(" "),e("h3",{attrs:{id:"插件配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#插件配置"}},[t._v("#")]),t._v(" 插件配置")]),t._v(" "),e("p",[t._v("监控插件需要配置监控启用开关（"),e("code",[t._v("monitor.config.enableStartService")]),t._v("）、宿主应用所在环境的IP地址/域名（"),e("code",[t._v("monitor.config.address")]),t._v("）、宿主服务的端口（"),e("code",[t._v("monitor.config.port")]),t._v("）和上报方式（"),e("code",[t._v("monitor.config.reportType")]),t._v("）,可在"),e("code",[t._v("${path}/sermant-agent-x.x.x/agent/pluginPackage/monitor/config/config.yaml")]),t._v("找到该插件的配置文件， 配置如下所示：")]),t._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("monitor.config")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("                       "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 监控插件配置。")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enableStartService")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("           "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 监控插件启动开关。为true时进行指标采集。")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("address")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 127.0.0.1                  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 宿主应用所在环境的IP地址/域名。创建服务器实例时使用。prometheus通过调用创建的服务器实例获取插件采集的指标信息。")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("12345")]),t._v("                         "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 对外提供Http服务的端口信息。创建服务器实例时使用。prometheus通过调用创建的服务器实例获取插件采集的指标信息。")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("reportType")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PROMETHEUS              "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 监控指标上报方式。目前只支持PROMETHEUS。")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("userName")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("                           "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 授权信息--授权用户名。配置授权信息后，prometheus也需要配置授权信息才能正常获取指标，防止恶意请求获取指标信息。")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("password")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("                           "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 授权信息--授权用户密码--AES加密密文。配置授权信息后，prometheus也需要配置授权信息才能获取指标，防止恶意请求获取指标信息。")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("                                "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 授权用户密码加密使用的KEY。")]),t._v("\n")])])]),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("参数键")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("说明")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("默认值")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("是否必须")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("monitor.config.enableStartService")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("监控插件启动开关")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("false")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("是")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("monitor.config.address")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("宿主应用所在环境的IP地址/域名")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("127.0.0.1")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("是")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("monitor.config.port")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("对外提供Http服务的端口信息")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("12345")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("是")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("monitor.config.reportType")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("监控指标上报方式  目前只支持PROMETHEUS")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("PROMETHEUS")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("是")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("monitor.config.userName")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("授权信息--授权用户名")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("空")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("否")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("monitor.config.password")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("授权信息--授权用户密码--AES加密")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("空")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("否")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("monitor.config.key")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("授权用户密码加密使用的KEY")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("空")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("否")])])])]),t._v(" "),e("h2",{attrs:{id:"详细治理规则"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#详细治理规则"}},[t._v("#")]),t._v(" 详细治理规则")]),t._v(" "),e("p",[t._v("监控插件目前能采集的指标数据如下表所示（对接prometheus之后用户可以通过指标名在prometheus查询具体的指标信息，参见"),e("a",{attrs:{href:"#%E9%AA%8C%E8%AF%81"}},[t._v("验证")]),t._v(")：")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("指标名")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("说明")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("指标类型")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("cpu_user")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("用户态时间占比")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("CPU")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("cpu_sys")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("系统时间占比")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("CPU")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("cpu_wait")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("等待时间百分占比")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("CPU")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("cpu_idle")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("空闲时间占比")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("CPU")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("cpu_cores")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("CPU物理核心数")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("CPU")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("memory_total")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("总内存大小")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("memory")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("memory_swap")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("缓存内存用的交换空间的大小")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("memory")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("memory_cached")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("缓存内存的物理内存总量")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("memory")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("memory_buffer")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("给文件做缓冲大小")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("memory")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("memory_used")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("已使用的内存大小")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("memory")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("disk_readBytesPerSec")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("采集周期内的磁盘每秒读字节数")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("磁盘IO")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("disk_writeBytesPerSec")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("采集周期内的磁盘每秒写字节数")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("磁盘IO")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("disk_ioSpentPercentage")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("采集周期内，磁盘IO花费的时间百分占比")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("磁盘IO")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("network_readBytesPerSec")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("采集周期内的网络每秒读字节数")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("网络")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("network_writeBytesPerSec")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("采集周期内的网络每秒读字节数")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("网络")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("network_readPackagePerSec")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("采集周期内的网络每秒写字节数")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("网络")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("network_writePackagePerSec")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("采集周期内，网络IO花费的时间百分占比")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("网络")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("heap_memory_init")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("堆内存初始化值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("heap_memory_max")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("堆内存最大值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("heap_memory_used")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("堆内存已使用")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("heap_memory_committed")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("堆内存已提交")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("non_heap_memory_init")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("非堆内存初始化值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("non_heap_memory_max")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("非堆内存最大值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("non_heap_memory_used")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("非堆内存已使用值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("non_heap_memory_committed")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("非堆内存已提交")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("code_cache_init")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("代码缓存区初始化值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("code_cache_max")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("代码缓存区最大值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("code_cache_used")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("代码缓存区已使用")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("code_cache_committed")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("代码缓存区已提交")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("meta_sapce_init")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("元空间初始化值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("meta_sapce_max")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("元空间最大值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("meta_sapce_used")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("元空间已使用值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("meta_sapce_committed")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("元空间已提交值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("compressed_class_space_init")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("压缩类空间初始化值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("compressed_class_space_max")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("压缩类空间最大值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("compressed_class_space_used")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("压缩类空间已使用值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("compressed_class_space_committed")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("压缩类空间已提交值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("eden_init")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("eden区内存初始化值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("eden_max")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("eden区内存最大值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("eden_used")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("eden区内存已使用值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("eden_committed")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("eden区内存已提交值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("survivor_init")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("survivor区内存初始化值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("survivor_max")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("survivor区内存最大值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("survivor_used")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("survivor区内存已使用值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("survivor_committed")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("survivor区内存已提交值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("old_gen_init")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("老年代内存初始化值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("old_gen_max")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("老年代内存最大值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("old_gen_used")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("老年代内存已使用值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("old_gen_committed")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("老年代内存已提交值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("thread_live")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("活动线程")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("thread_peak")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("线程峰值")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("thread_daemon")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("守护线程")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("new_gen_count")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("年轻代GC次数")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("new_gen_spend")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("年轻代GC耗时")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("old_gen_count")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("老年代GC次数")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("old_gen_spend")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("老年代GC耗时")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("cpu_used")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM占用CPU情况")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("start_time")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM已经启动时间，毫秒数")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("JVM")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("qps")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("每秒请求数")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("吞吐量")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("tps")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("每秒请求处理数")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("吞吐量")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("avg_response_time")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("平均响应时间")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("吞吐量")])])])]),t._v(" "),e("h2",{attrs:{id:"支持版本与限制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#支持版本与限制"}},[t._v("#")]),t._v(" 支持版本与限制")]),t._v(" "),e("p",[t._v("框架支持：")]),t._v(" "),e("ul",[e("li",[t._v("SpringBoot 1.5.10.Release及以上")]),t._v(" "),e("li",[t._v("Dubbo 2.6.x-2.7.x")])]),t._v(" "),e("p",[t._v("限制：")]),t._v(" "),e("ul",[e("li",[t._v("依赖Prometheus")]),t._v(" "),e("li",[t._v("服务器指标的采集依赖于Linux环境")])]),t._v(" "),e("h2",{attrs:{id:"操作和结果验证"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#操作和结果验证"}},[t._v("#")]),t._v(" 操作和结果验证")]),t._v(" "),e("p",[t._v("下面将演示如何使用监控插件，验证springboot应用挂载监控插件对接Prometheus场景。")]),t._v(" "),e("h3",{attrs:{id:"准备工作"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[t._v("#")]),t._v(" 准备工作")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://start.spring.io/#!type=maven-project&language=java&platformVersion=2.7.7&packaging=jar&jvmVersion=1.8&groupId=com.example&artifactId=demo&name=demo&description=Demo%20project%20for%20Spring%20Boot&packageName=com.example.demo&dependencies=web",target:"_blank",rel:"noopener noreferrer"}},[t._v("下载"),e("OutboundLink")],1),t._v("demo应用")]),t._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/releases",target:"_blank",rel:"noopener noreferrer"}},[t._v("下载"),e("OutboundLink")],1),t._v("/编译sermant包")]),t._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/prometheus/prometheus/releases",target:"_blank",rel:"noopener noreferrer"}},[t._v("下载"),e("OutboundLink")],1),t._v("Prometheus")])]),t._v(" "),e("blockquote",[e("p",[t._v("注意："),e("RouterLink",{attrs:{to:"/zh/document/user-guide/configuration-center.html"}},[t._v("动态配置中心")]),t._v("会在本场景中默认使用，由于非本场景的核心组件，因此在本文中不额外赘述。")],1)]),t._v(" "),e("h3",{attrs:{id:"步骤一-编译打包demo应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#步骤一-编译打包demo应用"}},[t._v("#")]),t._v(" 步骤一：编译打包demo应用")]),t._v(" "),e("p",[t._v("在demo应用的根目录执行如下命令对demo应用进行打包:")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("mvn clean package\n")])])]),e("p",[t._v("打包成功后，在demo根目录会生成"),e("code",[t._v("target")]),t._v("文件夹,进入"),e("code",[t._v("target")]),t._v("文件夹可以得到demo-0.0.1-SNAPSHOT.jar包。")]),t._v(" "),e("h3",{attrs:{id:"步骤二-修改配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#步骤二-修改配置"}},[t._v("#")]),t._v(" 步骤二：修改配置")]),t._v(" "),e("ul",[e("li",[t._v("修改监控插件配置，可在"),e("code",[t._v("${path}/sermant-agent-x.x.x/agent/pluginPackage/monitor/config/config.yaml")]),t._v("找到该配置文件。")])]),t._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("monitor.config")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("                       "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 监控插件配置")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enableStartService")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("            "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 监控插件启动开关。修改为true。")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("address")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 127.0.0.1                  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 宿主应用所在环境的IP地址/域名。修改为宿主具体IP地址。")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("12345")]),t._v("                         "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 对外提供Http服务的端口信息。修改为可用的端口。")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("reportType")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PROMETHEUS              "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 监控指标上报方式。目前只支持PROMETHEUS。")]),t._v("\n")])])]),e("ul",[e("li",[t._v("修改"),e("a",{attrs:{href:"https://prometheus.io/docs/introduction/overview/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Prometheus"),e("OutboundLink")],1),t._v("的配置文件prometheus.yml。\n在原有的作业信息下新增作业信息。")])]),t._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scrape_configs")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job_name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"prometheus"')]),t._v("            "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 作业名称。此为prometheus原有的任务。")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("static_configs")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targets")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost:9090"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 监控主机地址")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job_name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Sermant"')]),t._v("               "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 作业名称。新增采集监控插件指标的作业")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metrics_path")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /                   "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 采集指标的请求路径。默认为 /")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("basic_auth")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("                       "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 采集指标的授权信息，与监控插件配置保持一致。监控插件未配置时可删除该配置。")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("username")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("                       "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 采集指标的授权信息-用户名称")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("password")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("                       "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 采集指标的授权信息-密码")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("static_configs")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("                   \n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targets")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1:12345"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 采集指标的主机地址。此处的IP、端口信息与监控插件配置保持一致")]),t._v("\n")])])]),e("h3",{attrs:{id:"步骤三-启动应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#步骤三-启动应用"}},[t._v("#")]),t._v(" 步骤三：启动应用")]),t._v(" "),e("ul",[e("li",[t._v("参考如下命令启动demo应用")])]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Run under Linux")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("java")]),t._v(" -javaagent:"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${path}")]),t._v("/sermant-agent-x.x.x/agent/sermant-agent.jar"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("appName"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("default "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-jar")]),t._v(" demo-0.0.1-SNAPSHOT.jar\n")])])]),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Run under Windows")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("java")]),t._v(" -javaagent:"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${path}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("sermant-agent-x.x.x"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("agent"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("sermant-agent.jar"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("appName"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("default "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-jar")]),t._v(" demo-0.0.1-SNAPSHOT.jar\n")])])]),e("blockquote",[e("p",[e("strong",[t._v("说明：")]),t._v(" ${path}为sermant实际安装路径，x.x.x代表sermant某个版本号。")])]),t._v(" "),e("ul",[e("li",[t._v("启动 Prometheus")])]),t._v(" "),e("h3",{attrs:{id:"验证"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#验证"}},[t._v("#")]),t._v(" 验证")]),t._v(" "),e("p",[t._v("打开Prometheus（默认为"),e("code",[t._v("http://127.0.0.1:9090")]),t._v("），查询指标。例如：查询"),e("code",[t._v("heap_memory_used")]),t._v("，能查询到信息则标示插件生效。")]),t._v(" "),e("p",[t._v("查询效果图如下所示：")]),t._v(" "),e("MyImage",{attrs:{src:"/docs-img/monitor.png"}})],1)}),[],!1,null,null,null);e.default=s.exports}}]);