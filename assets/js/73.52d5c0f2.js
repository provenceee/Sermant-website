(window.webpackJsonp=window.webpackJsonp||[]).push([[73],{519:function(t,a,s){"use strict";s.r(a);var e=s(26),n=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"动态配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#动态配置"}},[t._v("#")]),t._v(" 动态配置")]),t._v(" "),a("p",[t._v("本文介绍如何使用"),a("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/tree/develop/sermant-plugins/sermant-dynamic-config",target:"_blank",rel:"noopener noreferrer"}},[t._v("动态配置插件"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("h2",{attrs:{id:"功能介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#功能介绍"}},[t._v("#")]),t._v(" 功能介绍")]),t._v(" "),a("p",[t._v("Spring Cloud Config动态配置已广泛应用于企业开发项目，为用户更方便使用配置中心，切换配置中心类型更便捷，动态配置插件基于Sermant动态配置中心的能力实现应用配置的动态更新。该插件可屏蔽应用原配置中心，应用在挂载Sermant运行时，通过动态配置中心对宿主应用的配置进行刷新。")]),t._v(" "),a("h2",{attrs:{id:"参数配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参数配置"}},[t._v("#")]),t._v(" 参数配置")]),t._v(" "),a("h3",{attrs:{id:"sermant-agent配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sermant-agent配置"}},[t._v("#")]),t._v(" Sermant-agent配置")]),t._v(" "),a("p",[t._v("动态配置插件依赖动态配置中心，需要在Sermant-agent中配置动态配置中心的地址（"),a("code",[t._v("dynamic.config.serverAddress")]),t._v("），动态配置中心的类型（"),a("code",[t._v("dynamic.config.dynamicConfigType")]),t._v("）,具体参考"),a("RouterLink",{attrs:{to:"/zh/document/user-guide/sermant-agent.html#sermant-agent使用参数配置"}},[t._v("Sermant-agent使用手册")]),t._v("。")],1),t._v(" "),a("h3",{attrs:{id:"插件配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#插件配置"}},[t._v("#")]),t._v(" 插件配置")]),t._v(" "),a("p",[t._v("动态配置插件需打开是否开启适配CSE（"),a("code",[t._v("dynamic.config.plugin.enableCseAdapter")]),t._v("），是否开启动态配置插件（"),a("code",[t._v("dynamic.config.plugin.enableDynamicConfig")]),t._v("）等开关，可在"),a("code",[t._v("${path}/sermant-agent-x.x.x/agent/pluginPackage/dynamic-config/config/config.yaml")]),t._v("找到插件的配置文件，配置如下所示：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dynamic.config.plugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enableCseAdapter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 是否开启适配CSE")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enableDynamicConfig")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 是否开启动态配置插件")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enableOriginConfigCenter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 是否开启原配置中心, 默认关闭")]),t._v("\n")])])]),a("table",[a("thead",[a("tr",[a("th",[t._v("参数键")]),t._v(" "),a("th",[t._v("说明")]),t._v(" "),a("th",[t._v("默认值")]),t._v(" "),a("th",[t._v("是否必须")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("enableCseAdapter")]),t._v(" "),a("td",[t._v("是否开启适配CSE; "),a("br"),t._v(" "),a("strong",[t._v("true")]),t._v(":根据应用配置,服务配置,自定义标签配置进行配置订阅；"),a("br"),t._v(" "),a("strong",[t._v("false")]),t._v(":根据服务名进行订阅；"),a("RouterLink",{attrs:{to:"/zh/document/plugin/dynamic-config.html#详细治理规则"}},[t._v("见详细治理规则说明")])],1),t._v(" "),a("td",[t._v("true")]),t._v(" "),a("td",[t._v("是")])]),t._v(" "),a("tr",[a("td",[t._v("enableDynamicConfig")]),t._v(" "),a("td",[t._v("是否开启动态配置插件")]),t._v(" "),a("td",[t._v("false")]),t._v(" "),a("td",[t._v("否")])]),t._v(" "),a("tr",[a("td",[t._v("enableOriginConfigCenter")]),t._v(" "),a("td",[t._v("是否开启原配置中心; "),a("br"),t._v(" "),a("strong",[t._v("false")]),t._v(":屏蔽原配置中心，只能通过Sermant下发配置; "),a("br"),t._v(" "),a("strong",[t._v("true")]),t._v(":不屏蔽原配置中心，可通过原配置中心下发配置，"),a("strong",[t._v("注意")]),t._v("：若不屏蔽应用原配置中心可能会影响动态配置中心下发配置")]),t._v(" "),a("td",[t._v("false")]),t._v(" "),a("td",[t._v("否")])])])]),t._v(" "),a("h2",{attrs:{id:"详细治理规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#详细治理规则"}},[t._v("#")]),t._v(" 详细治理规则")]),t._v(" "),a("p",[t._v("动态配置插件基于框架提供的动态配置能力进行配置发布，配置发布可以参考"),a("RouterLink",{attrs:{to:"/zh/document/user-guide/configuration-center.html#发布配置"}},[t._v("动态配置中心使用手册")])],1),t._v(" "),a("p",[t._v("动态配置主要基于"),a("code",[t._v("group")]),t._v("进行匹配配置订阅，该标签组由多个键值对组成，根据适配开关配置"),a("code",[t._v("enableCseAdapter")]),t._v("的不同，"),a("code",[t._v("group")]),t._v("的值将会有所区别，如下：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("若关闭适配，即"),a("code",[t._v("enableCseAdapter: false")])]),t._v(" "),a("p",[t._v("此时插件将根据宿主应用的服务名进行订阅, 即应用配置的"),a("code",[t._v("spring.applicaton.name")]),t._v(", 插件订阅配置的group为"),a("code",[t._v("service=${spring.applicaton.name}")])])]),t._v(" "),a("li",[a("p",[t._v("若开启适配, 即"),a("code",[t._v("enableCseAdapter: true")])]),t._v(" "),a("p",[t._v("此时插件将根据"),a("strong",[t._v("应用配置")]),t._v("，"),a("strong",[t._v("服务配置")]),t._v("以及"),a("strong",[t._v("自定义配置")]),t._v("三项数据进行配置"),a("strong",[t._v("同时")]),t._v("订阅， 而这三类配置可参考"),a("code",[t._v("${path}/sermant-agent-x.x.x/agent/config/config.properties")]),t._v(", 相关配置如下：")]),t._v(" "),a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 服务app名称")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("service.meta.application")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("default")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 服务版本")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("service.meta.version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("1.0.0")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# serviceComb 命名空间")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("service.meta.project")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("default")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 环境")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("service.meta.environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("development")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 自定义标签，按需配置，用于后续的配置订阅")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("service.meta.customLabel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("public")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("service.meta.customLabelValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("default")]),t._v("\n")])])]),a("p",[t._v("应用配置，服务配置，自定义配置说明参考"),a("a",{attrs:{href:"https://support.huaweicloud.com/devg-cse/cse_devg_0020.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("CSE配置中心概述"),a("OutboundLink")],1)]),t._v(" "),a("ul",[a("li",[t._v("应用配置：由"),a("code",[t._v("service.meta.application")]),t._v("与"),a("code",[t._v("service.meta.environment")]),t._v("组成， 对应的"),a("code",[t._v("group")]),t._v("为"),a("code",[t._v("app=default&environment=development")])]),t._v(" "),a("li",[t._v("服务配置：由"),a("code",[t._v("service.meta.application")]),t._v("、"),a("code",[t._v("service.meta.environment")]),t._v("以及服务名组成，此处服务即"),a("code",[t._v("spring.application.name")]),t._v(", 对应的"),a("code",[t._v("group")]),t._v("为"),a("code",[t._v("app=default&environment=development&service=DynamicConfigDemo")])]),t._v(" "),a("li",[t._v("自定义配置：由"),a("code",[t._v("service.meta.customLabel")]),t._v("与"),a("code",[t._v("service.meta.customLabelValue")]),t._v("组成， 对应的"),a("code",[t._v("group")]),t._v("为"),a("code",[t._v("public=default")])])])])]),t._v(" "),a("p",[t._v("以上为"),a("code",[t._v("group")]),t._v("的配置介绍，下面说明"),a("code",[t._v("content")]),t._v("配置，当前动态配置仅支持yaml格式, 例如配置如下内容:")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8004")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("sermant")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" sermant\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("application")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" DynamicConfigDemo\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cloud")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("zookeeper")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),a("h2",{attrs:{id:"支持版本和限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#支持版本和限制"}},[t._v("#")]),t._v(" 支持版本和限制")]),t._v(" "),a("h3",{attrs:{id:"支持版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#支持版本"}},[t._v("#")]),t._v(" 支持版本")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("框架类型")]),t._v(" "),a("th",[t._v("版本")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("SpringBoot")]),t._v(" "),a("td",[t._v("1.5.x - 2.6.2")])]),t._v(" "),a("tr",[a("td",[t._v("spring-cloud-starter-alibaba-nacos-config")]),t._v(" "),a("td",[t._v("1.5.0.RELEASE+")])]),t._v(" "),a("tr",[a("td",[t._v("spring-cloud-starter-zookeeper-config")]),t._v(" "),a("td",[t._v("1.2.0.RELEASE+")])])])]),t._v(" "),a("h3",{attrs:{id:"限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#限制"}},[t._v("#")]),t._v(" 限制")]),t._v(" "),a("ol",[a("li",[t._v("屏蔽应用原配置中心（目前仅支持"),a("strong",[t._v("zookeeper")]),t._v("，"),a("strong",[t._v("nacos")]),t._v("）")]),t._v(" "),a("li",[t._v("需配合注解"),a("code",[t._v("@Value, @ConfigurationProperties以及@RefreshScope")]),t._v("使用，以下示范"),a("code",[t._v("@Value")]),t._v("注解使用，"),a("code",[t._v("@ConfigurationProperties")]),t._v("注解同理")])]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * @Value配置示范\n * 需配合注解@RefreshScope\n */")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Component")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RefreshScope")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ValueConfig")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${sermant}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),t._v(" sermant"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${server.port}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ValueConfig{"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sermant="')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" sermant "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('", port="')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" port "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token char"}},[t._v("'\\''")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token char"}},[t._v("'}'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSermant")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" sermant"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"操作和结果验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#操作和结果验证"}},[t._v("#")]),t._v(" 操作和结果验证")]),t._v(" "),a("p",[t._v("下面将演示如何使用动态配置插件，验证使用Sermant动态配置中心（zookeeper）更新spring boot应用配置的场景。")]),t._v(" "),a("h3",{attrs:{id:"准备工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[t._v("#")]),t._v(" 准备工作")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/flowcontrol-demo/spring-cloud-demo/spring-provider",target:"_blank",rel:"noopener noreferrer"}},[t._v("下载"),a("OutboundLink")],1),t._v(" demo源码")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/releases",target:"_blank",rel:"noopener noreferrer"}},[t._v("下载"),a("OutboundLink")],1),t._v(" 或编译Sermant包")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://zookeeper.apache.org/releases#download",target:"_blank",rel:"noopener noreferrer"}},[t._v("下载"),a("OutboundLink")],1),t._v(" 并启动zookeeper")])]),t._v(" "),a("h3",{attrs:{id:"步骤一-编译打包demo应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤一-编译打包demo应用"}},[t._v("#")]),t._v(" 步骤一：编译打包demo应用")]),t._v(" "),a("p",[t._v("在"),a("code",[t._v("${path}/Sermant-examples/flowcontrol-demo/spring-cloud-demo/spring-provider")]),t._v("目录执行以下命令：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# windows,Linux,mac")]),t._v("\nmvn clean package\n")])])]),a("p",[t._v("打包成功后，在"),a("code",[t._v("${path}/Sermant-examples/flowcontrol-demo/spring-cloud-demo/spring-provider/target")]),t._v("得到"),a("code",[t._v("spring-provider.jar")])]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("说明")]),t._v("： ${path}为demo应用下载所在路径。")])]),t._v(" "),a("h3",{attrs:{id:"步骤二-修改插件配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤二-修改插件配置"}},[t._v("#")]),t._v(" 步骤二：修改插件配置")]),t._v(" "),a("p",[t._v("参考"),a("a",{attrs:{href:"#%E6%8F%92%E4%BB%B6%E9%85%8D%E7%BD%AE"}},[t._v("插件配置")]),t._v(" 修改"),a("code",[t._v("${path}/sermant-agent-x.x.x/agent/pluginPackage/dynamic-config/config/config.yaml")]),t._v("文件为以下内容：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("dynamic.config.plugin:\n  enableCseAdapter: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 是否开启适配CSE")]),t._v("\n  enableDynamicConfig: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 是否开启动态配置插件")]),t._v("\n  enableOriginConfigCenter: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 是否开启原配置中心, 默认关闭")]),t._v("\n")])])]),a("blockquote",[a("p",[a("strong",[t._v("说明")]),t._v("：${path}为sermant所在路径。")])]),t._v(" "),a("h3",{attrs:{id:"步骤三-启动demo应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤三-启动demo应用"}},[t._v("#")]),t._v(" 步骤三：启动demo应用")]),t._v(" "),a("p",[t._v("参考如下命令启动demo应用")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# windwos")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("java")]),t._v(" -javaagent:"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${path}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("sermant-agent-x.x.x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("agent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("sermant-agent.jar "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-Dspring.application.name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("spring-flow-provider "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-Dspring.cloud.zookeeper.connectString")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:2181 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-jar")]),t._v(" spring-provider.jar\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#linux mac")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("java")]),t._v(" -javaagent:"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${path}")]),t._v("/sermant-agent-x.x.x/agent/sermant-agent.jar "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-Dspring.application.name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("spring-flow-provider "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-Dspring.cloud.zookeeper.connectString")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:2181 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-jar")]),t._v(" spring-provider.jar\n")])])]),a("blockquote",[a("p",[a("strong",[t._v("说明：")]),t._v(" ${path}为sermant实际安装路径，x.x.x代表sermant某个版本号。")])]),t._v(" "),a("h3",{attrs:{id:"步骤四-查看原配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤四-查看原配置"}},[t._v("#")]),t._v(" 步骤四：查看原配置")]),t._v(" "),a("p",[t._v("浏览器或curl工具访问"),a("code",[t._v("localhost:8003/flow")]),t._v(",查看控制台日志是否打印"),a("code",[t._v("sermant")]),t._v("日志")]),t._v(" "),a("p",[a("strong",[t._v("demo应用配置")]),t._v("如下：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# demo 应用配置")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8003")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("sermant")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" sermant\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("application")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" spring"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("provider\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cloud")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("zookeeper")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),a("p",[a("strong",[t._v("demo应用/flow接口")]),t._v("代码如下：")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// demo应用源码")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Controller")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@ResponseBody")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RefreshScope")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FlowController")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${sermant}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),t._v(" sermant"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RequestMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/flow"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" method "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RequestMethod")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GET")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("flow")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RequestParam")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("required "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),t._v(" exRate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpServletRequest")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("LOGGER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" sermant"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello, I am zk rest template provider, my port is "')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("当调用"),a("strong",[t._v("flow接口")]),t._v("时，demo应用执行"),a("code",[t._v("LOGGER.info((String) sermant);")]),t._v("语句，在控制台打印"),a("code",[t._v("sermant")]),t._v("变量的值"),a("code",[t._v("sermant")]),t._v("，如下图所示：")]),t._v(" "),a("MyImage",{attrs:{src:"/docs-img/dynamic-config-old-config.jpg"}}),t._v(" "),a("h3",{attrs:{id:"步骤五-修改应用配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤五-修改应用配置"}},[t._v("#")]),t._v(" 步骤五：修改应用配置")]),t._v(" "),a("p",[t._v("参考使用"),a("RouterLink",{attrs:{to:"/zh/document/user-guide/configuration-center.html#发布配置"}},[t._v("动态配置中心使用手册")]),t._v(" 进行配置发布")],1),t._v(" "),a("p",[t._v("以zookeeper为例，利用zookeeper提供的命令行工具来来发布动态配置：")]),t._v(" "),a("ol",[a("li",[t._v("在"),a("code",[t._v("${path}/bin/")]),t._v("目录执行以下命令创建节点"),a("code",[t._v("/service=spring-flow-provider")])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# linux mac")]),t._v("\n./zkCli.sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-server")]),t._v(" localhost:2181 create /service"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("spring-flow-provider\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# windows")]),t._v("\nzkCli.cmd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-server")]),t._v(" localhost:2181 create /service"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("spring-flow-provider\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("在"),a("code",[t._v("${path}/bin/")]),t._v("目录执行以下命令创建创建节点"),a("code",[t._v("/service=spring-flow-provider/config")]),t._v("和数据"),a("code",[t._v("sermant: sermant1")])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# linux mac")]),t._v("\n./zkCli.sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-server")]),t._v(" localhost:2181 create /service"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("spring-flow-provider/config "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sermant: sermant1"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# windows")]),t._v("\nzkCli.cmd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-server")]),t._v(" localhost:2181 create /service"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("spring-flow-provider/config "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sermant: sermant1"')]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("说明：${path}为zookeeper的安装目录。")])]),t._v(" "),a("h3",{attrs:{id:"验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证"}},[t._v("#")]),t._v(" 验证")]),t._v(" "),a("p",[t._v("再次通过浏览器或curl工具访问"),a("code",[t._v("localhost:8003/flow")]),t._v("，查看控制台是否有输出"),a("code",[t._v("sermant1")]),t._v("日志。")]),t._v(" "),a("MyImage",{attrs:{src:"/docs-img/dynamic-config-verify.jpg"}})],1)}),[],!1,null,null,null);a.default=n.exports}}]);