(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{470:function(e,t,a){"use strict";a.r(t);var n=a(26),s=Object(n.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"plugin-development-guide"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#plugin-development-guide"}},[e._v("#")]),e._v(" Plugin Development Guide")]),e._v(" "),t("p",[e._v("This document focuses on "),t("strong",[e._v("Sermant")]),e._v("'s "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template",target:"_blank",rel:"noopener noreferrer"}},[e._v("example module"),t("OutboundLink")],1),e._v(", which describes some common scenarios during plug-in development.")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"#Development-Environment"}},[e._v("Development Environment")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#Components"}},[e._v("Components")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#Plugin-Module"}},[e._v("Plugin Module")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"#Enhancement-Definition"}},[e._v("Enhancement Definition")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"#Enhancement-for-Native-Class"}},[e._v("Enhancement for Native Class")])])])]),e._v(" "),t("li",[t("a",{attrs:{href:"#Interceptor"}},[e._v("Interceptor")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#Plugin-Configuration"}},[e._v("Plugin Configuration")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#Plugin-Service"}},[e._v("Plugin Service")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"#Simple-Plugin-Service"}},[e._v("Simple Plugin Service")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#Complex-Plugin-Service"}},[e._v("Complex Plugin Service")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#Log"}},[e._v("Log")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#Heartbeat"}},[e._v("Heartbeat")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#Trace-Tracking"}},[e._v("Trace Tracking")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#Dynamic-Configuration"}},[e._v("Dynamic Configuration")])])])])])]),e._v(" "),t("li",[t("a",{attrs:{href:"#Plugin-Service-Module"}},[e._v("Plugin Service Module")])])]),e._v(" "),t("h2",{attrs:{id:"development-environment"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#development-environment"}},[e._v("#")]),e._v(" Development Environment")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://gitee.com/openeuler/bishengjdk-8",target:"_blank",rel:"noopener noreferrer"}},[e._v("HuaweiJDK 1.8"),t("OutboundLink")],1),e._v(" / "),t("a",{attrs:{href:"https://github.com/openjdk/jdk",target:"_blank",rel:"noopener noreferrer"}},[e._v("OpenJDK 1.8"),t("OutboundLink")],1),e._v(" / "),t("a",{attrs:{href:"https://www.oracle.com/java/technologies/downloads/",target:"_blank",rel:"noopener noreferrer"}},[e._v("OracleJDK 1.8"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://maven.apache.org/download.cgi",target:"_blank",rel:"noopener noreferrer"}},[e._v("Apache Maven 3"),t("OutboundLink")],1)])]),e._v(" "),t("h2",{attrs:{id:"components"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#components"}},[e._v("#")]),e._v(" Components")]),e._v(" "),t("p",[e._v("According to the "),t("RouterLink",{attrs:{to:"/en/document/UserGuide/plugin.html"}},[e._v("Plugin Module")]),e._v(", a "),t("code",[e._v("main")]),e._v(" plugin module contains the following five things:")],1),e._v(" "),t("ul",[t("li",[e._v("The "),t("code",[e._v("plugin")]),e._v(" module, which is mainly used to declare enhancements to the host application.")]),e._v(" "),t("li",[e._v("The "),t("code",[e._v("service")]),e._v(" module, which provides the service implementation for the plugin package.")]),e._v(" "),t("li",[e._v("The "),t("code",[e._v("backend")]),e._v(" module (server), which receives the data from plugin.")]),e._v(" "),t("li",[e._v("The "),t("code",[e._v("frontend")]),e._v(" module (webapp), which is used to display the server-side data")]),e._v(" "),t("li",[e._v("The "),t("code",[e._v("other")]),e._v(" module (special add-on), which is usually used for debugging.")])]),e._v(" "),t("p",[e._v("Considering that the latter three have great changes with the actual business scenarios, they are given a high degree of development freedom, and they are only limited by the module directory and the output directory. For this reason, the "),t("code",[e._v("example module")]),e._v(" will not be a reference case for them. The "),t("code",[e._v("example module")]),e._v(" contains the following modules:")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-plugin",target:"_blank",rel:"noopener noreferrer"}},[e._v("demo-plugin"),t("OutboundLink")],1),e._v(": the example for plugin")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-service",target:"_blank",rel:"noopener noreferrer"}},[e._v("demo-service"),t("OutboundLink")],1),e._v(": the example for plugin service")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/demo-application",target:"_blank",rel:"noopener noreferrer"}},[e._v("demo-application"),t("OutboundLink")],1),e._v(": the example for host application")])]),e._v(" "),t("h2",{attrs:{id:"plugin-module"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#plugin-module"}},[e._v("#")]),e._v(" Plugin Module")]),e._v(" "),t("p",[e._v("The example plugin module "),t("code",[e._v("demo-plugin")]),e._v(" is mainly used to show plugin developers some scenarios that may be encountered in the development process of plugins and some functions that may be used.")]),e._v(" "),t("p",[e._v("Before we start, it's important to agree that in "),t("code",[e._v("plugin")]),e._v(" modules, developers can only use the "),t("em",[e._v("Java")]),e._v(" native API and the "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/tree/develop/sermant-agentcore/sermant-agentcore-core",target:"_blank",rel:"noopener noreferrer"}},[t("strong",[e._v("Sermant")]),e._v(" core module"),t("OutboundLink")],1),e._v(" and cannot rely on or use any third-party dependencies other than "),t("code",[e._v("byte-buddy")]),e._v(" and "),t("code",[e._v("slf4j")]),e._v(". If the business needs to use other third-party dependencies, you can only define the interface in the "),t("code",[e._v("plugin")]),e._v(" module and write the implementation in the "),t("code",[e._v("service")]),e._v(" module. Refer to the "),t("RouterLink",{attrs:{to:"/en/document/UserGuide/plugin.html#Add-Plugin-Module"}},[e._v("Plugin Module")]),e._v(" for more information.")],1),e._v(" "),t("h3",{attrs:{id:"enhancement-definition"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#enhancement-definition"}},[e._v("#")]),e._v(" Enhancement Definition")]),e._v(" "),t("p",[e._v("The core capability of "),t("strong",[e._v("Sermant")]),e._v(" is to make non-intrusive bytecode enhancements to the host application, and these enhancement rules are base on plugins. In the "),t("code",[e._v("main")]),e._v(" module of each "),t("strong",[e._v("Sermant")]),e._v(" plugin, enhancement definitions can be defined to enhance the bytecode of specific methods of the host application to achieve certain functionality. So how the "),t("code",[e._v("main")]),e._v(" module tells the "),t("strong",[e._v("Sermant")]),e._v(" which classes to augment is an important topic.")]),e._v(" "),t("p",[e._v("The Enhancement definition of plugins requires the implementation of "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/agent/declarer/PluginDeclarer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("PluginDeclarer"),t("OutboundLink")],1),e._v(" interface, which contains two methods:")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("getClassMatcher")]),e._v(" is used to get the matcher "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/agent/matcher/ClassMatcher.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("ClassMatcher"),t("OutboundLink")],1),e._v(" of the enhanced class.")]),e._v(" "),t("li",[t("code",[e._v("getInterceptDeclarers")]),e._v(" is used to obtain the method of interceptor point of the enhanced class, as well as the interceptors embedded in it, encapsulated in the method interceptor point "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/agent/declarer/InterceptDeclarer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("InterceptDeclarer"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("li",[t("code",[e._v("getSuperTpeDecarers")]),e._v(" gets the plugin's superclass declaration "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/agent/declarer/SuperTypeDeclarer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("SuperTypeDeclarer"),t("OutboundLink")],1),e._v(".")])]),e._v(" "),t("p",[e._v("The matcher "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/agent/matcher/ClassMatcher.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("ClassMatcher"),t("OutboundLink")],1),e._v(", which provides two types of matchers in the core module:")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/agent/matcher/ClassTypeMatcher.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("ClassTypeMatcher"),t("OutboundLink")],1),e._v("(the matcher for class name)")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("The most common way to do this is purely by name matching, which is obtained by:")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ClassMatcher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("nameEquals")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${class reference}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("Where "),t("code",[e._v("${class reference}")]),e._v(" is the full qualified class name of the enhanced class.")])]),e._v(" "),t("li",[t("p",[e._v("Matching multiple classes by name, which is the plural version of "),t("code",[e._v("nameEquals")]),e._v(", can be obtained with the following method:")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ClassMatcher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("nameContains")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${class reference array}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("Where "),t("code",[e._v("${class reference array}")]),e._v(" is a full qualified class name mutable array of the enhanced class.")])])]),e._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/agent/matcher/ClassFuzzyMatcher.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("ClassFuzzyMatcher"),t("OutboundLink")],1),e._v("（the fuzzy matcher of class name）")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("The enhanced class is located by the prefix of full qualified class name, which can be obtained by:")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ClassMatcher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("namePrefixedWith")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${prefix}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("Where "),t("code",[e._v("${prefix}")]),e._v(" is the prefix of full qualified class name.")])]),e._v(" "),t("li",[t("p",[e._v("The enhanced class is located by the suffix of full qualified class name, which can be retrieved as follows:")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ClassMatcher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("nameSuffixedWith")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${suffix}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),t("p",[e._v("Where "),t("code",[e._v("${suffix}")]),e._v(" is the suffix of full qualified class name.")])]),e._v(" "),t("li",[t("p",[e._v("The enhanced class is located by the infix of full qualified class name, which can be obtained as follows:")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ClassMatcher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("nameinfixedWith")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${infix}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),t("p",[e._v("Where "),t("code",[e._v("${infix}")]),e._v(" is the infix of full qualified class name.")])]),e._v(" "),t("li",[t("p",[e._v("The enhanced class is located by matching the full qualified class name with a regular expression, which can be obtained as follows:")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ClassMatcher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("nameMatches")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${pattern}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),t("p",[e._v("Where "),t("code",[e._v("${pattern}")]),e._v(" is a regular expression.")])]),e._v(" "),t("li",[t("p",[e._v("The enhanced class is located by annotation decorated, which can be obtained as follows:")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ClassMatcher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("isAnnotationWith")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${annotation reference array}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("Where "),t("code",[e._v("${annotation reference array}")]),e._v(" is a full qualified class name array of annotations.")])]),e._v(" "),t("li",[t("p",[e._v("Locating a subclass by means of a superclass can be obtained using the following methods:")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ClassMatcher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("isExtendedFrom")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${super class array}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("Where "),t("code",[e._v("${super class array}")]),e._v(" is a superclass mutable array. Due to Java inheritance rules, the array can only have one "),t("code",[e._v("class")]),e._v(", the rest must be "),t("code",[e._v("interface")]),e._v(".")])]),e._v(" "),t("li",[t("p",[e._v("A matching logical operation, which is true when all matchers do not match:")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ClassMatcher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("not")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${class matcher array}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),t("p",[e._v("Where "),t("code",[e._v("${class matcher array}")]),e._v(" is a variable-length array of matcher.")])]),e._v(" "),t("li",[t("p",[e._v("A matching logical operation, which is true if the matcher matches all of them:")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ClassMatcher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("and")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${class matcher array}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),t("p",[e._v("Where "),t("code",[e._v("${class matcher array}")]),e._v(" is a variable-length array of matcher.")])]),e._v(" "),t("li",[t("p",[e._v("A matching logical operation, which is true if one of the matcher matches:")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ClassMatcher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("or")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${class matcher array}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),t("p",[e._v("Where "),t("code",[e._v("${class matcher array}")]),e._v(" is a variable-length array of matcher.")])])]),e._v(" "),t("p",[e._v("For method interception points "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/agent/matcher/MethodMatcher.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("MethodMatcher"),t("OutboundLink")],1),e._v(", we provide a variety of matching methods:")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("Match any method:")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("any")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])])]),e._v(" "),t("li",[t("p",[e._v("Match by method name:")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("nameEquals")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${method name}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("Where "),t("code",[e._v("${method name}")]),e._v(" is the method name.")])]),e._v(" "),t("li",[t("p",[e._v("Match static method:")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("isStaticMethod")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])])]),e._v(" "),t("li",[t("p",[e._v("Match constructor:")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("isConstructor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])])]),e._v(" "),t("li",[t("p",[e._v("Match multiple methods:")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("nameContains")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${method name array}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("Where "),t("code",[e._v("${method name array}")]),e._v(" is an array of method names.")])]),e._v(" "),t("li",[t("p",[e._v("Match by prefix of method name:")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("namePrefixedWith")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${method name prefix}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("Where "),t("code",[e._v("${method name prefix}")]),e._v(" is the prefix of method name .")])]),e._v(" "),t("li",[t("p",[e._v("Match by suffix of method name:")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("nameSuffixedWith")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${method name suffix}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("Where "),t("code",[e._v("${method name suffix}")]),e._v(" is the suffix of method name.")])]),e._v(" "),t("li",[t("p",[e._v("Match by infix of method name：")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("nameinfixedWith")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${method name infix}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("Where "),t("code",[e._v("${method name infix}")]),e._v(" is the infix of method name.")])]),e._v(" "),t("li",[t("p",[e._v("Match by regular expression:")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("nameMatches")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${pattern}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("Where "),t("code",[e._v("${pattern}")]),e._v(" is a regular expression.")])]),e._v(" "),t("li",[t("p",[e._v("Matches by annotation:")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("isAnnotatedWith")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${annotations array}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("Where "),t("code",[e._v("${annotations array}")]),e._v(" is the annotation set.")])]),e._v(" "),t("li",[t("p",[e._v("Match by specified number of arguments:")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("paramCountEquals")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${param count}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("Where "),t("code",[e._v("${param count}")]),e._v(" is the number of input parameters.")])]),e._v(" "),t("li",[t("p",[e._v("Match by the specific type of argument:")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("paramTypeEquals")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${param type array}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("Where "),t("code",[e._v("${param type array}")]),e._v(" is the set of input types.")])]),e._v(" "),t("li",[t("p",[e._v("Match by return type")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("resultTypeEquals")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${result type}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("Where "),t("code",[e._v("${result type}")]),e._v(" is the return type.")])]),e._v(" "),t("li",[t("p",[e._v("Logical operation, where the result is true if the method matcher set does not match at all.")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("not")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${element matcher array}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("Where "),t("code",[e._v("${element matcher array}")]),e._v(" is the set of method matcher.")])]),e._v(" "),t("li",[t("p",[e._v("Logical operation, where the result is true if the method matcher set fully matches.")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("and")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${element matcher array}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("Where "),t("code",[e._v("${element matcher array}")]),e._v(" is the set of method matcher.")])]),e._v(" "),t("li",[t("p",[e._v("Logical operation, where the result is true if method matcher set matches one of the result.")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("or")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${element matcher array}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("Where "),t("code",[e._v("${element matcher array}")]),e._v(" is the set of method matcher.")])])]),e._v(" "),t("p",[e._v("For more methods matching method, refer to "),t("a",{attrs:{href:"https://javadoc.io/doc/net.bytebuddy/byte-buddy/latest/net/bytebuddy/matcher/ElementMatchers.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("byte-buddy"),t("OutboundLink")],1),e._v(" methods with a generic type of "),t("code",[e._v("MethodDescription")]),e._v(" .")]),e._v(" "),t("p",[e._v("Don't forget to add the "),t("em",[e._v("SPI")]),e._v(" configuration file for the "),t("code",[e._v("PluginDeclarer")]),e._v(" interface:")]),e._v(" "),t("ul",[t("li",[e._v("Add "),t("code",[e._v("META-INF/services")]),e._v(" folder under "),t("code",[e._v("resources")]),e._v(".")]),e._v(" "),t("li",[e._v("Add "),t("code",[e._v("com.huaweicloud.sermant.core.plugin.agent.declarer.PluginDeclarer")]),e._v(" under "),t("code",[e._v("META-INF/services")]),e._v(" .")]),e._v(" "),t("li",[e._v("In the above file, type all the enhancements definitions of "),t("code",[e._v("PluginDeclarer")]),e._v(" in the plugin package separated with LF.")])]),e._v(" "),t("p",[e._v("The "),t("code",[e._v("example module")]),e._v(" of "),t("strong",[e._v("Sermant")]),e._v(" contains the following example implementation of the "),t("code",[e._v("PluginDeclarer")]),e._v(" interface:")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-plugin/src/main/java/com/huawei/example/demo/declarer/DemoAnnotationDeclarer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoAnnotationDeclarer"),t("OutboundLink")],1),e._v(": Locate enhanced class by annotation in the decorated class.")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-plugin/src/main/java/com/huawei/example/demo/declarer/DemoNameDeclarer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoNameDeclarer"),t("OutboundLink")],1),e._v(": Locate enhanced class by name.")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-plugin/src/main/java/com/huawei/example/demo/declarer/DemoSuperTypeDeclarer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoSuperTypeDeclarer"),t("OutboundLink")],1),e._v(": Locate enhanced class by superclass.")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-plugin/src/main/java/com/huawei/example/demo/declarer/DemoBootstrapDeclarer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoBootstrapDeclarer"),t("OutboundLink")],1),e._v(": Enhancement definition for the boot classloader, refer to "),t("a",{attrs:{href:"#Enhancement-for-Native-Class"}},[e._v("Enhancement for Native Class")]),e._v(" for details.")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-plugin/src/main/java/com/huawei/example/demo/declarer/DemoTraceDeclarer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoTraceDeclarer"),t("OutboundLink")],1),e._v(": Enhancement definition for the usage of trace tracking, refer to "),t("a",{attrs:{href:"#Trace-Tracking"}},[e._v("Trace Tracking")]),e._v(" for details.")])]),e._v(" "),t("p",[e._v("When the plugin developers write the plugin enhancement definition, you can use the above examples as a reference to develop the enhancement definition that meets their own needs.")]),e._v(" "),t("h4",{attrs:{id:"enhancement-for-native-class"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#enhancement-for-native-class"}},[e._v("#")]),e._v(" Enhancement for Native Class")]),e._v(" "),t("p",[e._v("For "),t("em",[e._v("Java")]),e._v(" native classes such as "),t("code",[e._v("java.lang.Thread")]),e._v(", which are loaded by the "),t("code",[e._v("BootStrapClassLoader")]),e._v(", there are two main difficulties in enhancing them:")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("Native classes are loaded by the BootStrapClassLoader, so if we want to enhance them, we need to overwrite the enhanced bytecode back into the BootStrapClassLoader. Considering that the enhanced embedded code is mostly written in "),t("strong",[e._v("interceptors")]),e._v(", this content is mainly loaded by the system class loader "),t("code",[e._v("AppClassLoader")]),e._v(", which is not accessible by BootStrapClassLoader. Since "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/tree/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/agent/template",target:"_blank",rel:"noopener noreferrer"}},[t("strong",[e._v("Advice template class")]),t("OutboundLink")],1),e._v(" invokes the interceptors by reflection, it is allowed to write interceptors without restrictions for enhancement of native classes.")])]),e._v(" "),t("li",[t("p",[e._v("Due to "),t("em",[e._v("Java")]),e._v(" redefining "),t("em",[e._v("Class")]),e._v(" restrictions, we can't modify the metadata of these native classes, so we can't use byte-buddy delegation to enhance them (by adding delegation properties and static code blocks). Fortunately, we can use "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/tree/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/agent/template",target:"_blank",rel:"noopener noreferrer"}},[t("strong",[e._v("Advice template class")]),t("OutboundLink")],1),e._v(" with "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/agent/transformer/BootstrapTransformer.java",target:"_blank",rel:"noopener noreferrer"}},[t("strong",[e._v("byte-buddy advice")]),t("OutboundLink")],1),e._v(" technology to enhance. That's what "),t("strong",[e._v("core module")]),e._v(" is doing.")])])]),e._v(" "),t("p",[e._v("Combined with the above, there is no difference between native classes and regular classes in terms of enhancement definition and writing interceptors. However, it is desirable for plugin developers to minimize enhancement to native classes for three reasons:")]),e._v(" "),t("ul",[t("li",[e._v("Enhancements to native classes tend to be divergent. And enhancements to them are likely to impact other plugins or host functionality.")]),e._v(" "),t("li",[e._v("The native class enhancement logic will use reflection to invoke interceptor methods in the system classloader. Due to the "),t("em",[e._v("Java")]),e._v(" redefinition of the "),t("em",[e._v("Class")]),e._v(", every time an enhanced method is called, the reflection logic is processed, which significantly limits the "),t("em",[e._v("TPS")]),e._v(" of the method.")]),e._v(" "),t("li",[e._v("The enhancements to the native classes involved using the "),t("strong",[e._v("Advice template class")]),e._v(" to generate a dynamic interceptor class. For each enhanced native class method, one will be generated dynamically and they will be loaded by the system classloader. If native classes are enhanced without restriction, loading dynamic classes can also become a significant burden during startup.")])]),e._v(" "),t("p",[e._v("In summary, "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/tree/develop/sermant-agentcore/sermant-agentcore-core",target:"_blank",rel:"noopener noreferrer"}},[t("strong",[e._v("Sermant")]),e._v(" core module"),t("OutboundLink")],1),e._v(" provides the ability to augment "),t("em",[e._v("Java")]),e._v(" native classes. However, it is not recommended to enhance them without restrictions. If there are multiple enhancement points to choose from, you'd better choose enhancing regular classes.")]),e._v(" "),t("p",[e._v("In "),t("strong",[e._v("Sermant")]),e._v(" "),t("code",[e._v("example module")]),e._v(", "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-plugin/src/main/java/com/huawei/example/demo/declarer/DemoBootstrapDeclarer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoBootstrapDeclarer"),t("OutboundLink")],1),e._v(" enhances "),t("code",[e._v("java.lang.Thread")]),e._v(". You can launch the example application "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/demo-application/src/main/java/com/huawei/example/demo/DemoApplication.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoApplication"),t("OutboundLink")],1),e._v(" to see if "),t("code",[e._v("java.lang.Thread")]),e._v(" is enhanced properly.")]),e._v(" "),t("h3",{attrs:{id:"interceptor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#interceptor"}},[e._v("#")]),e._v(" Interceptor")]),e._v(" "),t("p",[e._v("In the development of the new version of the plugin, the distinction between static methods, constructors and instance methods is no longer made at the interceptor level, which reduces the complexity of plugin development.\nFor "),t("code",[e._v("MethodInterceptPoint")]),e._v(", there are three acquisition types: static method, constructor, and instance method. There are also three types of interceptors:")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/agent/interceptor/Interceptor.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("interceptor"),t("OutboundLink")],1),e._v(": the interceptor interface, which contains three methods:\n"),t("ul",[t("li",[t("code",[e._v("before")]),e._v(", the preceding method, which is executed before the interception point. The ExecuteContext parameter is the context of the plugin execution, which encapsulates all the parameters required for the interceptor to operate. Through the skip method, the main process can be skipped and the final method result can be set. Note that the main process cannot be skipped when the constructor is enhanced .")]),e._v(" "),t("li",[t("code",[e._v("after")]),e._v(", the post-method, ends up in the post-method whether or not the intercepted method executes normally. Postmethods can override the return value of the intercepted method with their return value, so developers need to be careful not to return null easily here.")]),e._v(" "),t("li",[t("code",[e._v("onThrow")]),e._v(", an exception handling method that is triggered when the intercepted method executes an exception. Handling the exception here does not affect the normal throwing of the exception.")])])])]),e._v(" "),t("p",[e._v("The "),t("code",[e._v("example module")]),e._v(" of "),t("strong",[e._v("Sermant")]),e._v(" contains the following example interceptor:")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-plugin/src/main/java/com/huawei/example/demo/interceptor/DemoStaticInterceptor.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoStaticInterceptor"),t("OutboundLink")],1),e._v(": an ordinary static method interceptor")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-plugin/src/main/java/com/huawei/example/demo/interceptor/DemoConstInterceptor.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoConstInterceptor"),t("OutboundLink")],1),e._v(": an ordinary constructor interceptor")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-plugin/src/main/java/com/huawei/example/demo/interceptor/DemoMemberInterceptor.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoMemberInterceptor"),t("OutboundLink")],1),e._v(": an ordinary instance method interceptor")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-plugin/src/main/java/com/huawei/example/demo/interceptor/DemoConfigInterceptor.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoConfigInterceptor"),t("OutboundLink")],1),e._v(": an example interceptor for the plugin configuration acquisition, as described in the "),t("a",{attrs:{href:"#Plugin-Configuration"}},[e._v("Plugin Configuration")]),e._v(" section.")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-plugin/src/main/java/com/huawei/example/demo/interceptor/DemoServiceInterceptor.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoServiceInterceptor"),t("OutboundLink")],1),e._v(": an example interceptor for the usage of plugin service, as described in the "),t("a",{attrs:{href:"#Plugin-Service"}},[e._v("Plugin Service")]),e._v(" section.")])]),e._v(" "),t("p",[e._v("When writing custom interceptors, plugin developers can use the above example as a reference to develop interceptors that meet their own functional needs.")]),e._v(" "),t("h3",{attrs:{id:"plugin-configuration"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#plugin-configuration"}},[e._v("#")]),e._v(" Plugin Configuration")]),e._v(" "),t("p",[t("strong",[e._v("Plugin Configuration")]),e._v(" refers to the configuration system used in plugin packages and plugin service packages. It consists of three main parts:")]),e._v(" "),t("ul",[t("li",[t("p",[t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/config/PluginConfig.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("PluginConfig"),t("OutboundLink")],1),e._v(" plugin configuration interface: All normal plugin configurations must implement this interface.")])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/config/PluginConfigManager.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("PluginConfigManager"),t("OutboundLink")],1),e._v(" plugin configuration manager: provides a method to get the plugin configuration "),t("code",[e._v("PluginConfig")]),e._v(" :")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// ${plugin config class} is the plugin configuration class")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("PluginConfigManager")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getPluginConfig")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("$"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("plugin config "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[t("code",[e._v("PluginConfigManager")]),e._v(" is the unified configuration manager "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/config/ConfigManager.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("ConfigManager"),t("OutboundLink")],1),e._v(", The plugin side can directly use the interface of the latter to obtain plugin configuration and unified configuration：")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// ${base config class}is the plugin configuration class or unified configuration class")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ConfigManager")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getConfig")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("$"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("base config "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])])])]),e._v(" "),t("p",[e._v("From the "),t("strong",[e._v("Sermant")]),e._v(" "),t("code",[e._v("example module")]),e._v(" plugin configuration file "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/config/config.yaml",target:"_blank",rel:"noopener noreferrer"}},[e._v("config.yaml"),t("OutboundLink")],1),e._v(" can be seen that the configuration file is a "),t("em",[e._v("yaml file")]),e._v(". The "),t("code",[e._v("plugin")]),e._v(" and "),t("code",[e._v("service")]),e._v(" configurations of a "),t("code",[e._v("main")]),e._v(" plugin module are encapsulated in a single "),t("code",[e._v("config.yaml")]),e._v(".")]),e._v(" "),t("p",[e._v("Instead of a traditional "),t("em",[e._v("YAML")]),e._v(" format configuration file for a single "),t("em",[e._v("Java Pojo")]),e._v(" object, here "),t("code",[e._v("config.yaml")]),e._v(" can encapsulate multiple "),t("em",[e._v("Java Pojos")]),e._v(", which are distinguished by fully qualified names or aliases, forming a "),t("em",[e._v("Map-like")]),e._v(" structure. The key "),t("code",[e._v("demo.test")]),e._v(" corresponds to the "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-plugin/src/main/java/com/huawei/example/demo/config/DemoConfig.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoConfig"),t("OutboundLink")],1),e._v(" object in the "),t("strong",[e._v("example plugin package")]),e._v(" and "),t("code",[e._v("com.huawei.example.demo.config.DemoServiceConfig")]),e._v(" key corresponds to "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-service/src/main/java/com/huawei/example/demo/config/DemoServiceConfig.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoServiceConfig"),t("OutboundLink")],1),e._v(" object in the "),t("strong",[e._v("example plugin service pack")]),e._v(".")]),e._v(" "),t("p",[e._v("Compared to "),t("code",[e._v("DemoServiceConfig")]),e._v(", "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-plugin/src/main/java/com/huawei/example/demo/config/DemoConfig.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoConfig"),t("OutboundLink")],1),e._v(" is decorated with the "),t("a",{attrs:{href:"../../sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/config/common/ConfigTypeKey.java"}},[e._v("ConfigTypeKey")]),e._v(" annotation, so the "),t("code",[e._v("demo.test")]),e._v(" alias is set. If it is not annotated with the "),t("code",[e._v("ConfigTypeKey")]),e._v(" annotation, the full qualified class name is used as the index.")]),e._v(" "),t("p",[e._v("The "),t("code",[e._v("map")]),e._v(" property in "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-plugin/src/main/java/com/huawei/example/demo/config/DemoConfig.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoConfig"),t("OutboundLink")],1),e._v(" is annotated with "),t("a",{attrs:{href:"../../sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/config/common/ConfigFieldKey.java"}},[e._v("ConfigFieldKey")]),e._v(", changing its property name to "),t("code",[e._v("str2DemoSimplePojoMap")]),e._v(". However, it is important to note that the semantics of the "),t("strong",[e._v("Java Pojo")]),e._v(" using this annotation is invalid if it is wrapped by an array, a "),t("em",[e._v("List")]),e._v(" or a "),t("em",[e._v("Map")]),e._v(". Therefore, for now, this annotation can only be used to modify the current "),t("strong",[e._v("plugin configuration class")]),e._v(" or directly used "),t("strong",[e._v("Java Pojo")]),e._v(".")]),e._v(" "),t("p",[e._v("As "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-plugin/src/main/java/com/huawei/example/demo/config/DemoConfig.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoConfig"),t("OutboundLink")],1),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-plugin/src/main/java/com/huawei/example/demo/config/DemoConfig.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoConfig"),t("OutboundLink")],1),e._v(" shows, plugin configuration now supports data types include:")]),e._v(" "),t("ul",[t("li",[e._v("Primitive and wrapper types for Boolean and numeric classes")]),e._v(" "),t("li",[e._v("String")]),e._v(" "),t("li",[e._v("Enum")]),e._v(" "),t("li",[e._v("Complex object")]),e._v(" "),t("li",[e._v("Array of the above types")]),e._v(" "),t("li",[e._v("List of the first four types")]),e._v(" "),t("li",[e._v("Map of the first four types")])]),e._v(" "),t("p",[t("em",[e._v("YAML")]),e._v(" format configuration files currently have a few other rules:")]),e._v(" "),t("ul",[t("li",[e._v("For complex objects involved in arrays, lists, and maps, using "),t("code",[e._v("ConfigFieldKey")]),e._v(" to fix property names is not supported.")]),e._v(" "),t("li",[e._v("For strings in arrays, lists, and maps, there is no support for "),t("code",[e._v("${}")]),e._v(" conversions, "),t("strong",[e._v("plugin configuration class")]),e._v(" string properties and string properties inside complex type properties are supported.")]),e._v(" "),t("li",[e._v("Parameters are only used for string "),t("code",[e._v("${}")]),e._v(" conversions. Direct setting property values using parameters is not supported.")]),e._v(" "),t("li",[e._v("The field names of configuration classes are usually small camels.You can use "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/config/common/ConfigTypeKey.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("ConfigFieldKey"),t("OutboundLink")],1),e._v(" to define aliases for the transverse-line style. After the annotation is added, it can be parsed in "),t("em",[e._v("YAML")]),e._v(" using either transverse-line or small camel style. Refer to the "),t("code",[e._v("intField")]),e._v(" of "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-plugin/src/main/java/com/huawei/example/demo/config/DemoConfig.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoConfig"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("li",[e._v("The priority of the configuration is: startup parameters > environment variables > system variables (-d parameter) > "),t("em",[e._v("YAML")]),e._v(" file configuration")]),e._v(" "),t("li",[e._v("The camel style and transverse line can be used to split words to look for matches when the configuration class properties fetch reference values according to the priority(startup parameters, environment variables, and system variables (-d parameter)) in effect. For example, for "),t("code",[e._v("intField")]),e._v(" of "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-plugin/src/main/java/com/huawei/example/demo/config/DemoConfig.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoConfig"),t("OutboundLink")],1),e._v(", the key will be transformed into one of the following forms and searched in order:\n"),t("ul",[t("li",[e._v("demo.test.intField")]),e._v(" "),t("li",[e._v("demo_test_intField")]),e._v(" "),t("li",[e._v("demo-test-intField")]),e._v(" "),t("li",[e._v("DEMO.TEST.INTFIELD")]),e._v(" "),t("li",[e._v("DEMO_TEST_INTFIELD")]),e._v(" "),t("li",[e._v("DEMO-TEST-INTFIELD")]),e._v(" "),t("li",[e._v("demo.test.intfield")]),e._v(" "),t("li",[e._v("demo_test_intfield")]),e._v(" "),t("li",[e._v("demo-test-intfield")]),e._v(" "),t("li",[e._v("demo.test.int.field")]),e._v(" "),t("li",[e._v("demo_test_int_field")]),e._v(" "),t("li",[e._v("demo-test-int-field")]),e._v(" "),t("li",[e._v("DEMO.TEST.INT.FIELD")]),e._v(" "),t("li",[e._v("DEMO_TEST_INT_FIELD")]),e._v(" "),t("li",[e._v("DEMO-TEST-INT-FIELD")])])]),e._v(" "),t("li",[e._v("If the key of the basic data type/array /map/list/set(which does not support complex objects) is not defined in the "),t("em",[e._v("YAML")]),e._v(" configuration, the reference value will be obtained according to the priority of the configuration effect: startup parameters > environment variables > system variables (-d parameter). When retrieving reference values from the above data sources, note that:\n"),t("ul",[t("li",[e._v("The array /list/set should be configured in "),t("code",[e._v("YAML")]),e._v(" string format. For example: DEMO_TEST_LIST_NAME=[elem1,elem2]")]),e._v(" "),t("li",[e._v("The map needs to be configured as a "),t("code",[e._v("YAML")]),e._v(" string format. For example: DEMO_TEST_MAP_NAME={key1: value1, key2: value2}")])])])]),e._v(" "),t("p",[e._v("Most of the possible configuration scenarios are covered in "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-plugin/src/main/java/com/huawei/example/demo/config/DemoConfig.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoConfig"),t("OutboundLink")],1),e._v(", plugin developers can reference and write plugin configuration classes that meet your business needs.")]),e._v(" "),t("p",[e._v("Finally, don't forget to add the "),t("em",[e._v("SPI")]),e._v(" configuration file for the plugin configuration:")]),e._v(" "),t("ul",[t("li",[e._v("Add "),t("code",[e._v("META-INF/services")]),e._v(" folder under "),t("code",[e._v("resources")]),e._v(".")]),e._v(" "),t("li",[e._v("Add "),t("code",[e._v("com.huaweicloud.sermant.core.plugin.config.PluginConfig")]),e._v(" configuration file under "),t("code",[e._v("META-INF/services")]),e._v(".")]),e._v(" "),t("li",[e._v("In the above file, type the "),t("code",[e._v("PluginConfig")]),e._v(" implementation for all plugin configurations in the plugin package and separate them by LF.")])]),e._v(" "),t("h3",{attrs:{id:"plugin-service"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#plugin-service"}},[e._v("#")]),e._v(" Plugin Service")]),e._v(" "),t("p",[t("strong",[e._v("Plugin service")]),e._v(" refers to the service system used in plugin package and plugin service package. It mainly consists of two parts:")]),e._v(" "),t("ul",[t("li",[t("p",[t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/service/PluginService.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("PluginService"),t("OutboundLink")],1),e._v(", the plugin service interface.")])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/service/PluginServiceManager.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("PluginServiceManager"),t("OutboundLink")],1),e._v(", the plugin service manager, which provides an interface to get "),t("code",[e._v("PluginService")]),e._v(" :")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// ${plugin service class} is the plugin service class")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("PluginServiceManager")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getPluginService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("$"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("plugin service "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[t("code",[e._v("PluginServiceManager")]),e._v(" is a particular case of "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/service/ServiceManager.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("ServiceManager"),t("OutboundLink")],1),e._v(". The latter interface can be used directly to access the core and plugin services:")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// ${base service class}is the core service class or plugin service class")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ServiceManager")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("$"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("base service "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("Learned form "),t("RouterLink",{attrs:{to:"/en/document/UserGuide/plugin.html#Add-Plugin-Module"}},[e._v("Plugin Module")]),e._v(", plugins can be categorized as "),t("strong",[e._v("simple plugins")]),e._v(" and "),t("strong",[e._v("complex plugins")]),e._v(", depending on the complexity of the service they define:")],1),e._v(" "),t("ul",[t("li",[e._v("Services defined in "),t("strong",[e._v("simple plugins")]),e._v(" can only use "),t("em",[e._v("Java")]),e._v(" native "),t("em",[e._v("APIs")]),e._v(", self-developed "),t("em",[e._v("APIs")]),e._v(" (start with "),t("code",[e._v("com.huawei")]),e._v(") in "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/tree/develop/sermant-agentcore/sermant-agentcore-core",target:"_blank",rel:"noopener noreferrer"}},[t("strong",[e._v("Sermant")]),e._v(" core module"),t("OutboundLink")],1),e._v(" , and "),t("em",[e._v("APIs")]),e._v(" of "),t("code",[e._v("byte-buddy")]),e._v(" and "),t("code",[e._v("slf4j")]),e._v(".")]),e._v(" "),t("li",[e._v("In addition to the above "),t("em",[e._v("API")]),e._v(", the services in "),t("strong",[e._v("complex plugins")]),e._v(" have the right to use other "),t("em",[e._v("APIs")]),e._v(" that third parties rely on. These services need to be separated into the "),t("strong",[e._v("plugin service interface")]),e._v(" and the "),t("strong",[e._v("plugin service implementation")]),e._v(": the former is written in the "),t("code",[e._v("plugin")]),e._v(" module for the interceptor to invoke. The latter is written in the "),t("code",[e._v("service")]),e._v(" module and loaded by a custom "),t("em",[e._v("ClassLoader")]),e._v(" to achieve classloader-level dependency isolation.")])])])]),e._v(" "),t("h4",{attrs:{id:"simple-plugin-service"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#simple-plugin-service"}},[e._v("#")]),e._v(" Simple Plugin Service")]),e._v(" "),t("p",[e._v("As for "),t("strong",[e._v("simple plugin service")]),e._v(", you can just implement "),t("a",{attrs:{href:"../../sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/service/PluginService.java"}},[e._v("PluginService")]),e._v(", such as "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-plugin/src/main/java/com/huawei/example/demo/service/DemoSimpleService.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoSimpleService"),t("OutboundLink")],1),e._v(". Based on the implementation of the "),t("code",[e._v("start")]),e._v(" and "),t("code",[e._v("stop")]),e._v(" methods, you can add other required methods such as the "),t("code",[e._v("activeFunc")]),e._v(" method. Get an instance of the "),t("code",[e._v("DemoSimpleService")]),e._v(" and invoke the "),t("code",[e._v("activeFunc")]),e._v(" method with the following code:")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("DemoSimpleService")]),e._v(" simpleService "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("PluginServiceManager")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getPluginService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("DemoSimpleService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\nsimpleService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("activeFunc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("For "),t("strong",[e._v("simple plugin service")]),e._v(", the only restriction is to use only the "),t("em",[e._v("Java")]),e._v(" native "),t("em",[e._v("API")]),e._v(", "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/tree/develop/sermant-agentcore/sermant-agentcore-core",target:"_blank",rel:"noopener noreferrer"}},[t("strong",[e._v("Sermant")]),e._v(" core module"),t("OutboundLink")],1),e._v(" self-developed "),t("em",[e._v("APIs")]),e._v(" (starting with "),t("code",[e._v("com.huawei")]),e._v(") and "),t("em",[e._v("APIs")]),e._v(" in "),t("code",[e._v("byte-buddy")]),e._v(" and "),t("code",[e._v("slf4j")]),e._v(".")]),e._v(" "),t("p",[e._v("Plugin developers can refer to "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-plugin/src/main/java/com/huawei/example/demo/service/DemoSimpleService.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoSimpleService"),t("OutboundLink")],1),e._v(" to write "),t("strong",[e._v("simple plugin services")]),e._v(" for your business on demand.")]),e._v(" "),t("p",[e._v("Finally, don't forget to add the "),t("em",[e._v("SPI")]),e._v(" configuration file for "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/service/PluginService.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("PluginService"),t("OutboundLink")],1),e._v(":")]),e._v(" "),t("ul",[t("li",[e._v("Add "),t("code",[e._v("META-INF/services")]),e._v(" folder under "),t("code",[e._v("resources")]),e._v(".")]),e._v(" "),t("li",[e._v("Add "),t("code",[e._v("com.huaweicloud.sermant.core.plugin.service.PluginService")]),e._v(" configuration file under "),t("code",[e._v("META-INF/services")]),e._v(".")]),e._v(" "),t("li",[e._v("In the above file, type the "),t("code",[e._v("PluginService")]),e._v(" implementation for all plugin services in the plugin package and separate them by LF.")])]),e._v(" "),t("p",[e._v("In particular, do not try to get instances of other "),t("strong",[e._v("plugin services")]),e._v(" in the "),t("code",[e._v("start")]),e._v(" method of "),t("code",[e._v("PluginService")]),e._v(", since "),t("strong",[e._v("plugin services")]),e._v(" are still being initialized and it may not be possible to get these "),t("strong",[e._v("plugin services")]),e._v(" correctly.")]),e._v(" "),t("h4",{attrs:{id:"complex-plugin-service"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#complex-plugin-service"}},[e._v("#")]),e._v(" Complex Plugin Service")]),e._v(" "),t("p",[e._v("There are only two differences between "),t("strong",[e._v("complex plugin service")]),e._v(" and "),t("strong",[e._v("simple plugin service")]),e._v(":")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("Complex plugin services")]),e._v(" write their interface in the "),t("code",[e._v("plugin")]),e._v(" module and their implementation in the "),t("a",{attrs:{href:"#Plugin-Service-Module"}},[e._v("Plugin Service Module")]),e._v(", while "),t("strong",[e._v("simple plugin services")]),e._v(" do not need to write the interface and are implemented directly in the "),t("code",[e._v("plugin")]),e._v(" module.")]),e._v(" "),t("li",[e._v("The implementation of a "),t("strong",[e._v("complex plugin service")]),e._v(" can use any third-party dependency on demand.")])]),e._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-plugin/src/main/java/com/huawei/example/demo/service/DemoComplexService.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoComplexService"),t("OutboundLink")],1),e._v(" is a "),t("strong",[e._v("complex plugin service")]),e._v(" sample interface. Methods can be added on demand, such as the "),t("code",[e._v("activeFunc")]),e._v(" method. "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-service/src/main/java/com/huawei/example/demo/service/DemoComplexServiceImpl.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoComplexServiceImpl"),t("OutboundLink")],1),e._v(" is the corresponding implementation. We can invoke the "),t("code",[e._v("activeFunc")]),e._v(" method with the following code:")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("DemoComplexService")]),e._v(" complexService "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("PluginServiceManager")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getPluginService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("DemoComplexService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\ncomplexService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("activeFunc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("Adding "),t("em",[e._v("SPI")]),e._v(" configuration and other considerations is no different than "),t("strong",[e._v("simple plugin service")]),e._v(". Developers can refer the "),t("code",[e._v("DemoComplexService")]),e._v(" interface and "),t("code",[e._v("DemoComplexServiceImpl")]),e._v(" implementation to write "),t("strong",[e._v("complex plugin services")]),e._v(" that meet business requirements.")]),e._v(" "),t("h4",{attrs:{id:"log"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#log"}},[e._v("#")]),e._v(" Log")]),e._v(" "),t("p",[e._v("Considering dependency isolation, "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/tree/develop/sermant-agentcore/sermant-agentcore-core",target:"_blank",rel:"noopener noreferrer"}},[t("strong",[e._v("Sermant")]),e._v(" core module"),t("OutboundLink")],1),e._v(" provides the "),t("code",[e._v("plugin")]),e._v(" and "),t("code",[e._v("service")]),e._v(" to use only "),t("strong",[e._v("jul")]),e._v(" log. Get the "),t("strong",[e._v("jul")]),e._v(" log instance by:")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[e._v("com"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("huaweicloud"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("sermant"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("core"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("common"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("LoggerFactory")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Logger")]),e._v(" logger"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("LoggerFactory")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getLogger")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("Plugin developers who need to output log information can refer to "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-plugin/src/main/java/com/huawei/example/demo/common/DemoLogger.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoLogger"),t("OutboundLink")],1),e._v(" sample development.")]),e._v(" "),t("h4",{attrs:{id:"heartbeat"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#heartbeat"}},[e._v("#")]),e._v(" Heartbeat")]),e._v(" "),t("p",[e._v("Heartbeat is one of the core services in "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/tree/develop/sermant-agentcore/sermant-agentcore-core",target:"_blank",rel:"noopener noreferrer"}},[t("strong",[e._v("Sermant")]),e._v(" core module"),t("OutboundLink")],1),e._v(". An instance of heartbeatService is obtained by:")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("HeartbeatService")]),e._v(" heartbeatService "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ServiceManager")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("HeartbeatService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("The heartbeat service starts execution when it is initialized, and periodically sends the name, version and other information of each plugin to the backend server. Currently, plugin heartbeats report information like:")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("hostname")]),e._v(": the hostname of the sending client")]),e._v(" "),t("li",[t("code",[e._v("ip")]),e._v(": the ip of the sending client")]),e._v(" "),t("li",[t("code",[e._v("app")]),e._v(": application name, as well as "),t("code",[e._v("appName")]),e._v(" in startup parameters")]),e._v(" "),t("li",[t("code",[e._v("appType")]),e._v(": application type，as well as "),t("code",[e._v("appType")]),e._v(" in startup parameters")]),e._v(" "),t("li",[t("code",[e._v("heartbeatVersion")]),e._v(": time of last heartbeat")]),e._v(" "),t("li",[t("code",[e._v("lastHeartbeat")]),e._v(": time of last heartbeat")]),e._v(" "),t("li",[t("code",[e._v("version")]),e._v(": the version of the core package, as well as the "),t("code",[e._v("sermant-version")]),e._v(" value of the core package "),t("code",[e._v("manifest")]),e._v(" file")]),e._v(" "),t("li",[t("code",[e._v("pluginName")]),e._v(": plugin name")]),e._v(" "),t("li",[t("code",[e._v("pluginVersion")]),e._v("：plugin version, which is the "),t("code",[e._v("Sermant-plugin-version")]),e._v(" value of the "),t("code",[e._v("manifest")]),e._v(" file in the plugin jar")])]),e._v(" "),t("p",[e._v("If you want to add additional content to the data reported by the plugin, you can call the following API:")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// use ExtInfoProvider to add additional content")]),e._v("\nheartbeatService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("setExtInfo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ExtInfoProvider")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[e._v("@Override")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Map")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getExtInfo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// do something")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("Plugin developers who need to add additional content to the packets sent by the heartbeat function can refer to "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-plugin/src/main/java/com/huawei/example/demo/service/DemoHeartBeatService.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoHeartBeatService"),t("OutboundLink")],1),e._v(" sample development.")]),e._v(" "),t("p",[e._v("For more information about heartbeat services, see "),t("RouterLink",{attrs:{to:"/en/document/developer-guide/service_heartbeat.html"}},[e._v("Heartbeat Service")]),e._v(".")],1),e._v(" "),t("h4",{attrs:{id:"trace-tracking"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#trace-tracking"}},[e._v("#")]),e._v(" Trace Tracking")]),e._v(" "),t("p",[e._v("The "),t("strong",[e._v("Trace Tracking")]),e._v(" is an upper layer function established by message sending capability, which simply means embedding the following logic between the invoke chains of the host side:")]),e._v(" "),t("ul",[t("li",[e._v("When sending data, the "),t("code",[e._v("TraceId")]),e._v(" and "),t("code",[e._v("SpanId")]),e._v(" required by the trace are inserted in the data packet. The former is the view of the whole trace in the distributed system, and the later represents the view inside the different services in the whole trace.")]),e._v(" "),t("li",[e._v("When receiving data, it parses the trace-related content embedded in the data packet, forms a trace and submits it to the backend server, and gradually forms a invoke chain.")])]),e._v(" "),t("p",[e._v("In the "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/demo-application/src/main/java/com/huawei/example/demo/service/DemoTraceService.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoTraceService"),t("OutboundLink")],1),e._v(", the "),t("code",[e._v("counsumer")]),e._v(" and "),t("code",[e._v("provider")]),e._v(" methods mimic how the server receives data and handles sending it, while the packet is assumed to exist in a "),t("code",[e._v("ThreadLocal")]),e._v(" until the next invocation to the "),t("code",[e._v("provider")]),e._v(" method receives the data.")]),e._v(" "),t("p",[e._v("Based on the above example host application, we write enhancement definition "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-plugin/src/main/java/com/huawei/example/demo/declarer/DemoTraceDeclarer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoTraceDeclarer"),t("OutboundLink")],1),e._v(" and enhance "),t("code",[e._v("provider")]),e._v(" and "),t("code",[e._v("consumer")]),e._v(" of "),t("code",[e._v("DemoTraceService")]),e._v(" by "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-plugin/src/main/java/com/huawei/example/demo/interceptor/DemoTraceProviderInterceptor.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoTraceProviderInterceptor"),t("OutboundLink")],1),e._v(" and "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-plugin/src/main/java/com/huawei/example/demo/interceptor/DemoTraceConsumerInterceptor.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoTraceConsumerInterceptor"),t("OutboundLink")],1),e._v(" respectively")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("For the sending "),t("code",[e._v("provider")]),e._v(" method, the following enhancements are made：")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[e._v("  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("private")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("final")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("TracingService")]),e._v(" tracingService "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ServiceManager")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("TracingService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[e._v("@Override")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ExecuteContext")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("before")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ExecuteContext")]),e._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("throws")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Exception")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("TracingRequest")]),e._v(" request "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("\n          "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("TracingRequest")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getRawCls")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getMethod")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n      "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ExtractService")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("HashMap")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),e._v(" extractService "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("tracingRequest"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" carrier"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("->")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n          tracingRequest"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("setTraceId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("carrier"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("TracingHeader")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[e._v("TRACE_ID")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getValue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n          tracingRequest"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("setParentSpanId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("carrier"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("TracingHeader")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[e._v("PARENT_SPAN_ID")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getValue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n          tracingRequest"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("setSpanIdPrefix")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("carrier"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("TracingHeader")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[e._v("SPAN_ID_PREFIX")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getValue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n      tracingService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("onProviderSpanStart")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" extractService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("HashMap")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getArguments")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[e._v("@Override")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ExecuteContext")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("after")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ExecuteContext")]),e._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("throws")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Exception")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      tracingService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("onSpanFinally")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[e._v("@Override")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ExecuteContext")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("onThrow")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ExecuteContext")]),e._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("throws")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Exception")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      tracingService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("onSpanError")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getThrowable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])])]),e._v(" "),t("li",[t("p",[e._v("For the "),t("code",[e._v("consumer")]),e._v(" method, the following enhancements are made：")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[e._v("  "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("TracingService")]),e._v(" tracingService "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ServiceManager")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("TracingService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[e._v("@Override")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ExecuteContext")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("before")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ExecuteContext")]),e._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("throws")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Exception")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[e._v("@Override")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ExecuteContext")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("after")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ExecuteContext")]),e._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("throws")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Exception")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("TracingRequest")]),e._v(" request "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("\n          "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("TracingRequest")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getRawCls")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getMethod")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n      "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("InjectService")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("HashMap")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),e._v(" injectService "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("spanEvent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" carrier"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("->")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n          carrier"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("TracingHeader")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[e._v("TRACE_ID")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getValue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" spanEvent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getTraceId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n          carrier"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("TracingHeader")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[e._v("PARENT_SPAN_ID")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getValue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" spanEvent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getSpanId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n          carrier"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("TracingHeader")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[e._v("SPAN_ID_PREFIX")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getValue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" spanEvent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getNextSpanIdPrefix")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n      tracingService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("onConsumerSpanStart")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" injectService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("HashMap")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getResult")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n      tracingService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("onSpanFinally")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[e._v("@Override")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ExecuteContext")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("onThrow")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ExecuteContext")]),e._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("throws")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Exception")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      tracingService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("onSpanError")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getThrowable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),t("p",[e._v("If the plugin developers need to use the trace tracking function, refer to "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-plugin/src/main/java/com/huawei/example/demo/interceptor/DemoTraceNormalInterceptor.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoTraceNormalInterceptor"),t("OutboundLink")],1),e._v(" for further development.")])])]),e._v(" "),t("h3",{attrs:{id:"dynamic-configuration"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dynamic-configuration"}},[e._v("#")]),e._v(" Dynamic Configuration")]),e._v(" "),t("p",[e._v("Dynamic configuration is one of the core services in "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/tree/develop/sermant-agentcore/sermant-agentcore-core",target:"_blank",rel:"noopener noreferrer"}},[t("strong",[e._v("Sermant")]),e._v(" core module"),t("OutboundLink")],1),e._v(". An instance is obtained by:")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("DynamicConfigService")]),e._v(" service "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ServiceManager")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("getService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("DynamicConfigService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("Invoke the following method to register a listener:")]),e._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// ${group} is user group，${key} is the key listened. For zookeeper, the path is: / + ${group} + ${key}")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// if ${group} do not exist，it will set the value by dynamicconfig.default_group in unified configuration")]),e._v("\nservice"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("addConfigListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${key}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${group}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("DynamicConfigListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[e._v("@Override")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("process")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ConfigChangedEvent")]),e._v(" event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// do something")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("Once the listener is registered, the "),t("code",[e._v("process")]),e._v(" method will be triggered when the server creates, deletes, modifies, or adds child nodes.")]),e._v(" "),t("p",[e._v("Plugin developers who need to use dynamic configuration can refer to "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant-examples/tree/main/sermant-template/template/template-plugin/src/main/java/com/huawei/example/demo/service/DemoDynaConfService.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DemoDynaConfService"),t("OutboundLink")],1),e._v(" sample development.")]),e._v(" "),t("p",[e._v("For more information on dynamic configuration service, refer to "),t("RouterLink",{attrs:{to:"/en/document/developer-guide/service_dynamicconfig.html"}},[e._v("Dynamic Configuration Service")]),e._v(".")],1),e._v(" "),t("h2",{attrs:{id:"plugin-service-module"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#plugin-service-module"}},[e._v("#")]),e._v(" Plugin Service Module")]),e._v(" "),t("p",[e._v("Compared to "),t("strong",[e._v("plugin module")]),e._v(", "),t("strong",[e._v("plugin service module")]),e._v(" :")]),e._v(" "),t("ul",[t("li",[e._v("can only write a "),t("strong",[e._v("plugin configuration")]),e._v(" and "),t("strong",[e._v("plugin service interface")]),e._v(" implementation, and cannot write **enhancement definition ** "),t("strong",[e._v("interceptor")]),e._v(" and "),t("strong",[e._v("plugins service interface")]),e._v(".")]),e._v(" "),t("li",[e._v("allow the freedom to add third-party dependencies as needed. When packaging, you need to provide a way to export dependencies, you can use the "),t("code",[e._v("shade")]),e._v(" plugin or "),t("code",[e._v("assembly")]),e._v(" plugin to export the dependency "),t("em",[e._v("jar")]),e._v(" package, or you can directly use the "),t("code",[e._v("dependency")]),e._v(" plugin to export the dependency package.")])]),e._v(" "),t("p",[e._v("Note: Due to the limitations of the "),t("code",[e._v("byte-buddy")]),e._v(" and "),t("code",[e._v("slf4j")]),e._v(" packages, it is still recommended to use the "),t("code",[e._v("shade")]),e._v(" plugin package directly. The relevant rules are defined in the "),t("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/tree/develop/sermant-plugins",target:"_blank",rel:"noopener noreferrer"}},[e._v("main module of plugins"),t("OutboundLink")],1),e._v(". You can directly import the plugin. Refer to "),t("RouterLink",{attrs:{to:"/en/document/UserGuide/plugin.html#Add-Plugin-Service-Module"}},[e._v("Plugin Module")]),e._v(" for details.")],1),e._v(" "),t("p",[e._v("The "),t("strong",[e._v("plugin service module")]),e._v(" usually involves writing "),t("a",{attrs:{href:"#Plugin-Configuration"}},[e._v("plugin configuration")]),e._v(" and "),t("a",{attrs:{href:"#Plugin-Service"}},[e._v("plugin service")]),e._v(", where "),t("strong",[e._v("plugin service")]),e._v(" mainly refers to the implementation of "),t("a",{attrs:{href:"#Complex-Plugin-Service"}},[e._v("complex plugin service")]),e._v(".")])])}),[],!1,null,null,null);t.default=s.exports}}]);