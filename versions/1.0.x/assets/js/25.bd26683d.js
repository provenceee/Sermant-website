(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{471:function(e,a,t){"use strict";t.r(a);var n=t(26),s=Object(n.a)({},(function(){var e=this,a=e._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"introduction"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#introduction"}},[e._v("#")]),e._v(" Introduction")]),e._v(" "),a("p",[e._v("This document mainly explains the plug-in development of "),a("strong",[e._v("Sermant")]),e._v(".")]),e._v(" "),a("h2",{attrs:{id:"plugin-structure"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#plugin-structure"}},[e._v("#")]),e._v(" Plugin Structure")]),e._v(" "),a("p",[e._v("A "),a("strong",[e._v("Sermant")]),e._v(" plugin module contains the following things")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("Plugin Main Module(plugin)")]),e._v(", This module is mainly used to declare bytecode enhancement and plugin service interface definitions")]),e._v(" "),a("li",[a("code",[e._v("Plugin Service Module(service)")]),e._v(", This module is used to provide the plugin service interface implementation for the "),a("code",[e._v("Plugin Main Module(plugin)")])])]),e._v(" "),a("p",[e._v("Before we start, it's important to agree that in "),a("code",[e._v("plugin")]),e._v(" modules, developers can only use the "),a("em",[e._v("Java")]),e._v(" native API and the "),a("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/tree/develop/sermant-agentcore/sermant-agentcore-core",target:"_blank",rel:"noopener noreferrer"}},[a("strong",[e._v("Sermant")]),e._v(" core module"),a("OutboundLink")],1),e._v(" and cannot rely on or use any third-party dependencies other than "),a("code",[e._v("byte-buddy")]),e._v(". If the business needs to use other third-party dependencies, you can only define the interface in the "),a("code",[e._v("plugin")]),e._v(" module and write the implementation in the "),a("code",[e._v("service")]),e._v(" module. Refer to the "),a("RouterLink",{attrs:{to:"/en/document/developer-guide/UserGuide/plugin.html#Add-Plugin-Module"}},[e._v("Plugin Module")]),e._v(" for more information.")],1),e._v(" "),a("h3",{attrs:{id:"plugin-main-module"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#plugin-main-module"}},[e._v("#")]),e._v(" Plugin Main Module")]),e._v(" "),a("p",[e._v("Write "),a("strong",[e._v("enhanced definition")]),e._v(", "),a("strong",[e._v("interceptor")]),e._v(", and "),a("strong",[e._v("plugin service interface")]),e._v(" in this module. No third party dependencies can be introduced in this module.")]),e._v(" "),a("h3",{attrs:{id:"plugin-service-module"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#plugin-service-module"}},[e._v("#")]),e._v(" Plugin Service Module")]),e._v(" "),a("p",[e._v("Comparing to "),a("strong",[e._v("Plugin Main Module")]),e._v(":")]),e._v(" "),a("ul",[a("li",[e._v("can only write a "),a("strong",[e._v("plugin configuration")]),e._v(" and "),a("strong",[e._v("plugin service interface")]),e._v(" implementation, and cannot write **enhancement definition ** "),a("strong",[e._v("interceptor")]),e._v(" and "),a("strong",[e._v("plugins service interface")]),e._v(".")]),e._v(" "),a("li",[e._v("allow the freedom to add third-party dependencies as needed. When packaging, you need to provide a way to export dependencies, you can use the "),a("code",[e._v("shade")]),e._v(" plugin or "),a("code",[e._v("assembly")]),e._v(" plugin to export the dependency "),a("em",[e._v("jar")]),e._v(" package, or you can directly use the "),a("code",[e._v("dependency")]),e._v(" plugin to export the dependency package.")]),e._v(" "),a("li",[e._v("the corresponding "),a("strong",[e._v("Plugin Main Module")]),e._v(" is provided in its pom.")])]),e._v(" "),a("h2",{attrs:{id:"enhanced-logic"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#enhanced-logic"}},[e._v("#")]),e._v(" Enhanced logic")]),e._v(" "),a("p",[e._v("The core capability of "),a("strong",[e._v("Sermant")]),e._v(" is to do non-invasive bytecode enhancements to the host application, which are plug-in enabled. In each "),a("strong",[e._v("Sermant")]),e._v(" plugin's "),a("strong",[e._v("Plugin Main Module(plugin)")]),e._v(", it is possible to declare some enhancement logic that makes bytecode enhancements to some particular method of the host application, so it is an important subject to describe what class and how that class is enhanced.")]),e._v(" "),a("p",[e._v("The declaration plugin enhancement logic needs to implement "),a("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/agent/declarer/PluginDeclarer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("PluginDeclarer"),a("OutboundLink")],1),e._v(" interface, there are three interface methods：")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("getClassMatcher")]),e._v(" used to get the matcher"),a("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/agent/matcher/ClassMatcher.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("ClassMatcher"),a("OutboundLink")],1),e._v(" of the enhanced class。")]),e._v(" "),a("li",[a("code",[e._v("getInterceptDeclarers")]),e._v(" used to get the matcher"),a("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/agent/matcher/MethodMatcher.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("MethodMatcher"),a("OutboundLink")],1),e._v(" of method in the enhanced class, and the interceptor declared for the interception point, they are encapsulated in "),a("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/agent/declarer/InterceptDeclarer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("InterceptDeclarer"),a("OutboundLink")],1),e._v("。")]),e._v(" "),a("li",[a("code",[e._v("getSuperTpeDecarers")]),e._v(" gets the plugin's superclass declaration"),a("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/agent/declarer/SuperTypeDeclarer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("SuperTypeDeclarer"),a("OutboundLink")],1)])]),e._v(" "),a("h3",{attrs:{id:"class-matcher"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#class-matcher"}},[e._v("#")]),e._v(" Class Matcher")]),e._v(" "),a("p",[e._v("The matcher "),a("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/agent/matcher/ClassMatcher.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("ClassMatcher"),a("OutboundLink")],1),e._v(", which provides two types of matchers in the core module:")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/agent/matcher/ClassTypeMatcher.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("ClassTypeMatcher"),a("OutboundLink")],1),e._v("(the matcher for class name)")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("The most common way to do this is purely by name matching, which is obtained by:")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ClassMatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("nameEquals")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${class reference}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("Where "),a("code",[e._v("${class reference}")]),e._v(" is the full qualified class name of the enhanced class.")])]),e._v(" "),a("li",[a("p",[e._v("Matching multiple classes by name, which is the plural version of "),a("code",[e._v("nameEquals")]),e._v(", can be obtained with the following method:")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ClassMatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("nameContains")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${class reference array}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("Where "),a("code",[e._v("${class reference array}")]),e._v(" is a full qualified class name mutable array of the enhanced class.")])])]),e._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/agent/matcher/ClassFuzzyMatcher.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("ClassFuzzyMatcher"),a("OutboundLink")],1),e._v("（the fuzzy matcher of class name）")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("The enhanced class is located by the prefix of full qualified class name, which can be obtained by:")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ClassMatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("namePrefixedWith")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${prefix}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("Where "),a("code",[e._v("${prefix}")]),e._v(" is the prefix of full qualified class name.")])]),e._v(" "),a("li",[a("p",[e._v("The enhanced class is located by the suffix of full qualified class name, which can be retrieved as follows:")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ClassMatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("nameSuffixedWith")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${suffix}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("p",[e._v("Where "),a("code",[e._v("${suffix}")]),e._v(" is the suffix of full qualified class name.")])]),e._v(" "),a("li",[a("p",[e._v("The enhanced class is located by the infix of full qualified class name, which can be obtained as follows:")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ClassMatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("nameinfixedWith")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${infix}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("p",[e._v("Where "),a("code",[e._v("${infix}")]),e._v(" is the infix of full qualified class name.")])]),e._v(" "),a("li",[a("p",[e._v("The enhanced class is located by matching the full qualified class name with a regular expression, which can be obtained as follows:")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ClassMatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("nameMatches")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${pattern}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("p",[e._v("Where "),a("code",[e._v("${pattern}")]),e._v(" is a regular expression.")])]),e._v(" "),a("li",[a("p",[e._v("The enhanced class is located by annotation decorated, which can be obtained as follows:")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ClassMatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("isAnnotationWith")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${annotation reference array}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("Where "),a("code",[e._v("${annotation reference array}")]),e._v(" is a full qualified class name array of annotations.")])]),e._v(" "),a("li",[a("p",[e._v("Locating a subclass by means of a superclass can be obtained using the following methods:")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ClassMatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("isExtendedFrom")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${super class array}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("Where "),a("code",[e._v("${super class array}")]),e._v(" is a superclass mutable array. Due to Java inheritance rules, the array can only have one "),a("code",[e._v("class")]),e._v(", the rest must be "),a("code",[e._v("interface")]),e._v(".")])]),e._v(" "),a("li",[a("p",[e._v("A matching logical operation, which is true when all matchers do not match:")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ClassMatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("not")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${class matcher array}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("p",[e._v("Where "),a("code",[e._v("${class matcher array}")]),e._v(" is a variable-length array of matcher.")])]),e._v(" "),a("li",[a("p",[e._v("A matching logical operation, which is true if the matcher matches all of them:")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ClassMatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("and")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${class matcher array}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("p",[e._v("Where "),a("code",[e._v("${class matcher array}")]),e._v(" is a variable-length array of matcher.")])]),e._v(" "),a("li",[a("p",[e._v("A matching logical operation, which is true if one of the matcher matches:")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ClassMatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("or")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${class matcher array}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("p",[e._v("Where "),a("code",[e._v("${class matcher array}")]),e._v(" is a variable-length array of matcher.")])])]),e._v(" "),a("h3",{attrs:{id:"method-matcher"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#method-matcher"}},[e._v("#")]),e._v(" Method Matcher")]),e._v(" "),a("p",[e._v("For method interception points "),a("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/agent/matcher/MethodMatcher.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("MethodMatcher"),a("OutboundLink")],1),e._v(", we provide a variety of matching methods:")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("Match any method:")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("any")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Match by method name:")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("nameEquals")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${method name}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("Where "),a("code",[e._v("${method name}")]),e._v(" is the method name.")])]),e._v(" "),a("li",[a("p",[e._v("Match static method:")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("isStaticMethod")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Match constructor:")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("isConstructor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Match multiple methods:")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("nameContains")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${method name array}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("Where "),a("code",[e._v("${method name array}")]),e._v(" is an array of method names.")])]),e._v(" "),a("li",[a("p",[e._v("Match by prefix of method name:")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("namePrefixedWith")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${method name prefix}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("Where "),a("code",[e._v("${method name prefix}")]),e._v(" is the prefix of method name .")])]),e._v(" "),a("li",[a("p",[e._v("Match by suffix of method name:")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("nameSuffixedWith")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${method name suffix}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("Where "),a("code",[e._v("${method name suffix}")]),e._v(" is the suffix of method name.")])]),e._v(" "),a("li",[a("p",[e._v("Match by infix of method name：")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("nameinfixedWith")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${method name infix}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("Where "),a("code",[e._v("${method name infix}")]),e._v(" is the infix of method name.")])]),e._v(" "),a("li",[a("p",[e._v("Match by regular expression:")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("nameMatches")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${pattern}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("Where "),a("code",[e._v("${pattern}")]),e._v(" is a regular expression.")])]),e._v(" "),a("li",[a("p",[e._v("Matches by annotation:")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("isAnnotatedWith")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${annotations array}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("Where "),a("code",[e._v("${annotations array}")]),e._v(" is the annotation set.")])]),e._v(" "),a("li",[a("p",[e._v("Match by specified number of arguments:")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("paramCountEquals")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${param count}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("Where "),a("code",[e._v("${param count}")]),e._v(" is the number of input parameters.")])]),e._v(" "),a("li",[a("p",[e._v("Match by the specific type of argument:")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("paramTypeEquals")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${param type array}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("Where "),a("code",[e._v("${param type array}")]),e._v(" is the set of input types.")])]),e._v(" "),a("li",[a("p",[e._v("Match by return type")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("resultTypeEquals")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${result type}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("Where "),a("code",[e._v("${result type}")]),e._v(" is the return type.")])]),e._v(" "),a("li",[a("p",[e._v("Logical operation, where the result is true if the method matcher set does not match at all.")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("not")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${element matcher array}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("Where "),a("code",[e._v("${element matcher array}")]),e._v(" is the set of method matcher.")])]),e._v(" "),a("li",[a("p",[e._v("Logical operation, where the result is true if the method matcher set fully matches.")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("and")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${element matcher array}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("Where "),a("code",[e._v("${element matcher array}")]),e._v(" is the set of method matcher.")])]),e._v(" "),a("li",[a("p",[e._v("Logical operation, where the result is true if method matcher set matches one of the result.")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MethodMatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("or")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"${element matcher array}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("Where "),a("code",[e._v("${element matcher array}")]),e._v(" is the set of method matcher.")])])]),e._v(" "),a("p",[e._v("For more methods matching method, refer to "),a("a",{attrs:{href:"https://javadoc.io/doc/net.bytebuddy/byte-buddy/latest/net/bytebuddy/matcher/ElementMatchers.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("byte-buddy"),a("OutboundLink")],1),e._v(" methods with a generic type of "),a("code",[e._v("MethodDescription")]),e._v(" .")]),e._v(" "),a("p",[e._v("Don't forget to add the "),a("em",[e._v("SPI")]),e._v(" configuration file for the "),a("code",[e._v("PluginDeclarer")]),e._v(" interface:")]),e._v(" "),a("ul",[a("li",[e._v("Add "),a("code",[e._v("META-INF/services")]),e._v(" folder under "),a("code",[e._v("resources")]),e._v(".")]),e._v(" "),a("li",[e._v("Add "),a("code",[e._v("com.huaweicloud.sermant.core.plugin.agent.declarer.PluginDeclarer")]),e._v(" under "),a("code",[e._v("META-INF/services")]),e._v(" .")]),e._v(" "),a("li",[e._v("In the above file, type all the enhancements definitions of "),a("code",[e._v("PluginDeclarer")]),e._v(" in the plugin package separated with LF.")])]),e._v(" "),a("h4",{attrs:{id:"原生类增强"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#原生类增强"}},[e._v("#")]),e._v(" 原生类增强")]),e._v(" "),a("p",[e._v("There is no difference between native classes and regular classes in terms of enhancement definition and writing interceptors. However, it is desirable for plugin developers to minimize enhancement to native classes for three reasons:")]),e._v(" "),a("ul",[a("li",[e._v("Enhancements to native classes tend to be divergent. And enhancements to them are likely to impact other plugins or host functionality.")]),e._v(" "),a("li",[e._v("The native class enhancement logic will use reflection to invoke interceptor methods in the system classloader. Due to the "),a("em",[e._v("Java")]),e._v(" redefinition of the "),a("em",[e._v("Class")]),e._v(", every time an enhanced method is called, the reflection logic is processed, which significantly limits the performance of the method.")]),e._v(" "),a("li",[e._v("The enhancements to the native classes involved using the "),a("strong",[e._v("Advice template class")]),e._v(" to generate a dynamic interceptor class. For each enhanced native class method, one will be generated dynamically and they will be loaded by the system classloader. If native classes are enhanced without restriction, loading dynamic classes can also become a significant burden during startup.")])]),e._v(" "),a("p",[e._v("In summary, "),a("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/tree/develop/sermant-agentcore/sermant-agentcore-core",target:"_blank",rel:"noopener noreferrer"}},[a("strong",[e._v("Sermant")]),e._v(" core module"),a("OutboundLink")],1),e._v(" provides the ability to augment "),a("em",[e._v("Java")]),e._v(" native classes. However, it is not recommended to enhance them without restrictions. If there are multiple enhancement points to choose from, you'd better choose enhancing regular classes.")]),e._v(" "),a("h3",{attrs:{id:"interceptor"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#interceptor"}},[e._v("#")]),e._v(" Interceptor")]),e._v(" "),a("p",[e._v("Interceptors are used to define enhancement logic before and after bytecode enhancement of methods of the enhanced class, and when handling exceptions:")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/agent/interceptor/Interceptor.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("interceptor"),a("OutboundLink")],1),e._v(": the interceptor interface, which contains three methods:\n"),a("ul",[a("li",[a("code",[e._v("before")]),e._v(", the preceding method, which is executed before the interception point. The ExecuteContext parameter is the context of the plugin execution, which encapsulates all the parameters required for the interceptor to operate. Through the skip method, the main process can be skipped and the final method result can be set. Note that the main process cannot be skipped when the constructor is enhanced .")]),e._v(" "),a("li",[a("code",[e._v("after")]),e._v(", the post-method, ends up in the post-method whether or not the intercepted method executes normally. Postmethods can override the return value of the intercepted method with their return value, so developers need to be careful not to return null easily here.")]),e._v(" "),a("li",[a("code",[e._v("onThrow")]),e._v(", an exception handling method that is triggered when the intercepted method executes an exception. Handling the exception here does not affect the normal throwing of the exception.")])])])]),e._v(" "),a("h2",{attrs:{id:"plugin-configuration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#plugin-configuration"}},[e._v("#")]),e._v(" Plugin Configuration")]),e._v(" "),a("p",[e._v("Defining the plugin configuration starts with defining a plugin configuration class for the plugin, which needs to inherite"),a("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/config/PluginConfig.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("PluginConfig"),a("OutboundLink")],1),e._v("，uses "),a("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/config/common/ConfigTypeKey.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("ConfigTypeKey"),a("OutboundLink")],1),e._v(" to decorate, specifies the prefix of the configuration that the configuration class can read, use "),a("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/config/common/ConfigFieldKey.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("ConfigFieldKey"),a("OutboundLink")],1),e._v("to decorate the fields of this class(if not decorated, read a configuration whose read configuration name is the same as that of the variable), specifying the configuration name of the configuration corresponding to that variable.")]),e._v(" "),a("p",[e._v("Create a config.yaml file in the plugin's "),a("code",[e._v("config")]),e._v(" directory:")]),e._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("demo.config")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("demo-config-A")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[e._v("false")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("demoConfigB")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" 127.0.0.1\n")])])]),a("p",[e._v("Corresponding configuration classes:")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[e._v("@ConfigTypeKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("value "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"demo.config"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("class")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("DemoConfig")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("implements")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("PluginConfig")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[e._v("@ConfigFieldKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"demo-config-A"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("private")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("boolean")]),e._v(" demoConfigA"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("private")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("String")]),e._v(" demoConfigB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("p",[e._v("Finally, don't forget to add the "),a("em",[e._v("SPI")]),e._v(" configuration file for the plugin configuration:")]),e._v(" "),a("ul",[a("li",[e._v("Add "),a("code",[e._v("META-INF/services")]),e._v(" folder under "),a("code",[e._v("resources")]),e._v(".")]),e._v(" "),a("li",[e._v("Add "),a("code",[e._v("com.huaweicloud.sermant.core.plugin.config.PluginConfig")]),e._v(" configuration file under "),a("code",[e._v("META-INF/services")]),e._v(".")]),e._v(" "),a("li",[e._v("In the above file, type the "),a("code",[e._v("PluginConfig")]),e._v(" implementation for all plugin configurations in the plugin package and separate them by LF.")])]),e._v(" "),a("p",[e._v("How to use configuration in plugin. The "),a("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/config/PluginConfigManager.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("PluginConfigManager"),a("OutboundLink")],1),e._v(" provides the interface to obtain the plugin configuration "),a("code",[e._v("PluginConfig")]),e._v(". In the plugin, you can obtain an instance of the plugin configuration through this manager and use it. The method of obtaining the instance is as follows:")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// ${plugin config class} is the plugin configuration class")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("PluginConfigManager")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("getPluginConfig")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("plugin config "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[a("code",[e._v("PluginConfigManager")]),e._v(" is the unified configuration manager "),a("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/config/ConfigManager.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("ConfigManager"),a("OutboundLink")],1),e._v(", The plugin side can directly use the interface of the latter to obtain plugin configuration and unified configuration：")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// ${base config class}is the plugin configuration class or unified configuration class")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ConfigManager")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("getConfig")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("base config "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("Configuration now supports data types include:")]),e._v(" "),a("ul",[a("li",[e._v("Primitive and wrapper types for Boolean and numeric classes")]),e._v(" "),a("li",[e._v("String")]),e._v(" "),a("li",[e._v("Enum")]),e._v(" "),a("li",[e._v("Complex object")]),e._v(" "),a("li",[e._v("Array of the above types")]),e._v(" "),a("li",[e._v("List of the first four types")]),e._v(" "),a("li",[e._v("Map of the first four types")])]),e._v(" "),a("p",[a("em",[e._v("YAML")]),e._v(" format configuration files currently have a few other rules:")]),e._v(" "),a("ul",[a("li",[e._v("For complex objects involved in arrays, lists, and maps, using "),a("code",[e._v("ConfigFieldKey")]),e._v(" to fix property names is not supported.")]),e._v(" "),a("li",[e._v("For strings in arrays, lists, and maps, there is no support for "),a("code",[e._v("${}")]),e._v(" conversions, "),a("strong",[e._v("plugin configuration class")]),e._v(" string properties and string properties inside complex type properties are supported.")]),e._v(" "),a("li",[e._v("Parameters are only used for string "),a("code",[e._v("${}")]),e._v(" conversions. Direct setting property values using parameters is not supported.")]),e._v(" "),a("li",[e._v("The field names of configuration classes are usually small camels.You can use "),a("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/config/common/ConfigTypeKey.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("ConfigFieldKey"),a("OutboundLink")],1),e._v(" to define aliases for the transverse-line style. After the annotation is added, it can be parsed in "),a("em",[e._v("YAML")]),e._v(" using either transverse-line or small camel style.")]),e._v(" "),a("li",[e._v("The priority of the configuration is: startup parameters > environment variables > system variables (-d parameter) > "),a("em",[e._v("YAML")]),e._v(" file configuration")]),e._v(" "),a("li",[e._v("When the attributes of the configuration class obtain reference values (startup parameter, environment variable, and system variable (-D parameter)) according to the priority of the effective value, the small hump and the hyphen can be split into words for searching and matching.")]),e._v(" "),a("li",[e._v("If the key of the basic data type/array /map/list/set(which does not support complex objects) is not defined in the "),a("em",[e._v("YAML")]),e._v(" configuration, the reference value will be obtained according to the priority of the configuration effect: startup parameters > environment variables > system variables (-d parameter). When retrieving reference values from the above data sources, note that:\n"),a("ul",[a("li",[e._v("The array /list/set should be configured in "),a("code",[e._v("YAML")]),e._v(" string format. For example: DEMO_TEST_LIST_NAME=[elem1,elem2]")]),e._v(" "),a("li",[e._v("The map needs to be configured as a "),a("code",[e._v("YAML")]),e._v(" string format. For example: DEMO_TEST_MAP_NAME={key1: value1, key2: value2}")])])])]),e._v(" "),a("h2",{attrs:{id:"plugin-service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#plugin-service"}},[e._v("#")]),e._v(" Plugin Service")]),e._v(" "),a("p",[a("strong",[e._v("Plugin Services")]),e._v(" are mainly divided into two parts:")]),e._v(" "),a("p",[a("strong",[e._v("Service interface definition")]),e._v(" is used to describe the capabilities provided by the service in "),a("code",[e._v("Plugin Main Module")]),e._v(",\nwhen define the service interface, need to inherit"),a("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/service/PluginService.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("PluginService"),a("OutboundLink")],1),e._v("plugin service base interface, it provide "),a("code",[e._v("start()")]),e._v(" will be called when "),a("strong",[e._v("Sermant")]),e._v(" start，"),a("code",[e._v("stop()")]),e._v(" will be called when JVM stop.")]),e._v(" "),a("p",[a("strong",[e._v("Service interface implementation")]),e._v(" is in "),a("code",[e._v("Plugin Service Module")]),e._v("，in "),a("code",[e._v("Plugin Main Module")]),e._v(" you can get and use the implementations by "),a("em",[e._v("SPI")]),e._v(".")]),e._v(" "),a("p",[e._v("Finally, don't forget to add the "),a("em",[e._v("SPI")]),e._v(" configuration file for the plugin service:")]),e._v(" "),a("ul",[a("li",[e._v("Add "),a("code",[e._v("META-INF/services")]),e._v(" folder under "),a("code",[e._v("resources")]),e._v(".")]),e._v(" "),a("li",[e._v("Add "),a("code",[e._v("com.huaweicloud.sermant.core.plugin.service.PluginService")]),e._v(" configuration file under "),a("code",[e._v("META-INF/services")]),e._v(".")]),e._v(" "),a("li",[e._v("In the above file, type the "),a("code",[e._v("PluginConfig")]),e._v(" implementation for all plugin services in the "),a("code",[e._v("Plugin Service Module")]),e._v(" package and separate them by LF.")])]),e._v(" "),a("p",[e._v("In "),a("code",[e._v("Plugin Main Module")]),e._v(" you can use "),a("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/plugin/service/PluginServiceManager.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("PluginServiceManager"),a("OutboundLink")],1),e._v(" to get "),a("code",[e._v("PluginService")]),e._v(":")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// ${plugin service class} is the plugin service class")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("PluginServiceManager")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("getPluginService")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("plugin service "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[a("code",[e._v("PluginServiceManager")]),e._v(" is a particular case of "),a("a",{attrs:{href:"https://github.com/huaweicloud/Sermant/blob/develop/sermant-agentcore/sermant-agentcore-core/src/main/java/com/huaweicloud/sermant/core/service/ServiceManager.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("ServiceManager"),a("OutboundLink")],1),e._v(". The latter interface can be used directly to access the core and plugin services:")]),e._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// ${base service class}is the core service class or plugin service class")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ServiceManager")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("getService")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("base service "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])])])}),[],!1,null,null,null);a.default=s.exports}}]);